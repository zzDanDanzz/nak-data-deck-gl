function Ub(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var ZV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r1={exports:{}},eu={},s1={exports:{}},q={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ta=Symbol.for("react.element"),Vb=Symbol.for("react.portal"),jb=Symbol.for("react.fragment"),Gb=Symbol.for("react.strict_mode"),Wb=Symbol.for("react.profiler"),Hb=Symbol.for("react.provider"),$b=Symbol.for("react.context"),Yb=Symbol.for("react.forward_ref"),Xb=Symbol.for("react.suspense"),Zb=Symbol.for("react.memo"),qb=Symbol.for("react.lazy"),Sm=Symbol.iterator;function Kb(t){return t===null||typeof t!="object"?null:(t=Sm&&t[Sm]||t["@@iterator"],typeof t=="function"?t:null)}var o1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},a1=Object.assign,l1={};function _s(t,e,n){this.props=t,this.context=e,this.refs=l1,this.updater=n||o1}_s.prototype.isReactComponent={};_s.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};_s.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function c1(){}c1.prototype=_s.prototype;function og(t,e,n){this.props=t,this.context=e,this.refs=l1,this.updater=n||o1}var ag=og.prototype=new c1;ag.constructor=og;a1(ag,_s.prototype);ag.isPureReactComponent=!0;var Pm=Array.isArray,u1=Object.prototype.hasOwnProperty,lg={current:null},f1={key:!0,ref:!0,__self:!0,__source:!0};function h1(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)u1.call(e,i)&&!f1.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:ta,type:t,key:s,ref:o,props:r,_owner:lg.current}}function Qb(t,e){return{$$typeof:ta,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function cg(t){return typeof t=="object"&&t!==null&&t.$$typeof===ta}function Jb(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Am=/\/+/g;function $u(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Jb(""+t.key):e.toString(36)}function Ll(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ta:case Vb:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+$u(o,0):i,Pm(r)?(n="",t!=null&&(n=t.replace(Am,"$&/")+"/"),Ll(r,e,n,"",function(c){return c})):r!=null&&(cg(r)&&(r=Qb(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Am,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Pm(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+$u(s,a);o+=Ll(s,e,n,l,r)}else if(l=Kb(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+$u(s,a++),o+=Ll(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ia(t,e,n){if(t==null)return t;var i=[],r=0;return Ll(t,i,"","",function(s){return e.call(n,s,r++)}),i}function eS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qe={current:null},Cl={transition:null},tS={ReactCurrentDispatcher:Qe,ReactCurrentBatchConfig:Cl,ReactCurrentOwner:lg};q.Children={map:Ia,forEach:function(t,e,n){Ia(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ia(t,function(){e++}),e},toArray:function(t){return Ia(t,function(e){return e})||[]},only:function(t){if(!cg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};q.Component=_s;q.Fragment=jb;q.Profiler=Wb;q.PureComponent=og;q.StrictMode=Gb;q.Suspense=Xb;q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tS;q.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=a1({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=lg.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)u1.call(e,l)&&!f1.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:ta,type:t.type,key:r,ref:s,props:i,_owner:o}};q.createContext=function(t){return t={$$typeof:$b,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Hb,_context:t},t.Consumer=t};q.createElement=h1;q.createFactory=function(t){var e=h1.bind(null,t);return e.type=t,e};q.createRef=function(){return{current:null}};q.forwardRef=function(t){return{$$typeof:Yb,render:t}};q.isValidElement=cg;q.lazy=function(t){return{$$typeof:qb,_payload:{_status:-1,_result:t},_init:eS}};q.memo=function(t,e){return{$$typeof:Zb,type:t,compare:e===void 0?null:e}};q.startTransition=function(t){var e=Cl.transition;Cl.transition={};try{t()}finally{Cl.transition=e}};q.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};q.useCallback=function(t,e){return Qe.current.useCallback(t,e)};q.useContext=function(t){return Qe.current.useContext(t)};q.useDebugValue=function(){};q.useDeferredValue=function(t){return Qe.current.useDeferredValue(t)};q.useEffect=function(t,e){return Qe.current.useEffect(t,e)};q.useId=function(){return Qe.current.useId()};q.useImperativeHandle=function(t,e,n){return Qe.current.useImperativeHandle(t,e,n)};q.useInsertionEffect=function(t,e){return Qe.current.useInsertionEffect(t,e)};q.useLayoutEffect=function(t,e){return Qe.current.useLayoutEffect(t,e)};q.useMemo=function(t,e){return Qe.current.useMemo(t,e)};q.useReducer=function(t,e,n){return Qe.current.useReducer(t,e,n)};q.useRef=function(t){return Qe.current.useRef(t)};q.useState=function(t){return Qe.current.useState(t)};q.useSyncExternalStore=function(t,e,n){return Qe.current.useSyncExternalStore(t,e,n)};q.useTransition=function(){return Qe.current.useTransition()};q.version="18.2.0";s1.exports=q;var N=s1.exports;const nS=Jc(N);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iS=N,rS=Symbol.for("react.element"),sS=Symbol.for("react.fragment"),oS=Object.prototype.hasOwnProperty,aS=iS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lS={key:!0,ref:!0,__self:!0,__source:!0};function d1(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)oS.call(e,i)&&!lS.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:rS,type:t,key:s,ref:o,props:r,_owner:aS.current}}eu.Fragment=sS;eu.jsx=d1;eu.jsxs=d1;r1.exports=eu;var K=r1.exports,ph={},g1={exports:{}},xt={},p1={exports:{}},m1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,G){var $=D.length;D.push(G);e:for(;0<$;){var he=$-1>>>1,ue=D[he];if(0<r(ue,G))D[he]=G,D[$]=ue,$=he;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var G=D[0],$=D.pop();if($!==G){D[0]=$;e:for(var he=0,ue=D.length,lr=ue>>>1;he<lr;){var kt=2*(he+1)-1,Ts=D[kt],dn=kt+1,we=D[dn];if(0>r(Ts,$))dn<ue&&0>r(we,Ts)?(D[he]=we,D[dn]=$,he=dn):(D[he]=Ts,D[kt]=$,he=kt);else if(dn<ue&&0>r(we,$))D[he]=we,D[dn]=$,he=dn;else break e}}return G}function r(D,G){var $=D.sortIndex-G.sortIndex;return $!==0?$:D.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,d=!1,p=!1,_=!1,T=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(D){for(var G=n(c);G!==null;){if(G.callback===null)i(c);else if(G.startTime<=D)i(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=n(c)}}function E(D){if(_=!1,v(D),!p)if(n(l)!==null)p=!0,Kt(S);else{var G=n(c);G!==null&&Ot(E,G.startTime-D)}}function S(D,G){p=!1,_&&(_=!1,y(C),C=-1),d=!0;var $=h;try{for(v(G),f=n(l);f!==null&&(!(f.expirationTime>G)||D&&!k());){var he=f.callback;if(typeof he=="function"){f.callback=null,h=f.priorityLevel;var ue=he(f.expirationTime<=G);G=t.unstable_now(),typeof ue=="function"?f.callback=ue:f===n(l)&&i(l),v(G)}else i(l);f=n(l)}if(f!==null)var lr=!0;else{var kt=n(c);kt!==null&&Ot(E,kt.startTime-G),lr=!1}return lr}finally{f=null,h=$,d=!1}}var P=!1,L=null,C=-1,M=5,I=-1;function k(){return!(t.unstable_now()-I<M)}function W(){if(L!==null){var D=t.unstable_now();I=D;var G=!0;try{G=L(!0,D)}finally{G?j():(P=!1,L=null)}}else P=!1}var j;if(typeof m=="function")j=function(){m(W)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,et=H.port2;H.port1.onmessage=W,j=function(){et.postMessage(null)}}else j=function(){T(W,0)};function Kt(D){L=D,P||(P=!0,j())}function Ot(D,G){C=T(function(){D(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){p||d||(p=!0,Kt(S))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(h){case 1:case 2:case 3:var G=3;break;default:G=h}var $=h;h=G;try{return D()}finally{h=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,G){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var $=h;h=D;try{return G()}finally{h=$}},t.unstable_scheduleCallback=function(D,G,$){var he=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?he+$:he):$=he,D){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=$+ue,D={id:u++,callback:G,priorityLevel:D,startTime:$,expirationTime:ue,sortIndex:-1},$>he?(D.sortIndex=$,e(c,D),n(l)===null&&D===n(c)&&(_?(y(C),C=-1):_=!0,Ot(E,$-he))):(D.sortIndex=ue,e(l,D),p||d||(p=!0,Kt(S))),D},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(D){var G=h;return function(){var $=h;h=G;try{return D.apply(this,arguments)}finally{h=$}}}})(m1);p1.exports=m1;var cS=p1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y1=N,mt=cS;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v1=new Set,vo={};function tr(t,e){Qr(t,e),Qr(t+"Capture",e)}function Qr(t,e){for(vo[t]=e,t=0;t<e.length;t++)v1.add(e[t])}var Cn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mh=Object.prototype.hasOwnProperty,uS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lm={},Cm={};function fS(t){return mh.call(Cm,t)?!0:mh.call(Lm,t)?!1:uS.test(t)?Cm[t]=!0:(Lm[t]=!0,!1)}function hS(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function dS(t,e,n,i){if(e===null||typeof e>"u"||hS(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Je(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){De[t]=new Je(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];De[e]=new Je(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){De[t]=new Je(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){De[t]=new Je(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){De[t]=new Je(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){De[t]=new Je(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){De[t]=new Je(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){De[t]=new Je(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){De[t]=new Je(t,5,!1,t.toLowerCase(),null,!1,!1)});var ug=/[\-:]([a-z])/g;function fg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ug,fg);De[e]=new Je(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ug,fg);De[e]=new Je(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ug,fg);De[e]=new Je(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){De[t]=new Je(t,1,!1,t.toLowerCase(),null,!1,!1)});De.xlinkHref=new Je("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){De[t]=new Je(t,1,!1,t.toLowerCase(),null,!0,!0)});function hg(t,e,n,i){var r=De.hasOwnProperty(e)?De[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(dS(e,n,r,i)&&(n=null),i||r===null?fS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Dn=y1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ra=Symbol.for("react.element"),Er=Symbol.for("react.portal"),Tr=Symbol.for("react.fragment"),dg=Symbol.for("react.strict_mode"),yh=Symbol.for("react.profiler"),_1=Symbol.for("react.provider"),x1=Symbol.for("react.context"),gg=Symbol.for("react.forward_ref"),vh=Symbol.for("react.suspense"),_h=Symbol.for("react.suspense_list"),pg=Symbol.for("react.memo"),Zn=Symbol.for("react.lazy"),w1=Symbol.for("react.offscreen"),Mm=Symbol.iterator;function Is(t){return t===null||typeof t!="object"?null:(t=Mm&&t[Mm]||t["@@iterator"],typeof t=="function"?t:null)}var ye=Object.assign,Yu;function Zs(t){if(Yu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Yu=e&&e[1]||""}return`
`+Yu+t}var Xu=!1;function Zu(t,e){if(!t||Xu)return"";Xu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Xu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Zs(t):""}function gS(t){switch(t.tag){case 5:return Zs(t.type);case 16:return Zs("Lazy");case 13:return Zs("Suspense");case 19:return Zs("SuspenseList");case 0:case 2:case 15:return t=Zu(t.type,!1),t;case 11:return t=Zu(t.type.render,!1),t;case 1:return t=Zu(t.type,!0),t;default:return""}}function xh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Tr:return"Fragment";case Er:return"Portal";case yh:return"Profiler";case dg:return"StrictMode";case vh:return"Suspense";case _h:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case x1:return(t.displayName||"Context")+".Consumer";case _1:return(t._context.displayName||"Context")+".Provider";case gg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case pg:return e=t.displayName||null,e!==null?e:xh(t.type)||"Memo";case Zn:e=t._payload,t=t._init;try{return xh(t(e))}catch{}}return null}function pS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xh(e);case 8:return e===dg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function E1(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mS(t){var e=E1(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Oa(t){t._valueTracker||(t._valueTracker=mS(t))}function T1(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=E1(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ec(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function wh(t,e){var n=e.checked;return ye({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Im(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=gi(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function b1(t,e){e=e.checked,e!=null&&hg(t,"checked",e,!1)}function Eh(t,e){b1(t,e);var n=gi(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Th(t,e.type,n):e.hasOwnProperty("defaultValue")&&Th(t,e.type,gi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Rm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Th(t,e,n){(e!=="number"||ec(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var qs=Array.isArray;function jr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+gi(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function bh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return ye({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Om(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(qs(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gi(n)}}function S1(t,e){var n=gi(e.value),i=gi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function km(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function P1(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?P1(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ka,A1=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ka=ka||document.createElement("div"),ka.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ka.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function _o(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var no={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yS=["Webkit","ms","Moz","O"];Object.keys(no).forEach(function(t){yS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),no[e]=no[t]})});function L1(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||no.hasOwnProperty(t)&&no[t]?(""+e).trim():e+"px"}function C1(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=L1(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var vS=ye({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ph(t,e){if(e){if(vS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function Ah(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lh=null;function mg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ch=null,Gr=null,Wr=null;function Nm(t){if(t=ra(t)){if(typeof Ch!="function")throw Error(O(280));var e=t.stateNode;e&&(e=su(e),Ch(t.stateNode,t.type,e))}}function M1(t){Gr?Wr?Wr.push(t):Wr=[t]:Gr=t}function I1(){if(Gr){var t=Gr,e=Wr;if(Wr=Gr=null,Nm(t),e)for(t=0;t<e.length;t++)Nm(e[t])}}function R1(t,e){return t(e)}function O1(){}var qu=!1;function k1(t,e,n){if(qu)return t(e,n);qu=!0;try{return R1(t,e,n)}finally{qu=!1,(Gr!==null||Wr!==null)&&(O1(),I1())}}function xo(t,e){var n=t.stateNode;if(n===null)return null;var i=su(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var Mh=!1;if(Cn)try{var Rs={};Object.defineProperty(Rs,"passive",{get:function(){Mh=!0}}),window.addEventListener("test",Rs,Rs),window.removeEventListener("test",Rs,Rs)}catch{Mh=!1}function _S(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var io=!1,tc=null,nc=!1,Ih=null,xS={onError:function(t){io=!0,tc=t}};function wS(t,e,n,i,r,s,o,a,l){io=!1,tc=null,_S.apply(xS,arguments)}function ES(t,e,n,i,r,s,o,a,l){if(wS.apply(this,arguments),io){if(io){var c=tc;io=!1,tc=null}else throw Error(O(198));nc||(nc=!0,Ih=c)}}function nr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function N1(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Fm(t){if(nr(t)!==t)throw Error(O(188))}function TS(t){var e=t.alternate;if(!e){if(e=nr(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Fm(r),t;if(s===i)return Fm(r),e;s=s.sibling}throw Error(O(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==i)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function F1(t){return t=TS(t),t!==null?D1(t):null}function D1(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=D1(t);if(e!==null)return e;t=t.sibling}return null}var z1=mt.unstable_scheduleCallback,Dm=mt.unstable_cancelCallback,bS=mt.unstable_shouldYield,SS=mt.unstable_requestPaint,xe=mt.unstable_now,PS=mt.unstable_getCurrentPriorityLevel,yg=mt.unstable_ImmediatePriority,B1=mt.unstable_UserBlockingPriority,ic=mt.unstable_NormalPriority,AS=mt.unstable_LowPriority,U1=mt.unstable_IdlePriority,tu=null,un=null;function LS(t){if(un&&typeof un.onCommitFiberRoot=="function")try{un.onCommitFiberRoot(tu,t,void 0,(t.current.flags&128)===128)}catch{}}var $t=Math.clz32?Math.clz32:IS,CS=Math.log,MS=Math.LN2;function IS(t){return t>>>=0,t===0?32:31-(CS(t)/MS|0)|0}var Na=64,Fa=4194304;function Ks(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rc(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ks(a):(s&=o,s!==0&&(i=Ks(s)))}else o=n&~r,o!==0?i=Ks(o):s!==0&&(i=Ks(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-$t(e),r=1<<n,i|=t[n],e&=~r;return i}function RS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OS(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-$t(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=RS(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Rh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function V1(){var t=Na;return Na<<=1,!(Na&4194240)&&(Na=64),t}function Ku(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function na(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-$t(e),t[e]=n}function kS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-$t(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function vg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-$t(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var te=0;function j1(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var G1,_g,W1,H1,$1,Oh=!1,Da=[],ri=null,si=null,oi=null,wo=new Map,Eo=new Map,Kn=[],NS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zm(t,e){switch(t){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":si=null;break;case"mouseover":case"mouseout":oi=null;break;case"pointerover":case"pointerout":wo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eo.delete(e.pointerId)}}function Os(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=ra(e),e!==null&&_g(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function FS(t,e,n,i,r){switch(e){case"focusin":return ri=Os(ri,t,e,n,i,r),!0;case"dragenter":return si=Os(si,t,e,n,i,r),!0;case"mouseover":return oi=Os(oi,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return wo.set(s,Os(wo.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Eo.set(s,Os(Eo.get(s)||null,t,e,n,i,r)),!0}return!1}function Y1(t){var e=Oi(t.target);if(e!==null){var n=nr(e);if(n!==null){if(e=n.tag,e===13){if(e=N1(n),e!==null){t.blockedOn=e,$1(t.priority,function(){W1(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ml(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=kh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Lh=i,n.target.dispatchEvent(i),Lh=null}else return e=ra(n),e!==null&&_g(e),t.blockedOn=n,!1;e.shift()}return!0}function Bm(t,e,n){Ml(t)&&n.delete(e)}function DS(){Oh=!1,ri!==null&&Ml(ri)&&(ri=null),si!==null&&Ml(si)&&(si=null),oi!==null&&Ml(oi)&&(oi=null),wo.forEach(Bm),Eo.forEach(Bm)}function ks(t,e){t.blockedOn===e&&(t.blockedOn=null,Oh||(Oh=!0,mt.unstable_scheduleCallback(mt.unstable_NormalPriority,DS)))}function To(t){function e(r){return ks(r,t)}if(0<Da.length){ks(Da[0],t);for(var n=1;n<Da.length;n++){var i=Da[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ri!==null&&ks(ri,t),si!==null&&ks(si,t),oi!==null&&ks(oi,t),wo.forEach(e),Eo.forEach(e),n=0;n<Kn.length;n++)i=Kn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Kn.length&&(n=Kn[0],n.blockedOn===null);)Y1(n),n.blockedOn===null&&Kn.shift()}var Hr=Dn.ReactCurrentBatchConfig,sc=!0;function zS(t,e,n,i){var r=te,s=Hr.transition;Hr.transition=null;try{te=1,xg(t,e,n,i)}finally{te=r,Hr.transition=s}}function BS(t,e,n,i){var r=te,s=Hr.transition;Hr.transition=null;try{te=4,xg(t,e,n,i)}finally{te=r,Hr.transition=s}}function xg(t,e,n,i){if(sc){var r=kh(t,e,n,i);if(r===null)lf(t,e,i,oc,n),zm(t,i);else if(FS(r,t,e,n,i))i.stopPropagation();else if(zm(t,i),e&4&&-1<NS.indexOf(t)){for(;r!==null;){var s=ra(r);if(s!==null&&G1(s),s=kh(t,e,n,i),s===null&&lf(t,e,i,oc,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else lf(t,e,i,null,n)}}var oc=null;function kh(t,e,n,i){if(oc=null,t=mg(i),t=Oi(t),t!==null)if(e=nr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=N1(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return oc=t,null}function X1(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PS()){case yg:return 1;case B1:return 4;case ic:case AS:return 16;case U1:return 536870912;default:return 16}default:return 16}}var Jn=null,wg=null,Il=null;function Z1(){if(Il)return Il;var t,e=wg,n=e.length,i,r="value"in Jn?Jn.value:Jn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Il=r.slice(t,1<i?1-i:void 0)}function Rl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function za(){return!0}function Um(){return!1}function wt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?za:Um,this.isPropagationStopped=Um,this}return ye(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=za)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=za)},persist:function(){},isPersistent:za}),e}var xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Eg=wt(xs),ia=ye({},xs,{view:0,detail:0}),US=wt(ia),Qu,Ju,Ns,nu=ye({},ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ns&&(Ns&&t.type==="mousemove"?(Qu=t.screenX-Ns.screenX,Ju=t.screenY-Ns.screenY):Ju=Qu=0,Ns=t),Qu)},movementY:function(t){return"movementY"in t?t.movementY:Ju}}),Vm=wt(nu),VS=ye({},nu,{dataTransfer:0}),jS=wt(VS),GS=ye({},ia,{relatedTarget:0}),ef=wt(GS),WS=ye({},xs,{animationName:0,elapsedTime:0,pseudoElement:0}),HS=wt(WS),$S=ye({},xs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),YS=wt($S),XS=ye({},xs,{data:0}),jm=wt(XS),ZS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function QS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=KS[t])?!!e[t]:!1}function Tg(){return QS}var JS=ye({},ia,{key:function(t){if(t.key){var e=ZS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Rl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?qS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tg,charCode:function(t){return t.type==="keypress"?Rl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Rl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),eP=wt(JS),tP=ye({},nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gm=wt(tP),nP=ye({},ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tg}),iP=wt(nP),rP=ye({},xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),sP=wt(rP),oP=ye({},nu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),aP=wt(oP),lP=[9,13,27,32],bg=Cn&&"CompositionEvent"in window,ro=null;Cn&&"documentMode"in document&&(ro=document.documentMode);var cP=Cn&&"TextEvent"in window&&!ro,q1=Cn&&(!bg||ro&&8<ro&&11>=ro),Wm=String.fromCharCode(32),Hm=!1;function K1(t,e){switch(t){case"keyup":return lP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Q1(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var br=!1;function uP(t,e){switch(t){case"compositionend":return Q1(e);case"keypress":return e.which!==32?null:(Hm=!0,Wm);case"textInput":return t=e.data,t===Wm&&Hm?null:t;default:return null}}function fP(t,e){if(br)return t==="compositionend"||!bg&&K1(t,e)?(t=Z1(),Il=wg=Jn=null,br=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return q1&&e.locale!=="ko"?null:e.data;default:return null}}var hP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $m(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!hP[t.type]:e==="textarea"}function J1(t,e,n,i){M1(i),e=ac(e,"onChange"),0<e.length&&(n=new Eg("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var so=null,bo=null;function dP(t){ux(t,0)}function iu(t){var e=Ar(t);if(T1(e))return t}function gP(t,e){if(t==="change")return e}var ex=!1;if(Cn){var tf;if(Cn){var nf="oninput"in document;if(!nf){var Ym=document.createElement("div");Ym.setAttribute("oninput","return;"),nf=typeof Ym.oninput=="function"}tf=nf}else tf=!1;ex=tf&&(!document.documentMode||9<document.documentMode)}function Xm(){so&&(so.detachEvent("onpropertychange",tx),bo=so=null)}function tx(t){if(t.propertyName==="value"&&iu(bo)){var e=[];J1(e,bo,t,mg(t)),k1(dP,e)}}function pP(t,e,n){t==="focusin"?(Xm(),so=e,bo=n,so.attachEvent("onpropertychange",tx)):t==="focusout"&&Xm()}function mP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return iu(bo)}function yP(t,e){if(t==="click")return iu(e)}function vP(t,e){if(t==="input"||t==="change")return iu(e)}function _P(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Zt=typeof Object.is=="function"?Object.is:_P;function So(t,e){if(Zt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!mh.call(e,r)||!Zt(t[r],e[r]))return!1}return!0}function Zm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function qm(t,e){var n=Zm(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Zm(n)}}function nx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?nx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ix(){for(var t=window,e=ec();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ec(t.document)}return e}function Sg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function xP(t){var e=ix(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&nx(n.ownerDocument.documentElement,n)){if(i!==null&&Sg(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=qm(n,s);var o=qm(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var wP=Cn&&"documentMode"in document&&11>=document.documentMode,Sr=null,Nh=null,oo=null,Fh=!1;function Km(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Fh||Sr==null||Sr!==ec(i)||(i=Sr,"selectionStart"in i&&Sg(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),oo&&So(oo,i)||(oo=i,i=ac(Nh,"onSelect"),0<i.length&&(e=new Eg("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Sr)))}function Ba(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Pr={animationend:Ba("Animation","AnimationEnd"),animationiteration:Ba("Animation","AnimationIteration"),animationstart:Ba("Animation","AnimationStart"),transitionend:Ba("Transition","TransitionEnd")},rf={},rx={};Cn&&(rx=document.createElement("div").style,"AnimationEvent"in window||(delete Pr.animationend.animation,delete Pr.animationiteration.animation,delete Pr.animationstart.animation),"TransitionEvent"in window||delete Pr.transitionend.transition);function ru(t){if(rf[t])return rf[t];if(!Pr[t])return t;var e=Pr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in rx)return rf[t]=e[n];return t}var sx=ru("animationend"),ox=ru("animationiteration"),ax=ru("animationstart"),lx=ru("transitionend"),cx=new Map,Qm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _i(t,e){cx.set(t,e),tr(e,[t])}for(var sf=0;sf<Qm.length;sf++){var of=Qm[sf],EP=of.toLowerCase(),TP=of[0].toUpperCase()+of.slice(1);_i(EP,"on"+TP)}_i(sx,"onAnimationEnd");_i(ox,"onAnimationIteration");_i(ax,"onAnimationStart");_i("dblclick","onDoubleClick");_i("focusin","onFocus");_i("focusout","onBlur");_i(lx,"onTransitionEnd");Qr("onMouseEnter",["mouseout","mouseover"]);Qr("onMouseLeave",["mouseout","mouseover"]);Qr("onPointerEnter",["pointerout","pointerover"]);Qr("onPointerLeave",["pointerout","pointerover"]);tr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tr("onBeforeInput",["compositionend","keypress","textInput","paste"]);tr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bP=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qs));function Jm(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,ES(i,e,void 0,t),t.currentTarget=null}function ux(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Jm(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Jm(r,a,c),s=l}}}if(nc)throw t=Ih,nc=!1,Ih=null,t}function ae(t,e){var n=e[Vh];n===void 0&&(n=e[Vh]=new Set);var i=t+"__bubble";n.has(i)||(fx(e,t,2,!1),n.add(i))}function af(t,e,n){var i=0;e&&(i|=4),fx(n,t,i,e)}var Ua="_reactListening"+Math.random().toString(36).slice(2);function Po(t){if(!t[Ua]){t[Ua]=!0,v1.forEach(function(n){n!=="selectionchange"&&(bP.has(n)||af(n,!1,t),af(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ua]||(e[Ua]=!0,af("selectionchange",!1,e))}}function fx(t,e,n,i){switch(X1(e)){case 1:var r=zS;break;case 4:r=BS;break;default:r=xg}n=r.bind(null,e,n,t),r=void 0,!Mh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function lf(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Oi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}k1(function(){var c=s,u=mg(n),f=[];e:{var h=cx.get(t);if(h!==void 0){var d=Eg,p=t;switch(t){case"keypress":if(Rl(n)===0)break e;case"keydown":case"keyup":d=eP;break;case"focusin":p="focus",d=ef;break;case"focusout":p="blur",d=ef;break;case"beforeblur":case"afterblur":d=ef;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Vm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=jS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=iP;break;case sx:case ox:case ax:d=HS;break;case lx:d=sP;break;case"scroll":d=US;break;case"wheel":d=aP;break;case"copy":case"cut":case"paste":d=YS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Gm}var _=(e&4)!==0,T=!_&&t==="scroll",y=_?h!==null?h+"Capture":null:h;_=[];for(var m=c,v;m!==null;){v=m;var E=v.stateNode;if(v.tag===5&&E!==null&&(v=E,y!==null&&(E=xo(m,y),E!=null&&_.push(Ao(m,E,v)))),T)break;m=m.return}0<_.length&&(h=new d(h,p,null,n,u),f.push({event:h,listeners:_}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==Lh&&(p=n.relatedTarget||n.fromElement)&&(Oi(p)||p[Mn]))break e;if((d||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=c,p=p?Oi(p):null,p!==null&&(T=nr(p),p!==T||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=c),d!==p)){if(_=Vm,E="onMouseLeave",y="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(_=Gm,E="onPointerLeave",y="onPointerEnter",m="pointer"),T=d==null?h:Ar(d),v=p==null?h:Ar(p),h=new _(E,m+"leave",d,n,u),h.target=T,h.relatedTarget=v,E=null,Oi(u)===c&&(_=new _(y,m+"enter",p,n,u),_.target=v,_.relatedTarget=T,E=_),T=E,d&&p)t:{for(_=d,y=p,m=0,v=_;v;v=ur(v))m++;for(v=0,E=y;E;E=ur(E))v++;for(;0<m-v;)_=ur(_),m--;for(;0<v-m;)y=ur(y),v--;for(;m--;){if(_===y||y!==null&&_===y.alternate)break t;_=ur(_),y=ur(y)}_=null}else _=null;d!==null&&e0(f,h,d,_,!1),p!==null&&T!==null&&e0(f,T,p,_,!0)}}e:{if(h=c?Ar(c):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var S=gP;else if($m(h))if(ex)S=vP;else{S=mP;var P=pP}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=yP);if(S&&(S=S(t,c))){J1(f,S,n,u);break e}P&&P(t,h,c),t==="focusout"&&(P=h._wrapperState)&&P.controlled&&h.type==="number"&&Th(h,"number",h.value)}switch(P=c?Ar(c):window,t){case"focusin":($m(P)||P.contentEditable==="true")&&(Sr=P,Nh=c,oo=null);break;case"focusout":oo=Nh=Sr=null;break;case"mousedown":Fh=!0;break;case"contextmenu":case"mouseup":case"dragend":Fh=!1,Km(f,n,u);break;case"selectionchange":if(wP)break;case"keydown":case"keyup":Km(f,n,u)}var L;if(bg)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else br?K1(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(q1&&n.locale!=="ko"&&(br||C!=="onCompositionStart"?C==="onCompositionEnd"&&br&&(L=Z1()):(Jn=u,wg="value"in Jn?Jn.value:Jn.textContent,br=!0)),P=ac(c,C),0<P.length&&(C=new jm(C,t,null,n,u),f.push({event:C,listeners:P}),L?C.data=L:(L=Q1(n),L!==null&&(C.data=L)))),(L=cP?uP(t,n):fP(t,n))&&(c=ac(c,"onBeforeInput"),0<c.length&&(u=new jm("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=L))}ux(f,e)})}function Ao(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ac(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=xo(t,n),s!=null&&i.unshift(Ao(t,s,r)),s=xo(t,e),s!=null&&i.push(Ao(t,s,r))),t=t.return}return i}function ur(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function e0(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=xo(n,s),l!=null&&o.unshift(Ao(n,l,a))):r||(l=xo(n,s),l!=null&&o.push(Ao(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var SP=/\r\n?/g,PP=/\u0000|\uFFFD/g;function t0(t){return(typeof t=="string"?t:""+t).replace(SP,`
`).replace(PP,"")}function Va(t,e,n){if(e=t0(e),t0(t)!==e&&n)throw Error(O(425))}function lc(){}var Dh=null,zh=null;function Bh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Uh=typeof setTimeout=="function"?setTimeout:void 0,AP=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,LP=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(t){return n0.resolve(null).then(t).catch(CP)}:Uh;function CP(t){setTimeout(function(){throw t})}function cf(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),To(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);To(e)}function ai(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function i0(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ws=Math.random().toString(36).slice(2),ln="__reactFiber$"+ws,Lo="__reactProps$"+ws,Mn="__reactContainer$"+ws,Vh="__reactEvents$"+ws,MP="__reactListeners$"+ws,IP="__reactHandles$"+ws;function Oi(t){var e=t[ln];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Mn]||n[ln]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=i0(t);t!==null;){if(n=t[ln])return n;t=i0(t)}return e}t=n,n=t.parentNode}return null}function ra(t){return t=t[ln]||t[Mn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ar(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function su(t){return t[Lo]||null}var jh=[],Lr=-1;function xi(t){return{current:t}}function ce(t){0>Lr||(t.current=jh[Lr],jh[Lr]=null,Lr--)}function se(t,e){Lr++,jh[Lr]=t.current,t.current=e}var pi={},He=xi(pi),st=xi(!1),ji=pi;function Jr(t,e){var n=t.type.contextTypes;if(!n)return pi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function ot(t){return t=t.childContextTypes,t!=null}function cc(){ce(st),ce(He)}function r0(t,e,n){if(He.current!==pi)throw Error(O(168));se(He,e),se(st,n)}function hx(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(O(108,pS(t)||"Unknown",r));return ye({},n,i)}function uc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pi,ji=He.current,se(He,t),se(st,st.current),!0}function s0(t,e,n){var i=t.stateNode;if(!i)throw Error(O(169));n?(t=hx(t,e,ji),i.__reactInternalMemoizedMergedChildContext=t,ce(st),ce(He),se(He,t)):ce(st),se(st,n)}var wn=null,ou=!1,uf=!1;function dx(t){wn===null?wn=[t]:wn.push(t)}function RP(t){ou=!0,dx(t)}function wi(){if(!uf&&wn!==null){uf=!0;var t=0,e=te;try{var n=wn;for(te=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}wn=null,ou=!1}catch(r){throw wn!==null&&(wn=wn.slice(t+1)),z1(yg,wi),r}finally{te=e,uf=!1}}return null}var Cr=[],Mr=0,fc=null,hc=0,Pt=[],At=0,Gi=null,bn=1,Sn="";function Ci(t,e){Cr[Mr++]=hc,Cr[Mr++]=fc,fc=t,hc=e}function gx(t,e,n){Pt[At++]=bn,Pt[At++]=Sn,Pt[At++]=Gi,Gi=t;var i=bn;t=Sn;var r=32-$t(i)-1;i&=~(1<<r),n+=1;var s=32-$t(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,bn=1<<32-$t(e)+r|n<<r|i,Sn=s+t}else bn=1<<s|n<<r|i,Sn=t}function Pg(t){t.return!==null&&(Ci(t,1),gx(t,1,0))}function Ag(t){for(;t===fc;)fc=Cr[--Mr],Cr[Mr]=null,hc=Cr[--Mr],Cr[Mr]=null;for(;t===Gi;)Gi=Pt[--At],Pt[At]=null,Sn=Pt[--At],Pt[At]=null,bn=Pt[--At],Pt[At]=null}var gt=null,dt=null,fe=!1,Bt=null;function px(t,e){var n=Lt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function o0(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gt=t,dt=ai(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gt=t,dt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Gi!==null?{id:bn,overflow:Sn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Lt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gt=t,dt=null,!0):!1;default:return!1}}function Gh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Wh(t){if(fe){var e=dt;if(e){var n=e;if(!o0(t,e)){if(Gh(t))throw Error(O(418));e=ai(n.nextSibling);var i=gt;e&&o0(t,e)?px(i,n):(t.flags=t.flags&-4097|2,fe=!1,gt=t)}}else{if(Gh(t))throw Error(O(418));t.flags=t.flags&-4097|2,fe=!1,gt=t}}}function a0(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gt=t}function ja(t){if(t!==gt)return!1;if(!fe)return a0(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Bh(t.type,t.memoizedProps)),e&&(e=dt)){if(Gh(t))throw mx(),Error(O(418));for(;e;)px(t,e),e=ai(e.nextSibling)}if(a0(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){dt=ai(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}dt=null}}else dt=gt?ai(t.stateNode.nextSibling):null;return!0}function mx(){for(var t=dt;t;)t=ai(t.nextSibling)}function es(){dt=gt=null,fe=!1}function Lg(t){Bt===null?Bt=[t]:Bt.push(t)}var OP=Dn.ReactCurrentBatchConfig;function Dt(t,e){if(t&&t.defaultProps){e=ye({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var dc=xi(null),gc=null,Ir=null,Cg=null;function Mg(){Cg=Ir=gc=null}function Ig(t){var e=dc.current;ce(dc),t._currentValue=e}function Hh(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function $r(t,e){gc=t,Cg=Ir=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(it=!0),t.firstContext=null)}function It(t){var e=t._currentValue;if(Cg!==t)if(t={context:t,memoizedValue:e,next:null},Ir===null){if(gc===null)throw Error(O(308));Ir=t,gc.dependencies={lanes:0,firstContext:t}}else Ir=Ir.next=t;return e}var ki=null;function Rg(t){ki===null?ki=[t]:ki.push(t)}function yx(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Rg(e)):(n.next=r.next,r.next=n),e.interleaved=n,In(t,i)}function In(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var qn=!1;function Og(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vx(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function An(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function li(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,J&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,In(t,n)}return r=i.interleaved,r===null?(e.next=e,Rg(i)):(e.next=r.next,r.next=e),i.interleaved=e,In(t,n)}function Ol(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,vg(t,n)}}function l0(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function pc(t,e,n,i){var r=t.updateQueue;qn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,_=a;switch(h=e,d=n,_.tag){case 1:if(p=_.payload,typeof p=="function"){f=p.call(d,f,h);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=_.payload,h=typeof p=="function"?p.call(d,f,h):p,h==null)break e;f=ye({},f,h);break e;case 2:qn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=f):u=u.next=d,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=f),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Hi|=o,t.lanes=o,t.memoizedState=f}}function c0(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(O(191,r));r.call(i)}}}var _x=new y1.Component().refs;function $h(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ye({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var au={isMounted:function(t){return(t=t._reactInternals)?nr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=qe(),r=ui(t),s=An(i,r);s.payload=e,n!=null&&(s.callback=n),e=li(t,s,r),e!==null&&(Yt(e,t,r,i),Ol(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=qe(),r=ui(t),s=An(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=li(t,s,r),e!==null&&(Yt(e,t,r,i),Ol(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=qe(),i=ui(t),r=An(n,i);r.tag=2,e!=null&&(r.callback=e),e=li(t,r,i),e!==null&&(Yt(e,t,i,n),Ol(e,t,i))}};function u0(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!So(n,i)||!So(r,s):!0}function xx(t,e,n){var i=!1,r=pi,s=e.contextType;return typeof s=="object"&&s!==null?s=It(s):(r=ot(e)?ji:He.current,i=e.contextTypes,s=(i=i!=null)?Jr(t,r):pi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=au,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function f0(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&au.enqueueReplaceState(e,e.state,null)}function Yh(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=_x,Og(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=It(s):(s=ot(e)?ji:He.current,r.context=Jr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&($h(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&au.enqueueReplaceState(r,r.state,null),pc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Fs(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var i=n.stateNode}if(!i)throw Error(O(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===_x&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function Ga(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function h0(t){var e=t._init;return e(t._payload)}function wx(t){function e(y,m){if(t){var v=y.deletions;v===null?(y.deletions=[m],y.flags|=16):v.push(m)}}function n(y,m){if(!t)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function i(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function r(y,m){return y=fi(y,m),y.index=0,y.sibling=null,y}function s(y,m,v){return y.index=v,t?(v=y.alternate,v!==null?(v=v.index,v<m?(y.flags|=2,m):v):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,m,v,E){return m===null||m.tag!==6?(m=yf(v,y.mode,E),m.return=y,m):(m=r(m,v),m.return=y,m)}function l(y,m,v,E){var S=v.type;return S===Tr?u(y,m,v.props.children,E,v.key):m!==null&&(m.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Zn&&h0(S)===m.type)?(E=r(m,v.props),E.ref=Fs(y,m,v),E.return=y,E):(E=Bl(v.type,v.key,v.props,null,y.mode,E),E.ref=Fs(y,m,v),E.return=y,E)}function c(y,m,v,E){return m===null||m.tag!==4||m.stateNode.containerInfo!==v.containerInfo||m.stateNode.implementation!==v.implementation?(m=vf(v,y.mode,E),m.return=y,m):(m=r(m,v.children||[]),m.return=y,m)}function u(y,m,v,E,S){return m===null||m.tag!==7?(m=Bi(v,y.mode,E,S),m.return=y,m):(m=r(m,v),m.return=y,m)}function f(y,m,v){if(typeof m=="string"&&m!==""||typeof m=="number")return m=yf(""+m,y.mode,v),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ra:return v=Bl(m.type,m.key,m.props,null,y.mode,v),v.ref=Fs(y,null,m),v.return=y,v;case Er:return m=vf(m,y.mode,v),m.return=y,m;case Zn:var E=m._init;return f(y,E(m._payload),v)}if(qs(m)||Is(m))return m=Bi(m,y.mode,v,null),m.return=y,m;Ga(y,m)}return null}function h(y,m,v,E){var S=m!==null?m.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:a(y,m,""+v,E);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ra:return v.key===S?l(y,m,v,E):null;case Er:return v.key===S?c(y,m,v,E):null;case Zn:return S=v._init,h(y,m,S(v._payload),E)}if(qs(v)||Is(v))return S!==null?null:u(y,m,v,E,null);Ga(y,v)}return null}function d(y,m,v,E,S){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(v)||null,a(m,y,""+E,S);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Ra:return y=y.get(E.key===null?v:E.key)||null,l(m,y,E,S);case Er:return y=y.get(E.key===null?v:E.key)||null,c(m,y,E,S);case Zn:var P=E._init;return d(y,m,v,P(E._payload),S)}if(qs(E)||Is(E))return y=y.get(v)||null,u(m,y,E,S,null);Ga(m,E)}return null}function p(y,m,v,E){for(var S=null,P=null,L=m,C=m=0,M=null;L!==null&&C<v.length;C++){L.index>C?(M=L,L=null):M=L.sibling;var I=h(y,L,v[C],E);if(I===null){L===null&&(L=M);break}t&&L&&I.alternate===null&&e(y,L),m=s(I,m,C),P===null?S=I:P.sibling=I,P=I,L=M}if(C===v.length)return n(y,L),fe&&Ci(y,C),S;if(L===null){for(;C<v.length;C++)L=f(y,v[C],E),L!==null&&(m=s(L,m,C),P===null?S=L:P.sibling=L,P=L);return fe&&Ci(y,C),S}for(L=i(y,L);C<v.length;C++)M=d(L,y,C,v[C],E),M!==null&&(t&&M.alternate!==null&&L.delete(M.key===null?C:M.key),m=s(M,m,C),P===null?S=M:P.sibling=M,P=M);return t&&L.forEach(function(k){return e(y,k)}),fe&&Ci(y,C),S}function _(y,m,v,E){var S=Is(v);if(typeof S!="function")throw Error(O(150));if(v=S.call(v),v==null)throw Error(O(151));for(var P=S=null,L=m,C=m=0,M=null,I=v.next();L!==null&&!I.done;C++,I=v.next()){L.index>C?(M=L,L=null):M=L.sibling;var k=h(y,L,I.value,E);if(k===null){L===null&&(L=M);break}t&&L&&k.alternate===null&&e(y,L),m=s(k,m,C),P===null?S=k:P.sibling=k,P=k,L=M}if(I.done)return n(y,L),fe&&Ci(y,C),S;if(L===null){for(;!I.done;C++,I=v.next())I=f(y,I.value,E),I!==null&&(m=s(I,m,C),P===null?S=I:P.sibling=I,P=I);return fe&&Ci(y,C),S}for(L=i(y,L);!I.done;C++,I=v.next())I=d(L,y,C,I.value,E),I!==null&&(t&&I.alternate!==null&&L.delete(I.key===null?C:I.key),m=s(I,m,C),P===null?S=I:P.sibling=I,P=I);return t&&L.forEach(function(W){return e(y,W)}),fe&&Ci(y,C),S}function T(y,m,v,E){if(typeof v=="object"&&v!==null&&v.type===Tr&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ra:e:{for(var S=v.key,P=m;P!==null;){if(P.key===S){if(S=v.type,S===Tr){if(P.tag===7){n(y,P.sibling),m=r(P,v.props.children),m.return=y,y=m;break e}}else if(P.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Zn&&h0(S)===P.type){n(y,P.sibling),m=r(P,v.props),m.ref=Fs(y,P,v),m.return=y,y=m;break e}n(y,P);break}else e(y,P);P=P.sibling}v.type===Tr?(m=Bi(v.props.children,y.mode,E,v.key),m.return=y,y=m):(E=Bl(v.type,v.key,v.props,null,y.mode,E),E.ref=Fs(y,m,v),E.return=y,y=E)}return o(y);case Er:e:{for(P=v.key;m!==null;){if(m.key===P)if(m.tag===4&&m.stateNode.containerInfo===v.containerInfo&&m.stateNode.implementation===v.implementation){n(y,m.sibling),m=r(m,v.children||[]),m.return=y,y=m;break e}else{n(y,m);break}else e(y,m);m=m.sibling}m=vf(v,y.mode,E),m.return=y,y=m}return o(y);case Zn:return P=v._init,T(y,m,P(v._payload),E)}if(qs(v))return p(y,m,v,E);if(Is(v))return _(y,m,v,E);Ga(y,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,m!==null&&m.tag===6?(n(y,m.sibling),m=r(m,v),m.return=y,y=m):(n(y,m),m=yf(v,y.mode,E),m.return=y,y=m),o(y)):n(y,m)}return T}var ts=wx(!0),Ex=wx(!1),sa={},fn=xi(sa),Co=xi(sa),Mo=xi(sa);function Ni(t){if(t===sa)throw Error(O(174));return t}function kg(t,e){switch(se(Mo,e),se(Co,t),se(fn,sa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Sh(e,t)}ce(fn),se(fn,e)}function ns(){ce(fn),ce(Co),ce(Mo)}function Tx(t){Ni(Mo.current);var e=Ni(fn.current),n=Sh(e,t.type);e!==n&&(se(Co,t),se(fn,n))}function Ng(t){Co.current===t&&(ce(fn),ce(Co))}var de=xi(0);function mc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ff=[];function Fg(){for(var t=0;t<ff.length;t++)ff[t]._workInProgressVersionPrimary=null;ff.length=0}var kl=Dn.ReactCurrentDispatcher,hf=Dn.ReactCurrentBatchConfig,Wi=0,me=null,Se=null,Ce=null,yc=!1,ao=!1,Io=0,kP=0;function ze(){throw Error(O(321))}function Dg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Zt(t[n],e[n]))return!1;return!0}function zg(t,e,n,i,r,s){if(Wi=s,me=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,kl.current=t===null||t.memoizedState===null?zP:BP,t=n(i,r),ao){s=0;do{if(ao=!1,Io=0,25<=s)throw Error(O(301));s+=1,Ce=Se=null,e.updateQueue=null,kl.current=UP,t=n(i,r)}while(ao)}if(kl.current=vc,e=Se!==null&&Se.next!==null,Wi=0,Ce=Se=me=null,yc=!1,e)throw Error(O(300));return t}function Bg(){var t=Io!==0;return Io=0,t}function an(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ce===null?me.memoizedState=Ce=t:Ce=Ce.next=t,Ce}function Rt(){if(Se===null){var t=me.alternate;t=t!==null?t.memoizedState:null}else t=Se.next;var e=Ce===null?me.memoizedState:Ce.next;if(e!==null)Ce=e,Se=t;else{if(t===null)throw Error(O(310));Se=t,t={memoizedState:Se.memoizedState,baseState:Se.baseState,baseQueue:Se.baseQueue,queue:Se.queue,next:null},Ce===null?me.memoizedState=Ce=t:Ce=Ce.next=t}return Ce}function Ro(t,e){return typeof e=="function"?e(t):e}function df(t){var e=Rt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=Se,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Wi&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,me.lanes|=u,Hi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Zt(i,e.memoizedState)||(it=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,me.lanes|=s,Hi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function gf(t){var e=Rt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Zt(s,e.memoizedState)||(it=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function bx(){}function Sx(t,e){var n=me,i=Rt(),r=e(),s=!Zt(i.memoizedState,r);if(s&&(i.memoizedState=r,it=!0),i=i.queue,Ug(Lx.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Ce!==null&&Ce.memoizedState.tag&1){if(n.flags|=2048,Oo(9,Ax.bind(null,n,i,r,e),void 0,null),Ie===null)throw Error(O(349));Wi&30||Px(n,e,r)}return r}function Px(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Ax(t,e,n,i){e.value=n,e.getSnapshot=i,Cx(e)&&Mx(t)}function Lx(t,e,n){return n(function(){Cx(e)&&Mx(t)})}function Cx(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Zt(t,n)}catch{return!0}}function Mx(t){var e=In(t,1);e!==null&&Yt(e,t,1,-1)}function d0(t){var e=an();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ro,lastRenderedState:t},e.queue=t,t=t.dispatch=DP.bind(null,me,t),[e.memoizedState,t]}function Oo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Ix(){return Rt().memoizedState}function Nl(t,e,n,i){var r=an();me.flags|=t,r.memoizedState=Oo(1|e,n,void 0,i===void 0?null:i)}function lu(t,e,n,i){var r=Rt();i=i===void 0?null:i;var s=void 0;if(Se!==null){var o=Se.memoizedState;if(s=o.destroy,i!==null&&Dg(i,o.deps)){r.memoizedState=Oo(e,n,s,i);return}}me.flags|=t,r.memoizedState=Oo(1|e,n,s,i)}function g0(t,e){return Nl(8390656,8,t,e)}function Ug(t,e){return lu(2048,8,t,e)}function Rx(t,e){return lu(4,2,t,e)}function Ox(t,e){return lu(4,4,t,e)}function kx(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Nx(t,e,n){return n=n!=null?n.concat([t]):null,lu(4,4,kx.bind(null,e,t),n)}function Vg(){}function Fx(t,e){var n=Rt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Dg(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Dx(t,e){var n=Rt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Dg(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function zx(t,e,n){return Wi&21?(Zt(n,e)||(n=V1(),me.lanes|=n,Hi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,it=!0),t.memoizedState=n)}function NP(t,e){var n=te;te=n!==0&&4>n?n:4,t(!0);var i=hf.transition;hf.transition={};try{t(!1),e()}finally{te=n,hf.transition=i}}function Bx(){return Rt().memoizedState}function FP(t,e,n){var i=ui(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ux(t))Vx(e,n);else if(n=yx(t,e,n,i),n!==null){var r=qe();Yt(n,t,i,r),jx(n,e,i)}}function DP(t,e,n){var i=ui(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ux(t))Vx(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Zt(a,o)){var l=e.interleaved;l===null?(r.next=r,Rg(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=yx(t,e,r,i),n!==null&&(r=qe(),Yt(n,t,i,r),jx(n,e,i))}}function Ux(t){var e=t.alternate;return t===me||e!==null&&e===me}function Vx(t,e){ao=yc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function jx(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,vg(t,n)}}var vc={readContext:It,useCallback:ze,useContext:ze,useEffect:ze,useImperativeHandle:ze,useInsertionEffect:ze,useLayoutEffect:ze,useMemo:ze,useReducer:ze,useRef:ze,useState:ze,useDebugValue:ze,useDeferredValue:ze,useTransition:ze,useMutableSource:ze,useSyncExternalStore:ze,useId:ze,unstable_isNewReconciler:!1},zP={readContext:It,useCallback:function(t,e){return an().memoizedState=[t,e===void 0?null:e],t},useContext:It,useEffect:g0,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Nl(4194308,4,kx.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Nl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Nl(4,2,t,e)},useMemo:function(t,e){var n=an();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=an();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=FP.bind(null,me,t),[i.memoizedState,t]},useRef:function(t){var e=an();return t={current:t},e.memoizedState=t},useState:d0,useDebugValue:Vg,useDeferredValue:function(t){return an().memoizedState=t},useTransition:function(){var t=d0(!1),e=t[0];return t=NP.bind(null,t[1]),an().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=me,r=an();if(fe){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ie===null)throw Error(O(349));Wi&30||Px(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,g0(Lx.bind(null,i,s,t),[t]),i.flags|=2048,Oo(9,Ax.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=an(),e=Ie.identifierPrefix;if(fe){var n=Sn,i=bn;n=(i&~(1<<32-$t(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Io++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},BP={readContext:It,useCallback:Fx,useContext:It,useEffect:Ug,useImperativeHandle:Nx,useInsertionEffect:Rx,useLayoutEffect:Ox,useMemo:Dx,useReducer:df,useRef:Ix,useState:function(){return df(Ro)},useDebugValue:Vg,useDeferredValue:function(t){var e=Rt();return zx(e,Se.memoizedState,t)},useTransition:function(){var t=df(Ro)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:bx,useSyncExternalStore:Sx,useId:Bx,unstable_isNewReconciler:!1},UP={readContext:It,useCallback:Fx,useContext:It,useEffect:Ug,useImperativeHandle:Nx,useInsertionEffect:Rx,useLayoutEffect:Ox,useMemo:Dx,useReducer:gf,useRef:Ix,useState:function(){return gf(Ro)},useDebugValue:Vg,useDeferredValue:function(t){var e=Rt();return Se===null?e.memoizedState=t:zx(e,Se.memoizedState,t)},useTransition:function(){var t=gf(Ro)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:bx,useSyncExternalStore:Sx,useId:Bx,unstable_isNewReconciler:!1};function is(t,e){try{var n="",i=e;do n+=gS(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function pf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Xh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var VP=typeof WeakMap=="function"?WeakMap:Map;function Gx(t,e,n){n=An(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){xc||(xc=!0,rd=i),Xh(t,e)},n}function Wx(t,e,n){n=An(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Xh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Xh(t,e),typeof i!="function"&&(ci===null?ci=new Set([this]):ci.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function p0(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new VP;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=tA.bind(null,t,e,n),e.then(t,t))}function m0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function y0(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=An(-1,1),e.tag=2,li(n,e,1))),n.lanes|=1),t)}var jP=Dn.ReactCurrentOwner,it=!1;function Ye(t,e,n,i){e.child=t===null?Ex(e,null,n,i):ts(e,t.child,n,i)}function v0(t,e,n,i,r){n=n.render;var s=e.ref;return $r(e,r),i=zg(t,e,n,i,s,r),n=Bg(),t!==null&&!it?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Rn(t,e,r)):(fe&&n&&Pg(e),e.flags|=1,Ye(t,e,i,r),e.child)}function _0(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Zg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Hx(t,e,s,i,r)):(t=Bl(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:So,n(o,i)&&t.ref===e.ref)return Rn(t,e,r)}return e.flags|=1,t=fi(s,i),t.ref=e.ref,t.return=e,e.child=t}function Hx(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(So(s,i)&&t.ref===e.ref)if(it=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(it=!0);else return e.lanes=t.lanes,Rn(t,e,r)}return Zh(t,e,n,i,r)}function $x(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},se(Or,ft),ft|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,se(Or,ft),ft|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,se(Or,ft),ft|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,se(Or,ft),ft|=i;return Ye(t,e,r,n),e.child}function Yx(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Zh(t,e,n,i,r){var s=ot(n)?ji:He.current;return s=Jr(e,s),$r(e,r),n=zg(t,e,n,i,s,r),i=Bg(),t!==null&&!it?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Rn(t,e,r)):(fe&&i&&Pg(e),e.flags|=1,Ye(t,e,n,r),e.child)}function x0(t,e,n,i,r){if(ot(n)){var s=!0;uc(e)}else s=!1;if($r(e,r),e.stateNode===null)Fl(t,e),xx(e,n,i),Yh(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=It(c):(c=ot(n)?ji:He.current,c=Jr(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&f0(e,o,i,c),qn=!1;var h=e.memoizedState;o.state=h,pc(e,i,o,r),l=e.memoizedState,a!==i||h!==l||st.current||qn?(typeof u=="function"&&($h(e,n,u,i),l=e.memoizedState),(a=qn||u0(e,n,a,i,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,vx(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Dt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=It(l):(l=ot(n)?ji:He.current,l=Jr(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&f0(e,o,i,l),qn=!1,h=e.memoizedState,o.state=h,pc(e,i,o,r);var p=e.memoizedState;a!==f||h!==p||st.current||qn?(typeof d=="function"&&($h(e,n,d,i),p=e.memoizedState),(c=qn||u0(e,n,c,i,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return qh(t,e,n,i,s,r)}function qh(t,e,n,i,r,s){Yx(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&s0(e,n,!1),Rn(t,e,s);i=e.stateNode,jP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=ts(e,t.child,null,s),e.child=ts(e,null,a,s)):Ye(t,e,a,s),e.memoizedState=i.state,r&&s0(e,n,!0),e.child}function Xx(t){var e=t.stateNode;e.pendingContext?r0(t,e.pendingContext,e.pendingContext!==e.context):e.context&&r0(t,e.context,!1),kg(t,e.containerInfo)}function w0(t,e,n,i,r){return es(),Lg(r),e.flags|=256,Ye(t,e,n,i),e.child}var Kh={dehydrated:null,treeContext:null,retryLane:0};function Qh(t){return{baseLanes:t,cachePool:null,transitions:null}}function Zx(t,e,n){var i=e.pendingProps,r=de.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),se(de,r&1),t===null)return Wh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=fu(o,i,0,null),t=Bi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Qh(n),e.memoizedState=Kh,t):jg(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return GP(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=fi(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=fi(a,s):(s=Bi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Qh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Kh,i}return s=t.child,t=s.sibling,i=fi(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function jg(t,e){return e=fu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Wa(t,e,n,i){return i!==null&&Lg(i),ts(e,t.child,null,n),t=jg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function GP(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=pf(Error(O(422))),Wa(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=fu({mode:"visible",children:i.children},r,0,null),s=Bi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&ts(e,t.child,null,o),e.child.memoizedState=Qh(o),e.memoizedState=Kh,s);if(!(e.mode&1))return Wa(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(O(419)),i=pf(s,i,void 0),Wa(t,e,o,i)}if(a=(o&t.childLanes)!==0,it||a){if(i=Ie,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,In(t,r),Yt(i,t,r,-1))}return Xg(),i=pf(Error(O(421))),Wa(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=nA.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,dt=ai(r.nextSibling),gt=e,fe=!0,Bt=null,t!==null&&(Pt[At++]=bn,Pt[At++]=Sn,Pt[At++]=Gi,bn=t.id,Sn=t.overflow,Gi=e),e=jg(e,i.children),e.flags|=4096,e)}function E0(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Hh(t.return,e,n)}function mf(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function qx(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ye(t,e,i.children,n),i=de.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&E0(t,n,e);else if(t.tag===19)E0(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(se(de,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&mc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),mf(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&mc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}mf(e,!0,n,null,s);break;case"together":mf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Rn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Hi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=fi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=fi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function WP(t,e,n){switch(e.tag){case 3:Xx(e),es();break;case 5:Tx(e);break;case 1:ot(e.type)&&uc(e);break;case 4:kg(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;se(dc,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(se(de,de.current&1),e.flags|=128,null):n&e.child.childLanes?Zx(t,e,n):(se(de,de.current&1),t=Rn(t,e,n),t!==null?t.sibling:null);se(de,de.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return qx(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),se(de,de.current),i)break;return null;case 22:case 23:return e.lanes=0,$x(t,e,n)}return Rn(t,e,n)}var Kx,Jh,Qx,Jx;Kx=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Jh=function(){};Qx=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ni(fn.current);var s=null;switch(n){case"input":r=wh(t,r),i=wh(t,i),s=[];break;case"select":r=ye({},r,{value:void 0}),i=ye({},i,{value:void 0}),s=[];break;case"textarea":r=bh(t,r),i=bh(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=lc)}Ph(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(vo.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(vo.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ae("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Jx=function(t,e,n,i){n!==i&&(e.flags|=4)};function Ds(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Be(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function HP(t,e,n){var i=e.pendingProps;switch(Ag(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Be(e),null;case 1:return ot(e.type)&&cc(),Be(e),null;case 3:return i=e.stateNode,ns(),ce(st),ce(He),Fg(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(ja(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bt!==null&&(ad(Bt),Bt=null))),Jh(t,e),Be(e),null;case 5:Ng(e);var r=Ni(Mo.current);if(n=e.type,t!==null&&e.stateNode!=null)Qx(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(O(166));return Be(e),null}if(t=Ni(fn.current),ja(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[ln]=e,i[Lo]=s,t=(e.mode&1)!==0,n){case"dialog":ae("cancel",i),ae("close",i);break;case"iframe":case"object":case"embed":ae("load",i);break;case"video":case"audio":for(r=0;r<Qs.length;r++)ae(Qs[r],i);break;case"source":ae("error",i);break;case"img":case"image":case"link":ae("error",i),ae("load",i);break;case"details":ae("toggle",i);break;case"input":Im(i,s),ae("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ae("invalid",i);break;case"textarea":Om(i,s),ae("invalid",i)}Ph(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Va(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Va(i.textContent,a,t),r=["children",""+a]):vo.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ae("scroll",i)}switch(n){case"input":Oa(i),Rm(i,s,!0);break;case"textarea":Oa(i),km(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=lc)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=P1(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[ln]=e,t[Lo]=i,Kx(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ah(n,i),n){case"dialog":ae("cancel",t),ae("close",t),r=i;break;case"iframe":case"object":case"embed":ae("load",t),r=i;break;case"video":case"audio":for(r=0;r<Qs.length;r++)ae(Qs[r],t);r=i;break;case"source":ae("error",t),r=i;break;case"img":case"image":case"link":ae("error",t),ae("load",t),r=i;break;case"details":ae("toggle",t),r=i;break;case"input":Im(t,i),r=wh(t,i),ae("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ye({},i,{value:void 0}),ae("invalid",t);break;case"textarea":Om(t,i),r=bh(t,i),ae("invalid",t);break;default:r=i}Ph(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?C1(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&A1(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&_o(t,l):typeof l=="number"&&_o(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(vo.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ae("scroll",t):l!=null&&hg(t,s,l,o))}switch(n){case"input":Oa(t),Rm(t,i,!1);break;case"textarea":Oa(t),km(t);break;case"option":i.value!=null&&t.setAttribute("value",""+gi(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?jr(t,!!i.multiple,s,!1):i.defaultValue!=null&&jr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=lc)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Be(e),null;case 6:if(t&&e.stateNode!=null)Jx(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(O(166));if(n=Ni(Mo.current),Ni(fn.current),ja(e)){if(i=e.stateNode,n=e.memoizedProps,i[ln]=e,(s=i.nodeValue!==n)&&(t=gt,t!==null))switch(t.tag){case 3:Va(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Va(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ln]=e,e.stateNode=i}return Be(e),null;case 13:if(ce(de),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&dt!==null&&e.mode&1&&!(e.flags&128))mx(),es(),e.flags|=98560,s=!1;else if(s=ja(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[ln]=e}else es(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Be(e),s=!1}else Bt!==null&&(ad(Bt),Bt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||de.current&1?Pe===0&&(Pe=3):Xg())),e.updateQueue!==null&&(e.flags|=4),Be(e),null);case 4:return ns(),Jh(t,e),t===null&&Po(e.stateNode.containerInfo),Be(e),null;case 10:return Ig(e.type._context),Be(e),null;case 17:return ot(e.type)&&cc(),Be(e),null;case 19:if(ce(de),s=e.memoizedState,s===null)return Be(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Ds(s,!1);else{if(Pe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=mc(t),o!==null){for(e.flags|=128,Ds(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return se(de,de.current&1|2),e.child}t=t.sibling}s.tail!==null&&xe()>rs&&(e.flags|=128,i=!0,Ds(s,!1),e.lanes=4194304)}else{if(!i)if(t=mc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ds(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return Be(e),null}else 2*xe()-s.renderingStartTime>rs&&n!==1073741824&&(e.flags|=128,i=!0,Ds(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=xe(),e.sibling=null,n=de.current,se(de,i?n&1|2:n&1),e):(Be(e),null);case 22:case 23:return Yg(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ft&1073741824&&(Be(e),e.subtreeFlags&6&&(e.flags|=8192)):Be(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function $P(t,e){switch(Ag(e),e.tag){case 1:return ot(e.type)&&cc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ns(),ce(st),ce(He),Fg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ng(e),null;case 13:if(ce(de),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));es()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ce(de),null;case 4:return ns(),null;case 10:return Ig(e.type._context),null;case 22:case 23:return Yg(),null;case 24:return null;default:return null}}var Ha=!1,Ge=!1,YP=typeof WeakSet=="function"?WeakSet:Set,U=null;function Rr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){_e(t,e,i)}else n.current=null}function ed(t,e,n){try{n()}catch(i){_e(t,e,i)}}var T0=!1;function XP(t,e){if(Dh=sc,t=ix(),Sg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var d;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(zh={focusedElem:t,selectionRange:n},sc=!1,U=e;U!==null;)if(e=U,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,U=t;else for(;U!==null;){e=U;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var _=p.memoizedProps,T=p.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?_:Dt(e.type,_),T);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(E){_e(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,U=t;break}U=e.return}return p=T0,T0=!1,p}function lo(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&ed(e,n,s)}r=r.next}while(r!==i)}}function cu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function td(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ew(t){var e=t.alternate;e!==null&&(t.alternate=null,ew(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ln],delete e[Lo],delete e[Vh],delete e[MP],delete e[IP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function tw(t){return t.tag===5||t.tag===3||t.tag===4}function b0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||tw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function nd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=lc));else if(i!==4&&(t=t.child,t!==null))for(nd(t,e,n),t=t.sibling;t!==null;)nd(t,e,n),t=t.sibling}function id(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(id(t,e,n),t=t.sibling;t!==null;)id(t,e,n),t=t.sibling}var ke=null,zt=!1;function jn(t,e,n){for(n=n.child;n!==null;)nw(t,e,n),n=n.sibling}function nw(t,e,n){if(un&&typeof un.onCommitFiberUnmount=="function")try{un.onCommitFiberUnmount(tu,n)}catch{}switch(n.tag){case 5:Ge||Rr(n,e);case 6:var i=ke,r=zt;ke=null,jn(t,e,n),ke=i,zt=r,ke!==null&&(zt?(t=ke,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ke.removeChild(n.stateNode));break;case 18:ke!==null&&(zt?(t=ke,n=n.stateNode,t.nodeType===8?cf(t.parentNode,n):t.nodeType===1&&cf(t,n),To(t)):cf(ke,n.stateNode));break;case 4:i=ke,r=zt,ke=n.stateNode.containerInfo,zt=!0,jn(t,e,n),ke=i,zt=r;break;case 0:case 11:case 14:case 15:if(!Ge&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ed(n,e,o),r=r.next}while(r!==i)}jn(t,e,n);break;case 1:if(!Ge&&(Rr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){_e(n,e,a)}jn(t,e,n);break;case 21:jn(t,e,n);break;case 22:n.mode&1?(Ge=(i=Ge)||n.memoizedState!==null,jn(t,e,n),Ge=i):jn(t,e,n);break;default:jn(t,e,n)}}function S0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new YP),e.forEach(function(i){var r=iA.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Ft(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ke=a.stateNode,zt=!1;break e;case 3:ke=a.stateNode.containerInfo,zt=!0;break e;case 4:ke=a.stateNode.containerInfo,zt=!0;break e}a=a.return}if(ke===null)throw Error(O(160));nw(s,o,r),ke=null,zt=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){_e(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)iw(e,t),e=e.sibling}function iw(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ft(e,t),tn(t),i&4){try{lo(3,t,t.return),cu(3,t)}catch(_){_e(t,t.return,_)}try{lo(5,t,t.return)}catch(_){_e(t,t.return,_)}}break;case 1:Ft(e,t),tn(t),i&512&&n!==null&&Rr(n,n.return);break;case 5:if(Ft(e,t),tn(t),i&512&&n!==null&&Rr(n,n.return),t.flags&32){var r=t.stateNode;try{_o(r,"")}catch(_){_e(t,t.return,_)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&b1(r,s),Ah(a,o);var c=Ah(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?C1(r,f):u==="dangerouslySetInnerHTML"?A1(r,f):u==="children"?_o(r,f):hg(r,u,f,c)}switch(a){case"input":Eh(r,s);break;case"textarea":S1(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?jr(r,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?jr(r,!!s.multiple,s.defaultValue,!0):jr(r,!!s.multiple,s.multiple?[]:"",!1))}r[Lo]=s}catch(_){_e(t,t.return,_)}}break;case 6:if(Ft(e,t),tn(t),i&4){if(t.stateNode===null)throw Error(O(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(_){_e(t,t.return,_)}}break;case 3:if(Ft(e,t),tn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{To(e.containerInfo)}catch(_){_e(t,t.return,_)}break;case 4:Ft(e,t),tn(t);break;case 13:Ft(e,t),tn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Hg=xe())),i&4&&S0(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ge=(c=Ge)||u,Ft(e,t),Ge=c):Ft(e,t),tn(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(U=t,u=t.child;u!==null;){for(f=U=u;U!==null;){switch(h=U,d=h.child,h.tag){case 0:case 11:case 14:case 15:lo(4,h,h.return);break;case 1:Rr(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(_){_e(i,n,_)}}break;case 5:Rr(h,h.return);break;case 22:if(h.memoizedState!==null){A0(f);continue}}d!==null?(d.return=h,U=d):A0(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{r=f.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=L1("display",o))}catch(_){_e(t,t.return,_)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(_){_e(t,t.return,_)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ft(e,t),tn(t),i&4&&S0(t);break;case 21:break;default:Ft(e,t),tn(t)}}function tn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(tw(n)){var i=n;break e}n=n.return}throw Error(O(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(_o(r,""),i.flags&=-33);var s=b0(t);id(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=b0(t);nd(t,a,o);break;default:throw Error(O(161))}}catch(l){_e(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function ZP(t,e,n){U=t,rw(t)}function rw(t,e,n){for(var i=(t.mode&1)!==0;U!==null;){var r=U,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Ha;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Ge;a=Ha;var c=Ge;if(Ha=o,(Ge=l)&&!c)for(U=r;U!==null;)o=U,l=o.child,o.tag===22&&o.memoizedState!==null?L0(r):l!==null?(l.return=o,U=l):L0(r);for(;s!==null;)U=s,rw(s),s=s.sibling;U=r,Ha=a,Ge=c}P0(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,U=s):P0(t)}}function P0(t){for(;U!==null;){var e=U;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ge||cu(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ge)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Dt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&c0(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}c0(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&To(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}Ge||e.flags&512&&td(e)}catch(h){_e(e,e.return,h)}}if(e===t){U=null;break}if(n=e.sibling,n!==null){n.return=e.return,U=n;break}U=e.return}}function A0(t){for(;U!==null;){var e=U;if(e===t){U=null;break}var n=e.sibling;if(n!==null){n.return=e.return,U=n;break}U=e.return}}function L0(t){for(;U!==null;){var e=U;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{cu(4,e)}catch(l){_e(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){_e(e,r,l)}}var s=e.return;try{td(e)}catch(l){_e(e,s,l)}break;case 5:var o=e.return;try{td(e)}catch(l){_e(e,o,l)}}}catch(l){_e(e,e.return,l)}if(e===t){U=null;break}var a=e.sibling;if(a!==null){a.return=e.return,U=a;break}U=e.return}}var qP=Math.ceil,_c=Dn.ReactCurrentDispatcher,Gg=Dn.ReactCurrentOwner,Ct=Dn.ReactCurrentBatchConfig,J=0,Ie=null,Te=null,Fe=0,ft=0,Or=xi(0),Pe=0,ko=null,Hi=0,uu=0,Wg=0,co=null,nt=null,Hg=0,rs=1/0,xn=null,xc=!1,rd=null,ci=null,$a=!1,ei=null,wc=0,uo=0,sd=null,Dl=-1,zl=0;function qe(){return J&6?xe():Dl!==-1?Dl:Dl=xe()}function ui(t){return t.mode&1?J&2&&Fe!==0?Fe&-Fe:OP.transition!==null?(zl===0&&(zl=V1()),zl):(t=te,t!==0||(t=window.event,t=t===void 0?16:X1(t.type)),t):1}function Yt(t,e,n,i){if(50<uo)throw uo=0,sd=null,Error(O(185));na(t,n,i),(!(J&2)||t!==Ie)&&(t===Ie&&(!(J&2)&&(uu|=n),Pe===4&&Qn(t,Fe)),at(t,i),n===1&&J===0&&!(e.mode&1)&&(rs=xe()+500,ou&&wi()))}function at(t,e){var n=t.callbackNode;OS(t,e);var i=rc(t,t===Ie?Fe:0);if(i===0)n!==null&&Dm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Dm(n),e===1)t.tag===0?RP(C0.bind(null,t)):dx(C0.bind(null,t)),LP(function(){!(J&6)&&wi()}),n=null;else{switch(j1(i)){case 1:n=yg;break;case 4:n=B1;break;case 16:n=ic;break;case 536870912:n=U1;break;default:n=ic}n=hw(n,sw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function sw(t,e){if(Dl=-1,zl=0,J&6)throw Error(O(327));var n=t.callbackNode;if(Yr()&&t.callbackNode!==n)return null;var i=rc(t,t===Ie?Fe:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ec(t,i);else{e=i;var r=J;J|=2;var s=aw();(Ie!==t||Fe!==e)&&(xn=null,rs=xe()+500,zi(t,e));do try{JP();break}catch(a){ow(t,a)}while(1);Mg(),_c.current=s,J=r,Te!==null?e=0:(Ie=null,Fe=0,e=Pe)}if(e!==0){if(e===2&&(r=Rh(t),r!==0&&(i=r,e=od(t,r))),e===1)throw n=ko,zi(t,0),Qn(t,i),at(t,xe()),n;if(e===6)Qn(t,i);else{if(r=t.current.alternate,!(i&30)&&!KP(r)&&(e=Ec(t,i),e===2&&(s=Rh(t),s!==0&&(i=s,e=od(t,s))),e===1))throw n=ko,zi(t,0),Qn(t,i),at(t,xe()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(O(345));case 2:Mi(t,nt,xn);break;case 3:if(Qn(t,i),(i&130023424)===i&&(e=Hg+500-xe(),10<e)){if(rc(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){qe(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Uh(Mi.bind(null,t,nt,xn),e);break}Mi(t,nt,xn);break;case 4:if(Qn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-$t(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=xe()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*qP(i/1960))-i,10<i){t.timeoutHandle=Uh(Mi.bind(null,t,nt,xn),i);break}Mi(t,nt,xn);break;case 5:Mi(t,nt,xn);break;default:throw Error(O(329))}}}return at(t,xe()),t.callbackNode===n?sw.bind(null,t):null}function od(t,e){var n=co;return t.current.memoizedState.isDehydrated&&(zi(t,e).flags|=256),t=Ec(t,e),t!==2&&(e=nt,nt=n,e!==null&&ad(e)),t}function ad(t){nt===null?nt=t:nt.push.apply(nt,t)}function KP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Zt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qn(t,e){for(e&=~Wg,e&=~uu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-$t(e),i=1<<n;t[n]=-1,e&=~i}}function C0(t){if(J&6)throw Error(O(327));Yr();var e=rc(t,0);if(!(e&1))return at(t,xe()),null;var n=Ec(t,e);if(t.tag!==0&&n===2){var i=Rh(t);i!==0&&(e=i,n=od(t,i))}if(n===1)throw n=ko,zi(t,0),Qn(t,e),at(t,xe()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Mi(t,nt,xn),at(t,xe()),null}function $g(t,e){var n=J;J|=1;try{return t(e)}finally{J=n,J===0&&(rs=xe()+500,ou&&wi())}}function $i(t){ei!==null&&ei.tag===0&&!(J&6)&&Yr();var e=J;J|=1;var n=Ct.transition,i=te;try{if(Ct.transition=null,te=1,t)return t()}finally{te=i,Ct.transition=n,J=e,!(J&6)&&wi()}}function Yg(){ft=Or.current,ce(Or)}function zi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,AP(n)),Te!==null)for(n=Te.return;n!==null;){var i=n;switch(Ag(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&cc();break;case 3:ns(),ce(st),ce(He),Fg();break;case 5:Ng(i);break;case 4:ns();break;case 13:ce(de);break;case 19:ce(de);break;case 10:Ig(i.type._context);break;case 22:case 23:Yg()}n=n.return}if(Ie=t,Te=t=fi(t.current,null),Fe=ft=e,Pe=0,ko=null,Wg=uu=Hi=0,nt=co=null,ki!==null){for(e=0;e<ki.length;e++)if(n=ki[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}ki=null}return t}function ow(t,e){do{var n=Te;try{if(Mg(),kl.current=vc,yc){for(var i=me.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}yc=!1}if(Wi=0,Ce=Se=me=null,ao=!1,Io=0,Gg.current=null,n===null||n.return===null){Pe=1,ko=e,Te=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Fe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=m0(o);if(d!==null){d.flags&=-257,y0(d,o,a,s,e),d.mode&1&&p0(s,c,e),e=d,l=c;var p=e.updateQueue;if(p===null){var _=new Set;_.add(l),e.updateQueue=_}else p.add(l);break e}else{if(!(e&1)){p0(s,c,e),Xg();break e}l=Error(O(426))}}else if(fe&&a.mode&1){var T=m0(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),y0(T,o,a,s,e),Lg(is(l,a));break e}}s=l=is(l,a),Pe!==4&&(Pe=2),co===null?co=[s]:co.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=Gx(s,l,e);l0(s,y);break e;case 1:a=l;var m=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(ci===null||!ci.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=Wx(s,a,e);l0(s,E);break e}}s=s.return}while(s!==null)}cw(n)}catch(S){e=S,Te===n&&n!==null&&(Te=n=n.return);continue}break}while(1)}function aw(){var t=_c.current;return _c.current=vc,t===null?vc:t}function Xg(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),Ie===null||!(Hi&268435455)&&!(uu&268435455)||Qn(Ie,Fe)}function Ec(t,e){var n=J;J|=2;var i=aw();(Ie!==t||Fe!==e)&&(xn=null,zi(t,e));do try{QP();break}catch(r){ow(t,r)}while(1);if(Mg(),J=n,_c.current=i,Te!==null)throw Error(O(261));return Ie=null,Fe=0,Pe}function QP(){for(;Te!==null;)lw(Te)}function JP(){for(;Te!==null&&!bS();)lw(Te)}function lw(t){var e=fw(t.alternate,t,ft);t.memoizedProps=t.pendingProps,e===null?cw(t):Te=e,Gg.current=null}function cw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=$P(n,e),n!==null){n.flags&=32767,Te=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pe=6,Te=null;return}}else if(n=HP(n,e,ft),n!==null){Te=n;return}if(e=e.sibling,e!==null){Te=e;return}Te=e=t}while(e!==null);Pe===0&&(Pe=5)}function Mi(t,e,n){var i=te,r=Ct.transition;try{Ct.transition=null,te=1,eA(t,e,n,i)}finally{Ct.transition=r,te=i}return null}function eA(t,e,n,i){do Yr();while(ei!==null);if(J&6)throw Error(O(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(kS(t,s),t===Ie&&(Te=Ie=null,Fe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$a||($a=!0,hw(ic,function(){return Yr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Ct.transition,Ct.transition=null;var o=te;te=1;var a=J;J|=4,Gg.current=null,XP(t,n),iw(n,t),xP(zh),sc=!!Dh,zh=Dh=null,t.current=n,ZP(n),SS(),J=a,te=o,Ct.transition=s}else t.current=n;if($a&&($a=!1,ei=t,wc=r),s=t.pendingLanes,s===0&&(ci=null),LS(n.stateNode),at(t,xe()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(xc)throw xc=!1,t=rd,rd=null,t;return wc&1&&t.tag!==0&&Yr(),s=t.pendingLanes,s&1?t===sd?uo++:(uo=0,sd=t):uo=0,wi(),null}function Yr(){if(ei!==null){var t=j1(wc),e=Ct.transition,n=te;try{if(Ct.transition=null,te=16>t?16:t,ei===null)var i=!1;else{if(t=ei,ei=null,wc=0,J&6)throw Error(O(331));var r=J;for(J|=4,U=t.current;U!==null;){var s=U,o=s.child;if(U.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(U=c;U!==null;){var u=U;switch(u.tag){case 0:case 11:case 15:lo(8,u,s)}var f=u.child;if(f!==null)f.return=u,U=f;else for(;U!==null;){u=U;var h=u.sibling,d=u.return;if(ew(u),u===c){U=null;break}if(h!==null){h.return=d,U=h;break}U=d}}}var p=s.alternate;if(p!==null){var _=p.child;if(_!==null){p.child=null;do{var T=_.sibling;_.sibling=null,_=T}while(_!==null)}}U=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,U=o;else e:for(;U!==null;){if(s=U,s.flags&2048)switch(s.tag){case 0:case 11:case 15:lo(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,U=y;break e}U=s.return}}var m=t.current;for(U=m;U!==null;){o=U;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,U=v;else e:for(o=m;U!==null;){if(a=U,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:cu(9,a)}}catch(S){_e(a,a.return,S)}if(a===o){U=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,U=E;break e}U=a.return}}if(J=r,wi(),un&&typeof un.onPostCommitFiberRoot=="function")try{un.onPostCommitFiberRoot(tu,t)}catch{}i=!0}return i}finally{te=n,Ct.transition=e}}return!1}function M0(t,e,n){e=is(n,e),e=Gx(t,e,1),t=li(t,e,1),e=qe(),t!==null&&(na(t,1,e),at(t,e))}function _e(t,e,n){if(t.tag===3)M0(t,t,n);else for(;e!==null;){if(e.tag===3){M0(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ci===null||!ci.has(i))){t=is(n,t),t=Wx(e,t,1),e=li(e,t,1),t=qe(),e!==null&&(na(e,1,t),at(e,t));break}}e=e.return}}function tA(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=qe(),t.pingedLanes|=t.suspendedLanes&n,Ie===t&&(Fe&n)===n&&(Pe===4||Pe===3&&(Fe&130023424)===Fe&&500>xe()-Hg?zi(t,0):Wg|=n),at(t,e)}function uw(t,e){e===0&&(t.mode&1?(e=Fa,Fa<<=1,!(Fa&130023424)&&(Fa=4194304)):e=1);var n=qe();t=In(t,e),t!==null&&(na(t,e,n),at(t,n))}function nA(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),uw(t,n)}function iA(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(e),uw(t,n)}var fw;fw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||st.current)it=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return it=!1,WP(t,e,n);it=!!(t.flags&131072)}else it=!1,fe&&e.flags&1048576&&gx(e,hc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Fl(t,e),t=e.pendingProps;var r=Jr(e,He.current);$r(e,n),r=zg(null,e,i,t,r,n);var s=Bg();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ot(i)?(s=!0,uc(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Og(e),r.updater=au,e.stateNode=r,r._reactInternals=e,Yh(e,i,t,n),e=qh(null,e,i,!0,s,n)):(e.tag=0,fe&&s&&Pg(e),Ye(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Fl(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=sA(i),t=Dt(i,t),r){case 0:e=Zh(null,e,i,t,n);break e;case 1:e=x0(null,e,i,t,n);break e;case 11:e=v0(null,e,i,t,n);break e;case 14:e=_0(null,e,i,Dt(i.type,t),n);break e}throw Error(O(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Dt(i,r),Zh(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Dt(i,r),x0(t,e,i,r,n);case 3:e:{if(Xx(e),t===null)throw Error(O(387));i=e.pendingProps,s=e.memoizedState,r=s.element,vx(t,e),pc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=is(Error(O(423)),e),e=w0(t,e,i,n,r);break e}else if(i!==r){r=is(Error(O(424)),e),e=w0(t,e,i,n,r);break e}else for(dt=ai(e.stateNode.containerInfo.firstChild),gt=e,fe=!0,Bt=null,n=Ex(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(es(),i===r){e=Rn(t,e,n);break e}Ye(t,e,i,n)}e=e.child}return e;case 5:return Tx(e),t===null&&Wh(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Bh(i,r)?o=null:s!==null&&Bh(i,s)&&(e.flags|=32),Yx(t,e),Ye(t,e,o,n),e.child;case 6:return t===null&&Wh(e),null;case 13:return Zx(t,e,n);case 4:return kg(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=ts(e,null,i,n):Ye(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Dt(i,r),v0(t,e,i,r,n);case 7:return Ye(t,e,e.pendingProps,n),e.child;case 8:return Ye(t,e,e.pendingProps.children,n),e.child;case 12:return Ye(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,se(dc,i._currentValue),i._currentValue=o,s!==null)if(Zt(s.value,o)){if(s.children===r.children&&!st.current){e=Rn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=An(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Hh(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Hh(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ye(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,$r(e,n),r=It(r),i=i(r),e.flags|=1,Ye(t,e,i,n),e.child;case 14:return i=e.type,r=Dt(i,e.pendingProps),r=Dt(i.type,r),_0(t,e,i,r,n);case 15:return Hx(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Dt(i,r),Fl(t,e),e.tag=1,ot(i)?(t=!0,uc(e)):t=!1,$r(e,n),xx(e,i,r),Yh(e,i,r,n),qh(null,e,i,!0,t,n);case 19:return qx(t,e,n);case 22:return $x(t,e,n)}throw Error(O(156,e.tag))};function hw(t,e){return z1(t,e)}function rA(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lt(t,e,n,i){return new rA(t,e,n,i)}function Zg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sA(t){if(typeof t=="function")return Zg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===gg)return 11;if(t===pg)return 14}return 2}function fi(t,e){var n=t.alternate;return n===null?(n=Lt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Bl(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Zg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Tr:return Bi(n.children,r,s,e);case dg:o=8,r|=8;break;case yh:return t=Lt(12,n,e,r|2),t.elementType=yh,t.lanes=s,t;case vh:return t=Lt(13,n,e,r),t.elementType=vh,t.lanes=s,t;case _h:return t=Lt(19,n,e,r),t.elementType=_h,t.lanes=s,t;case w1:return fu(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _1:o=10;break e;case x1:o=9;break e;case gg:o=11;break e;case pg:o=14;break e;case Zn:o=16,i=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=Lt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Bi(t,e,n,i){return t=Lt(7,t,i,e),t.lanes=n,t}function fu(t,e,n,i){return t=Lt(22,t,i,e),t.elementType=w1,t.lanes=n,t.stateNode={isHidden:!1},t}function yf(t,e,n){return t=Lt(6,t,null,e),t.lanes=n,t}function vf(t,e,n){return e=Lt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function oA(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ku(0),this.expirationTimes=Ku(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ku(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function qg(t,e,n,i,r,s,o,a,l){return t=new oA(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Lt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Og(s),t}function aA(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Er,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function dw(t){if(!t)return pi;t=t._reactInternals;e:{if(nr(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ot(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(ot(n))return hx(t,n,e)}return e}function gw(t,e,n,i,r,s,o,a,l){return t=qg(n,i,!0,t,r,s,o,a,l),t.context=dw(null),n=t.current,i=qe(),r=ui(n),s=An(i,r),s.callback=e??null,li(n,s,r),t.current.lanes=r,na(t,r,i),at(t,i),t}function hu(t,e,n,i){var r=e.current,s=qe(),o=ui(r);return n=dw(n),e.context===null?e.context=n:e.pendingContext=n,e=An(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=li(r,e,o),t!==null&&(Yt(t,r,o,s),Ol(t,r,o)),o}function Tc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function I0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Kg(t,e){I0(t,e),(t=t.alternate)&&I0(t,e)}function lA(){return null}var pw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Qg(t){this._internalRoot=t}du.prototype.render=Qg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));hu(t,e,null,null)};du.prototype.unmount=Qg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$i(function(){hu(null,t,null,null)}),e[Mn]=null}};function du(t){this._internalRoot=t}du.prototype.unstable_scheduleHydration=function(t){if(t){var e=H1();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Kn.length&&e!==0&&e<Kn[n].priority;n++);Kn.splice(n,0,t),n===0&&Y1(t)}};function Jg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function gu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function R0(){}function cA(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=Tc(o);s.call(c)}}var o=gw(e,i,t,0,null,!1,!1,"",R0);return t._reactRootContainer=o,t[Mn]=o.current,Po(t.nodeType===8?t.parentNode:t),$i(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=Tc(l);a.call(c)}}var l=qg(t,0,!1,null,null,!1,!1,"",R0);return t._reactRootContainer=l,t[Mn]=l.current,Po(t.nodeType===8?t.parentNode:t),$i(function(){hu(e,l,n,i)}),l}function pu(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Tc(o);a.call(l)}}hu(e,o,t,r)}else o=cA(n,e,t,r,i);return Tc(o)}G1=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ks(e.pendingLanes);n!==0&&(vg(e,n|1),at(e,xe()),!(J&6)&&(rs=xe()+500,wi()))}break;case 13:$i(function(){var i=In(t,1);if(i!==null){var r=qe();Yt(i,t,1,r)}}),Kg(t,1)}};_g=function(t){if(t.tag===13){var e=In(t,134217728);if(e!==null){var n=qe();Yt(e,t,134217728,n)}Kg(t,134217728)}};W1=function(t){if(t.tag===13){var e=ui(t),n=In(t,e);if(n!==null){var i=qe();Yt(n,t,e,i)}Kg(t,e)}};H1=function(){return te};$1=function(t,e){var n=te;try{return te=t,e()}finally{te=n}};Ch=function(t,e,n){switch(e){case"input":if(Eh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=su(i);if(!r)throw Error(O(90));T1(i),Eh(i,r)}}}break;case"textarea":S1(t,n);break;case"select":e=n.value,e!=null&&jr(t,!!n.multiple,e,!1)}};R1=$g;O1=$i;var uA={usingClientEntryPoint:!1,Events:[ra,Ar,su,M1,I1,$g]},zs={findFiberByHostInstance:Oi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},fA={bundleType:zs.bundleType,version:zs.version,rendererPackageName:zs.rendererPackageName,rendererConfig:zs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=F1(t),t===null?null:t.stateNode},findFiberByHostInstance:zs.findFiberByHostInstance||lA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ya=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ya.isDisabled&&Ya.supportsFiber)try{tu=Ya.inject(fA),un=Ya}catch{}}xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uA;xt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jg(e))throw Error(O(200));return aA(t,e,null,n)};xt.createRoot=function(t,e){if(!Jg(t))throw Error(O(299));var n=!1,i="",r=pw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=qg(t,1,!1,null,null,n,!1,i,r),t[Mn]=e.current,Po(t.nodeType===8?t.parentNode:t),new Qg(e)};xt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=F1(e),t=t===null?null:t.stateNode,t};xt.flushSync=function(t){return $i(t)};xt.hydrate=function(t,e,n){if(!gu(e))throw Error(O(200));return pu(null,t,e,!0,n)};xt.hydrateRoot=function(t,e,n){if(!Jg(t))throw Error(O(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=pw;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=gw(e,null,t,1,n??null,r,!1,s,o),t[Mn]=e.current,Po(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new du(e)};xt.render=function(t,e,n){if(!gu(e))throw Error(O(200));return pu(null,t,e,!1,n)};xt.unmountComponentAtNode=function(t){if(!gu(t))throw Error(O(40));return t._reactRootContainer?($i(function(){pu(null,null,t,!1,function(){t._reactRootContainer=null,t[Mn]=null})}),!0):!1};xt.unstable_batchedUpdates=$g;xt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!gu(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return pu(t,e,n,!1,i)};xt.version="18.2.0-next-9e3b772b8-20220608";function mw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mw)}catch(t){console.error(t)}}mw(),g1.exports=xt;var ep=g1.exports,O0=ep;ph.createRoot=O0.createRoot,ph.hydrateRoot=O0.hydrateRoot;function bc(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const tp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),k0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);k0&&parseFloat(k0[1]);const hA="3.4.14";function On(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ul=typeof process!="object"||String(process)!=="[object process]"||process.browser,dA=typeof window<"u"&&typeof window.orientation<"u",N0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);N0&&parseFloat(N0[1]);function No(t){"@babel/helpers - typeof";return No=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(t)}function gA(t,e){if(No(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(No(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function pA(t){var e=gA(t,"string");return No(e)==="symbol"?e:String(e)}function g(t,e,n){return e=pA(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class mA{constructor(e,n){g(this,"name",void 0),g(this,"workerThread",void 0),g(this,"isRunning",!0),g(this,"result",void 0),g(this,"_resolve",()=>{}),g(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){On(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){On(this.isRunning),this.isRunning=!1,this._reject(e)}}let _f=class{terminate(){}};const xf=new Map;function yA(t){On(t.source&&!t.url||!t.source&&t.url);let e=xf.get(t.source||t.url);return e||(t.url&&(e=vA(t.url),xf.set(t.url,e)),t.source&&(e=yw(t.source),xf.set(t.source,e))),On(e),e}function vA(t){if(!t.startsWith("http"))return t;const e=_A(t);return yw(e)}function yw(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function _A(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function vw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(F0(t))i.add(t);else if(F0(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)vw(t[r],e,i)}}return n===void 0?Array.from(i):[]}function F0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const wf=()=>{};class ld{static isSupported(){return typeof Worker<"u"&&Ul||typeof _f<"u"&&!Ul}constructor(e){g(this,"name",void 0),g(this,"source",void 0),g(this,"url",void 0),g(this,"terminated",!1),g(this,"worker",void 0),g(this,"onMessage",void 0),g(this,"onError",void 0),g(this,"_loadableURL","");const{name:n,source:i,url:r}=e;On(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=wf,this.onError=s=>console.log(s),this.worker=Ul?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=wf,this.onError=wf,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||vw(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=yA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new _f(i,{eval:!1})}else if(this.source)e=new _f(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class xA{static isSupported(){return ld.isSupported()}constructor(e){g(this,"name","unnamed"),g(this,"source",void 0),g(this,"url",void 0),g(this,"maxConcurrency",1),g(this,"maxMobileConcurrency",1),g(this,"onDebug",()=>{}),g(this,"reuseWorkers",!0),g(this,"props",{}),g(this,"jobQueue",[]),g(this,"idleQueue",[]),g(this,"count",0),g(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new mA(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ld({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return dA?this.maxMobileConcurrency:this.maxConcurrency}}const wA={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class En{static isSupported(){return ld.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return En._workerFarm=En._workerFarm||new En({}),En._workerFarm.setProps(e),En._workerFarm}constructor(e){g(this,"props",void 0),g(this,"workerPools",new Map),this.props={...wA},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new xA({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}g(En,"_workerFarm",void 0);const EA="latest";function TA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=EA);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return On(r),r}function bA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hA;On(t,"no worker provided");const n=t.version;return!(!e||!n)}function SA(t,e){return!En.isSupported()||!Ul&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function PA(t,e,n,i,r){const s=t.id,o=TA(t,n),l=En.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",AA.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function AA(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function LA(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function CA(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),r=i.reduce((a,l)=>a+l.byteLength,0),s=new Uint8Array(r);let o=0;for(const a of i)s.set(a,o),o+=a.byteLength;return s.buffer}async function MA(t){const e=[];for await(const n of t)e.push(n);return CA(...e)}function D0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let z0=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=D0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(D0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},IA=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof z0?r=e:r=new z0(n,i),this.stats[n]=r),r}};const RA="Queued Requests",OA="Active Requests",kA="Cancelled Requests",NA="Queued Requests Ever",FA="Active Requests Ever",DA={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class zA{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g(this,"props",void 0),g(this,"stats",void 0),g(this,"activeRequestCount",0),g(this,"requestQueue",[]),g(this,"requestMap",new Map),g(this,"deferredUpdate",null),this.props={...DA,...e},this.stats=new IA({id:this.props.id}),this.stats.get(RA),this.stats.get(OA),this.stats.get(kA),this.stats.get(NA),this.stats.get(FA)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let BA="";const B0={};function UA(t){for(const e in B0)if(t.startsWith(e)){const n=B0[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(BA).concat(t)),t}function VA(t){return t&&typeof t=="object"&&t.isBuffer}function _w(t){if(VA(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function xw(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function jA(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const GA=t=>typeof t=="boolean",fo=t=>typeof t=="function",oa=t=>t!==null&&typeof t=="object",U0=t=>oa(t)&&t.constructor==={}.constructor,WA=t=>t&&typeof t[Symbol.iterator]=="function",HA=t=>t&&typeof t[Symbol.asyncIterator]=="function",ir=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,rr=t=>typeof Blob<"u"&&t instanceof Blob,$A=t=>t&&typeof t=="object"&&t.isBuffer,YA=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||oa(t)&&fo(t.tee)&&fo(t.cancel)&&fo(t.getReader),XA=t=>oa(t)&&fo(t.read)&&fo(t.pipe)&&GA(t.readable),ww=t=>YA(t)||XA(t),ZA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,qA=/^([-\w.]+\/[-\w.+]+)/;function KA(t){const e=qA.exec(t);return e?e[1]:t}function V0(t){const e=ZA.exec(t);return e?e[1]:""}const Ew=/\?.*/;function QA(t){const e=t.match(Ew);return e&&e[0]}function np(t){return t.replace(Ew,"")}function mu(t){return ir(t)?t.url:rr(t)?t.name||"":typeof t=="string"?t:""}function ip(t){if(ir(t)){const e=t,n=e.headers.get("content-type")||"",i=np(e.url);return KA(n)||V0(i)}return rr(t)?t.type||"":typeof t=="string"?V0(t):""}function JA(t){return ir(t)?t.headers["content-length"]||-1:rr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function Tw(t){if(ir(t))return t;const e={},n=JA(t);n>=0&&(e["content-length"]=String(n));const i=mu(t),r=ip(t);r&&(e["content-type"]=r);const s=await n2(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function e2(t){if(!t.ok){const e=await t2(t);throw new Error(e)}}async function t2(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function n2(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=i2(n);return"data:base64,".concat(i)}return null}function i2(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function j0(t,e){if(typeof t=="string"){t=UA(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await Tw(t)}function r2(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function aa(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||r2()}const Xa=globalThis.window||globalThis.self||globalThis.global,Bs=globalThis.process||{},bw=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";aa();function s2(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let o2=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=s2(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function a2(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function l2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Ef(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Sc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Sc||(Sc={}));const c2=10;function G0(t){return typeof t!="string"?t:(t=t.toUpperCase(),Sc[t]||Sc.WHITE)}function u2(t,e,n){if(!aa&&typeof t=="string"){if(e){const i=G0(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=G0(n);t="\x1B[".concat(i+c2,"m").concat(t,"\x1B[49m")}}return t}function f2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const s of i){const o=r[s];typeof o=="function"&&(e.find(a=>s===a)||(r[s]=o.bind(t)))}}function Pc(t,e){if(!t)throw new Error(e||"Assertion failed")}function fr(){let t;if(aa()&&Xa.performance){var e,n;t=Xa==null||(e=Xa.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Bs){var i;const r=Bs==null||(i=Bs.hrtime)===null||i===void 0?void 0:i.call(Bs);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const hr={debug:aa()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},h2={enabled:!0,level:0};function bt(){}const W0={},H0={once:!0};let rp=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=bw,this._startTs=fr(),this._deltaTs=fr(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new o2("__probe-".concat(this.id,"__"),h2),this.timeStamp("".concat(this.id," started")),f2(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((fr()-this._startTs).toPrecision(10))}getDelta(){return Number((fr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Pc(e,n)}warn(e){return this._getLogFunction(0,e,hr.warn,arguments,H0)}error(e){return this._getLogFunction(0,e,hr.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,hr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,hr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,hr.debug||hr.info,arguments,H0)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||bt,i&&[i],{tag:m2(n)}):bt}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?aa()?p2({image:r,message:s,scale:o}):g2():bt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||bt)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=$0({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||bt)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Sw(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=$0({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,Pc(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=fr();const o=s.tag||s.message;if(s.once&&o)if(!W0[o])W0[o]=fr();else return bt;return n=d2(this.id,s.message,s),i.bind(console,n,...s.args)}return bt}};rp.VERSION=bw;function Sw(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Pc(Number.isFinite(e)&&e>=0),e}function $0(t){const{logLevel:e,message:n}=t;t.logLevel=Sw(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Pc(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function d2(t,e,n){if(typeof e=="string"){const i=n.time?l2(a2(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=u2(e,n.color,n.background)}return e}function g2(t){return console.warn("removed"),bt}function p2(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Ef(s,n,i);console.log(...o)},s.src=e,bt}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Ef(e,n,i)),bt;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Ef(s,n,i)),s.src=e.toDataURL(),bt}return bt}function m2(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Y0=new rp({id:"loaders.gl"});class y2{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class v2{constructor(){g(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const Pw={fetch:null,mimeType:void 0,nothrow:!1,log:new v2,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:tp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},_2={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Aw(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Lw=()=>{const t=Aw();return t.globalOptions=t.globalOptions||{...Pw},t.globalOptions};function x2(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],w2(t,n),T2(e,t,i)}function w2(t,e){X0(t,null,Pw,_2,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};X0(i,n.id,r,s,e)}}function X0(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&oa(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)Y0.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const f=E2(a,r);Y0.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function E2(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function T2(t,e,n){const r={...t.options||{}};return b2(r,n),r.log===null&&(r.log=new y2),Z0(r,Lw()),Z0(r,e),r}function Z0(t,e){for(const n in e)if(n in e){const i=e[n];U0(i)&&U0(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function b2(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function sp(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function op(t){var e,n;bc(t,"null loader"),bc(sp(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Cw=()=>{const t=Aw();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function S2(t){const e=Cw();t=Array.isArray(t)?t:[t];for(const n of t){const i=op(n);e.find(r=>i===r)||e.unshift(i)}}function P2(){return Cw()}const A2=new rp({id:"loaders.gl"}),L2=/\.([^.]+)$/;async function C2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Mw(t))return null;let r=q0(t,e,{...n,nothrow:!0},i);if(r)return r;if(rr(t)&&(t=await t.slice(0,10).arrayBuffer(),r=q0(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(Iw(t));return r}function q0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!Mw(t))return null;if(e&&!Array.isArray(e))return op(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...P2()),I2(r);const s=M2(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(Iw(t));return s}function M2(t,e,n,i){const r=mu(t),s=ip(t),o=np(r)||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Tf(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||R2(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Tf(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||k2(e,t),l=l||(a?"matched initial data ".concat(Rw(t)):""),a=a||Tf(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;A2.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function Mw(t){return!(t instanceof Response&&t.status===204)}function Iw(t){const e=mu(t),n=ip(t);let i="No valid loader found (";i+=e?"".concat(xw(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Rw(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function I2(t){for(const e of t)op(e)}function R2(t,e){const n=e&&L2.exec(e),i=n&&n[1];return i?O2(t,i):null}function O2(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Tf(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function k2(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(N2(e,n))return n}else if(ArrayBuffer.isView(e)){if(K0(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&K0(e,0,n))return n;return null}function N2(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function K0(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>F2(t,e,n,r))}function F2(t,e,n,i){if(i instanceof ArrayBuffer)return LA(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=cd(t,e,i.length);return i===r;default:return!1}}function Rw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?cd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?cd(t,0,e):""}function cd(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const D2=256*1024;function*z2(t,e){const n=(e==null?void 0:e.chunkSize)||D2;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const B2=256*1024;function U2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=B2}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}()}const V2=1024*1024;async function*j2(t,e){const n=(e==null?void 0:e.chunkSize)||V2;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function Q0(t,e){return tp?G2(t,e):W2(t)}async function*G2(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield _w(o)}}catch{n.releaseLock()}}async function*W2(t,e){for await(const n of t)yield _w(n)}function H2(t,e){if(typeof t=="string")return z2(t,e);if(t instanceof ArrayBuffer)return U2(t,e);if(rr(t))return j2(t,e);if(ww(t))return Q0(t,e);if(ir(t))return Q0(t.body,e);throw new Error("makeIterator")}const Ow="Cannot convert supplied data type";function $2(t,e,n){if(e.text&&typeof t=="string")return t;if($A(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(Ow)}async function Y2(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return $2(t,e);if(rr(t)&&(t=await Tw(t)),ir(t)){const r=t;return await e2(r),e.binary?await r.arrayBuffer():await r.text()}if(ww(t)&&(t=H2(t,n)),WA(t)||HA(t))return MA(t);throw new Error(Ow)}function kw(t,e){const n=Lw(),i=t||n;return typeof i.fetch=="function"?i.fetch:oa(i.fetch)?r=>j0(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:j0}function X2(t,e,n){if(n)return n;const i={fetch:kw(e,t),...t};if(i.url){const r=np(i.url);i.baseUrl=r,i.queryString=QA(i.url),i.filename=xw(r),i.baseUrl=jA(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function Z2(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function ap(t,e,n,i){On(!i||typeof i=="object"),e&&!Array.isArray(e)&&!sp(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=mu(t),o=Z2(e,i),a=await C2(t,o,n);return a?(n=x2(n,a,o,r),i=X2({url:r,parse:ap,loaders:o},n,i||null),await q2(a,t,n,i)):null}async function q2(t,e,n,i){if(bA(t),ir(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=r,f=Object.fromEntries(r.headers.entries());i.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await Y2(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(SA(t,n))return await PA(t,e,n,i,ap);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw On(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Ac(t,e,n,i){!Array.isArray(e)&&!sp(e)&&(n=e,e=void 0);const r=kw(n);let s=t;return typeof t=="string"&&(s=await r(t)),rr(t)&&(s=await r(t)),await ap(s,e,n)}const K2="3.4.14",{_parseImageNode:Q2}=globalThis,ud=typeof Image<"u",fd=typeof ImageBitmap<"u",J2=!!Q2,hd=tp?!0:J2;function eL(t){switch(t){case"auto":return fd||ud||hd;case"imagebitmap":return fd;case"image":return ud;case"data":return hd;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function tL(){if(fd)return"imagebitmap";if(ud)return"image";if(hd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function nL(t){const e=rL(t);if(!e)throw new Error("Not an image");return e}function iL(t){switch(nL(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function rL(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const sL=/^data:image\/svg\+xml/,oL=/\.svg((\?|#).*)?$/;function lp(t){return t&&(sL.test(t)||oL.test(t))}function aL(t,e){if(lp(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Nw(t,e)}function Nw(t,e){if(lp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Fw(t,e,n){const i=aL(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await lL(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function lL(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const cL={};let J0=!0;async function uL(t,e,n){let i;lp(n)?i=await Fw(t,e,n):i=Nw(t,n);const r=e&&e.imagebitmap;return await fL(i,r)}async function fL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((hL(e)||!J0)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),J0=!1}return await createImageBitmap(t)}function hL(t){for(const e in t||cL)return!1;return!0}function dL(t){return!yL(t,"ftyp",4)||!(t[8]&96)?null:gL(t)}function gL(t){switch(pL(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function pL(t,e,n){return String.fromCharCode(...t.slice(e,n))}function mL(t){return[...t].map(e=>e.charCodeAt(0))}function yL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=mL(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const cn=!1,ho=!0;function Dw(t){const e=la(t);return _L(e)||EL(e)||xL(e)||wL(e)||vL(e)}function vL(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=dL(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function _L(t){const e=la(t);return e.byteLength>=24&&e.getUint32(0,cn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,cn),height:e.getUint32(20,cn)}:null}function xL(t){const e=la(t);return e.byteLength>=10&&e.getUint32(0,cn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ho),height:e.getUint16(8,ho)}:null}function wL(t){const e=la(t);return e.byteLength>=14&&e.getUint16(0,cn)===16973&&e.getUint32(2,ho)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ho),height:e.getUint32(22,ho)}:null}function EL(t){const e=la(t);if(!(e.byteLength>=3&&e.getUint16(0,cn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=TL();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,cn);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,cn),width:e.getUint16(s+7,cn)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,cn)}return null}function TL(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function la(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function bL(t,e){const{mimeType:n}=Dw(t)||{},i=globalThis._parseImageNode;return bc(i),await i(t,n)}async function SL(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=PL(r);let a;switch(o){case"imagebitmap":a=await uL(t,e,s);break;case"image":a=await Fw(t,e,s);break;case"data":a=await bL(t);break;default:bc(!1)}return r==="data"&&(a=iL(a)),a}function PL(t){switch(t){case"auto":case"data":return tL();default:return eL(t),t}}const AL=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],LL=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],CL={image:{type:"auto",decode:!0}},ML={id:"image",module:"images",name:"Images",version:K2,mimeTypes:LL,extensions:AL,parse:SL,tests:[t=>!!Dw(new DataView(t))],options:CL};function zw(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function zn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||zw()}const Vl={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Za=Vl.window||Vl.self||Vl.global,Us=Vl.process||{},Bw=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";zn();const bf=globalThis;function Uw(t){if(!t&&!zn())return"Node";if(zw(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":bf.chrome?"Chrome":bf.safari?"Safari":bf.mozInnerScreenX?"Firefox":"Unknown"}function IL(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class RL{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";g(this,"storage",void 0),g(this,"id",void 0),g(this,"config",void 0),this.storage=IL(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function OL(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function kL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Sf(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Lc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Lc||(Lc={}));function ey(t){return typeof t=="string"?Lc[t.toUpperCase()]||Lc.WHITE:t}function NL(t,e,n){return!zn&&typeof t=="string"&&(e&&(e=ey(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=ey(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function FL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function Cc(t,e){if(!t)throw new Error(e||"Assertion failed")}function dr(){let t;if(zn&&"performance"in Za){var e,n;t=Za==null||(e=Za.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Us){var i;const r=Us==null||(i=Us.hrtime)===null||i===void 0?void 0:i.call(Us);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const gr={debug:zn&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DL={enabled:!0,level:0};function St(){}const ty={},ny={once:!0};class cp{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};g(this,"id",void 0),g(this,"VERSION",Bw),g(this,"_startTs",dr()),g(this,"_deltaTs",dr()),g(this,"_storage",void 0),g(this,"userData",{}),g(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new RL("__probe-".concat(this.id,"__"),DL),this.timeStamp("".concat(this.id," started")),FL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((dr()-this._startTs).toPrecision(10))}getDelta(){return Number((dr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Cc(e,n)}warn(e){return this._getLogFunction(0,e,gr.warn,arguments,ny)}error(e){return this._getLogFunction(0,e,gr.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,gr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,gr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,gr.debug||gr.info,arguments,ny)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||St,i&&[i],{tag:VL(n)}):St}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?zn?UL({image:r,message:s,scale:o}):BL():St}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||St)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=iy({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||St)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Vw(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=iy({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,Cc(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=dr();const o=s.tag||s.message;if(s.once)if(!ty[o])ty[o]=dr();else return St;return n=zL(this.id,s.message,s),i.bind(console,n,...s.args)}return St}}g(cp,"VERSION",Bw);function Vw(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Cc(Number.isFinite(e)&&e>=0),e}function iy(t){const{logLevel:e,message:n}=t;t.logLevel=Vw(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Cc(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function zL(t,e,n){if(typeof e=="string"){const i=n.time?kL(OL(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=NL(e,n.color,n.background)}return e}function BL(t){return console.warn("removed"),St}function UL(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Sf(s,n,i);console.log(...o)},s.src=e,St}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Sf(e,n,i)),St;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Sf(s,n,i)),s.src=e.toDataURL(),St}return St}function VL(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Y=new cp({id:"deck"});let dd={};function jL(t){dd=t}function Ve(t,e,n,i){Y.level>0&&dd[t]&&dd[t].call(null,e,n,i)}function GL(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const WL={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:GL,parseTextSync:JSON.parse};function HL(){const t="8.9.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(Y.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Y,_registerLoggers:jL},S2([WL,[ML,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const $L=HL(),Q={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Q,"IDENTITY",{get:()=>(Y.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const jt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Yi={common:0,meters:1,pixels:2},ry={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},V=new cp({id:"luma.gl"});function Xe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const YL="Invalid WebGLRenderingContext",XL="Requires WebGL2";function yu(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Z(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function ZL(t){return Z(t)?t:null}function vu(t){return Xe(yu(t),YL),t}function We(t){return Xe(Z(t),XL),t}const Js={};function qL(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function KL(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function QL(t,e){Js[t]=!0,e!==void 0&&qL(e)}function JL(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Js[i]=!0);while(i!==0);for(i in Js)if(Js[i])return delete Js[i],parseInt(i,10);return 0}}const ca=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};ca.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};ca.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const sr=function(e){const n=this;this.gl=e,JL(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=c,h.offset=u,h.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{KL("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};sr.prototype.VERTEX_ARRAY_BINDING_OES=34229;sr.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new ca(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};sr.prototype.createVertexArrayOES=function(){const e=new ca(this);return this.vertexArrayObjects.push(e),e};sr.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};sr.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof ca&&e.hasBeenBound&&e.ext===this)};sr.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){QL(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=r?r.attribs[l]:null;if((!r||c.enabled!==u.enabled)&&(c.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),c.enabled){let f=!1;(!r||c.buffer!==u.buffer)&&(o!==c.buffer&&(i.bindBuffer.call(n,34962,c.buffer),o=c.buffer),f=!0),(f||c.cached!==u.cached)&&i.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function eC(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new sr(this)),this.__OESVertexArrayObject))}}const sy="OES_element_index",oy="WEBGL_draw_buffers",tC="EXT_disjoint_timer_query",nC="EXT_disjoint_timer_query_webgl2",iC="EXT_texture_filter_anisotropic",ay="WEBGL_debug_renderer_info",rC=35723,sC=4352,oC=36795,aC=34047,lC=37445,cC=37446,re=t=>Z(t)?void 0:0,uC={3074:t=>Z(t)?void 0:36064,[rC]:t=>Z(t)?void 0:sC,35977:re,32937:re,[oC]:(t,e)=>{const n=Z(t)?t.getExtension(nC):t.getExtension(tC);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[lC]:(t,e)=>{const n=t.getExtension(ay);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[cC]:(t,e)=>{const n=t.getExtension(ay);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[aC]:(t,e)=>{const n=t.luma.extensions[iC];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:re,35071:re,37447:re,36063:(t,e)=>{if(!Z(t)){const n=t.getExtension(oy);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:re,35374:re,35377:re,34852:t=>{if(!Z(t)){const e=t.getExtension(oy);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(sy)?2147483647:65535,33001:t=>t.getExtension(sy)?16777216:65535,33e3:t=>16777216,37157:re,35373:re,35657:re,36183:re,37137:re,34045:re,35978:re,35979:re,35968:re,35376:re,35375:re,35659:re,37154:re,35371:re,35658:re,35076:re,35077:re,35380:re};function fC(t,e,n){const i=uC[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const hC="OES_vertex_array_object",jw="ANGLE_instanced_arrays",dC="WEBGL_draw_buffers",gC="EXT_disjoint_timer_query",pC="EXT_texture_filter_anisotropic",mC="VertexArray requires WebGL2 or OES_vertex_array_object extension";function yC(t,e){return{webgl2:Z(t),ext:t.getExtension(e)}}const Gw={[hC]:{meta:{suffix:"OES"},createVertexArray:()=>{Xe(!1,mC)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[jw]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Xe(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[dC]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Xe(!1)}},[gC]:{meta:{suffix:"EXT"},createQuery:()=>{Xe(!1)},deleteQuery:()=>{Xe(!1)},beginQuery:()=>{Xe(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Pf={readBuffer:(t,e,n)=>{Z(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=yC(t,jw);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Z(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Z(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[pC];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:fC,hint(t,e,n,i){return e(n,i)}};function vC(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(eC(t),_C(t),wC(t,Gw),xC(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=vC;function _C(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function xC(t,e){let{target:n,target2:i}=e;Object.keys(Pf).forEach(r=>{if(typeof Pf[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=Pf[r].bind(null,t,s);n[r]=o,i[r]=o}})}function wC(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&EC(t,{extension:n,target:t.luma,target2:t})}function EC(t,e){let{extension:n,target:i,target2:r}=e;const s=Gw[n];Xe(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const u="".concat(c).concat(a);let f=null;c==="meta"||typeof t[c]=="function"||(l&&typeof l[u]=="function"?f=function(){return l[u](...arguments)}:typeof s[c]=="function"&&(f=s[c].bind(i))),f&&(i[c]=f,r[c]=f)}}const up={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Gn=(t,e,n)=>e?t.enable(n):t.disable(n),ly=(t,e,n)=>t.hint(n,e),lt=(t,e,n)=>t.pixelStorei(n,e),TC=(t,e)=>{const n=Z(t)?36009:36160;return t.bindFramebuffer(n,e)},bC=(t,e)=>t.bindFramebuffer(36008,e);function Vs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const SC={3042:Gn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Gn,2885:(t,e)=>t.cullFace(e),2929:Gn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Gn,35723:ly,36006:TC,2886:(t,e)=>t.frontFace(e),33170:ly,2849:(t,e)=>t.lineWidth(e),32823:Gn,32824:"polygonOffset",10752:"polygonOffset",35977:Gn,32938:"sampleCoverage",32939:"sampleCoverage",3089:Gn,3088:(t,e)=>t.scissor(...e),2960:Gn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:lt,3317:lt,37440:lt,37441:lt,37443:lt,3330:lt,3332:lt,3331:lt,36010:bC,3314:lt,32878:lt,3316:lt,3315:lt,32877:lt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Vs(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Vs(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Vs(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Vs(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Vs(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ve(t,e,n){return e[t]!==void 0?e[t]:n[t]}const PC={blendEquation:(t,e,n)=>t.blendEquationSeparate(ve(32777,e,n),ve(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ve(32969,e,n),ve(32968,e,n),ve(32971,e,n),ve(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ve(32824,e,n),ve(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ve(32938,e,n),ve(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ve(2962,e,n),ve(2967,e,n),ve(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ve(34816,e,n),ve(36003,e,n),ve(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ve(2964,e,n),ve(2965,e,n),ve(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ve(34817,e,n),ve(34818,e,n),ve(34819,e,n))},cy={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},nn=(t,e)=>t.isEnabled(e),uy={3042:nn,2884:nn,2929:nn,3024:nn,32823:nn,32926:nn,32928:nn,3089:nn,2960:nn,35977:nn};function Ww(t){for(const e in t)return!1;return!0}function AC(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function fy(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function LC(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:c}=n(t.state._updateCache,...o);return l&&i(...o),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function CC(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class MC{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?RC(e):Object.assign({},up),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Xe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];kn(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Xe(s!==void 0);const o=e[s],a=this.cache[s];AC(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function Hw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Xe(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new MC(t,{copyState:i}),CC(t);for(const s in cy){const o=cy[s];LC(t,s,o)}fy(t,"getParameter"),fy(t,"isEnabled")}return t.state.enable=n,t}function IC(t){t.state||Hw(t,{copyState:!1}),t.state.push()}function hy(t){Xe(t.state),t.state.pop()}function kn(t,e){if(Xe(yu(t),"setParameters requires a WebGL context"),Ww(e))return;const n={};for(const r in e){const s=Number(r),o=SC[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=PC[r];s(t,e,i)}}function RC(t,e){if(e=e||up,typeof e=="number"){const r=e,s=uy[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=uy[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function OC(t){kn(t,up)}function Xt(t,e,n){if(Ww(e))return n(t);const{nocatch:i=!0}=e;IC(t),kn(t,e);let r;if(i)r=n(t),hy(t);else try{r=n(t)}finally{hy(t)}return r}function ss(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function Af(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=ss(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return NC(e,i,r,s,n)}function kC(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function NC(t,e,n,i,r){const s=dy(t[0],e,n);let o=gy(t[1],e,i,r),a=dy(t[0]+1,e,n);const l=a===n-1?a:a-1;a=gy(t[1]+1,e,i,r);let c;return r?(a=a===0?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function dy(t,e,n){return Math.min(Math.round(t*e),n-1)}function gy(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const fp=zn(),FC=fp&&typeof document<"u",$w={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Yw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xe(fp,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},$w,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=UC({canvas:s,width:e,height:n,onError:i});return r=BC(o,t),r?(r=hp(r,t),VC(r),r):null}function hp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||jC(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},$w,e);const{manageState:n,debug:i}=e;return n&&Hw(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return V.log(1,...s)()}}),fp&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),V.level=Math.max(V.level,1)):V.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function DC(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function zC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=kC(e.useDevicePixels);GC(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function BC(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function UC(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(FC&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function VC(t){const e=Z(t)?"WebGL2":"WebGL1",n=DC(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";V.info(1,"".concat(e).concat(r," context ").concat(i))()}function jC(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function GC(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(V.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(V.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}function py(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class my{constructor(e,n){g(this,"name",void 0),g(this,"type",void 0),g(this,"sampleSize",1),g(this,"time",void 0),g(this,"count",void 0),g(this,"samples",void 0),g(this,"lastTiming",void 0),g(this,"lastSampleTime",void 0),g(this,"lastSampleCount",void 0),g(this,"_count",0),g(this,"_time",0),g(this,"_samples",0),g(this,"_startTime",0),g(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=py(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(py()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class dp{constructor(e){g(this,"id",void 0),g(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof my?this.stats[n]=e:this.stats[n]=new my(n,i)),this.stats[n]}}const go="8.5.21",WC="set luma.log.level=1 (or higher) to trace rendering";class HC{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new dp({id:e})),this.stats.get(e)}}const Fi=new HC;if(globalThis.luma&&globalThis.luma.VERSION!==go)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(go));globalThis.luma||(zn()&&V.log(1,"luma.gl ".concat(go," - ").concat(WC))(),globalThis.luma=globalThis.luma||{VERSION:go,version:go,log:V,stats:Fi,globals:{modules:{},nodeIO:{}}});function $C(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function YC(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function F(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Lf(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return F(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function hi(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Cf={};function mi(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Cf[t]=Cf[t]||1;const e=Cf[t]++;return"".concat(t,"-").concat(e)}function yy(t){return F(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function os(t){let e=!0;for(const n in t){e=!1;break}return e}function Xw(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw V.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const pr="Resource subclass must define virtual methods";let Bn=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vu(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||mi(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Lf(this.gl,e),F(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Z(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Z(this.gl),o={},a=n||Object.keys(r);for(const l of a){const c=r[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const f=i?hi(this.gl,l):l;o[f]=this.getParameter(l,e),i&&c.type==="GLenum"&&(o[f]=hi(this.gl,o[f]))}}return o}setParameter(e,n){e=Lf(this.gl,e),F(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Z(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=Lf(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return Xw(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(pr)}_deleteHandle(){throw new Error(pr)}_bindHandle(e){throw new Error(pr)}_getOptsFromHandle(){throw new Error(pr)}_getParameter(e,n){throw new Error(pr)}_setParameter(e,n){throw new Error(pr)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Fi.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Fi.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Fi.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Fi.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const XC="Failed to deduce GL constant from typed array";function gd(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(XC)}}function Fo(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ZC(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const l=a*o,c=(i-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,c,c+o),e.set(s,c)}}function qC(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let l=0;l<r;l++)for(let c=0;c<4;c++)o[(a*r+l)*4+c]=e[(a*2*n+l*2)*4+c];return{data:o,width:r,height:s}}function pd(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?"".concat(t,".").concat(i[a]):"N/A";V.removed("".concat(t,".").concat(a),c)()}for(const a in r)if(a in e){const l=r[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];V.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const KC={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},QC={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ht{static getBytesPerElement(e){return Fo(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return F(e.size),Fo(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ht(KC,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ht.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ht.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=pd("Accessor",e,QC),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const vy=10,Zw={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},JC={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Zw},e3={removedProps:Zw};class ne extends Bn{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ht.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ht.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=pd("Buffer",e,JC),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=pd("Buffer",e,e3),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ht(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;F(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(We(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return We(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};We(this.gl);const s=Fo(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,r||o),c=a+l);const u=Math.min(o,l);return r=r||u,F(r<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(F(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(vy,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;F(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,vy),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=gd(e);return F(s),this.setAccessor(new ht(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;F(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Fo(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ht(this.accessor,{type:gd(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return V.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return V.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return V.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return V.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ht(this.accessor,e),this}}const gp={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},qw={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Kw={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function t3(t,e){const n=gp[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Z(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function n3(t,e){const n=gp[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const i3=[9729,9728],_y=globalThis.WebGLBuffer||function(){};class Xi extends Bn{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&t3(e,i),s=s&&(!r||n3(e,i))),s}constructor(e,n){const{id:i=mi("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=r);let{width:f,height:h,dataFormat:d,type:p,compressed:_=!1,mipmaps:T=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:_,dataFormat:d,type:p}=this._deduceParameters({format:s,type:p,dataFormat:d,compressed:_,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=p,this.dataFormat=d,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),T&&this._isNPOT()&&(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),T=!1,this._updateForNPOT(l)),this.mipmaps=T,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:p,dataFormat:d,border:o,mipmaps:T,parameters:c,compressed:_}),T&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(V.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Xt(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=e;c||(c=i),{type:u,dataFormat:d,compressed:p,width:f,height:h}=this._deduceParameters({format:s,type:u,dataFormat:d,compressed:p,data:c,width:f,height:h});const{gl:_}=this;_.bindTexture(this.target,this.handle);let T=null;({data:c,dataType:T}=this._getDataType({data:c,compressed:p}));let y,m=0;if(Xt(this.gl,l,()=>{switch(T){case"null":_.texImage2D(n,r,s,f,h,o,d,u,c);break;case"typed-array":_.texImage2D(n,r,s,f,h,o,d,u,c,a);break;case"buffer":y=We(_),y.bindBuffer(35052,c.handle||c),y.texImage2D(n,r,s,f,h,o,d,u,a),y.bindBuffer(35052,null);break;case"browser-object":Z(_)?_.texImage2D(n,r,s,f,h,o,d,u,c):_.texImage2D(n,r,s,d,u,c);break;case"compressed":for(const[v,E]of c.entries())_.compressedTexImage2D(n,v,E.format,E.width,E.height,o,E.data),m+=E.levelSize;break;default:F(!1,"Unknown image data type")}}),T==="compressed")this._trackAllocatedMemory(m,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const v=qw[this.dataFormat]||4,E=Kw[this.type]||1;this._trackAllocatedMemory(this.width*this.height*v*E,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,format:u=this.format,type:f=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:p=0,border:_=this.border,parameters:T={}}=e;if({type:f,dataFormat:h,compressed:d,width:a,height:l}=this._deduceParameters({format:u,type:f,dataFormat:h,compressed:d,data:r,width:a,height:l}),F(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const y=r;r=y.data,a=y.shape[0],l=y.shape[1]}r instanceof ne&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Xt(this.gl,T,()=>{if(d)this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,r);else if(r===null)this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,c,s,o,a,l,h,f,r,p);else if(r instanceof _y){const y=We(this.gl);y.bindBuffer(35052,r),y.texSubImage2D(n,c,s,o,a,l,h,f,p),y.bindBuffer(35052,null)}else Z(this.gl)?We(this.gl).texSubImage2D(n,c,s,o,a,l,h,f,r):this.gl.texSubImage2D(n,c,s,o,h,f,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return V.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ne?{data:n.handle,dataType:"buffer"}:n instanceof _y?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const c=gp[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},F(r,"Could not deduced texture size"),F(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),F(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:F(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Z(this.gl)||!this.width||!this.height?!1:!yy(this.width)||!yy(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:i3.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let r3="";function s3(t,e){return F(typeof t=="string"),t=r3+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class yt extends Xi{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Xi.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vu(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:s3(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const md=[34069,34070,34071,34072,34073,34074];class Qw extends Xi{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vu(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:c}=this,u=r||s,f=await Promise.all(md.map(h=>{const d=u[h];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),md.forEach((h,d)=>{f[d].length>1&&this.opts.mipmaps!==!1&&V.warn("".concat(this.id," has mipmap and multiple LODs."))(),f[d].forEach((p,_)=>{n&&i?c.texImage2D(h,_,a,n,i,o,a,l,p):c.texImage2D(h,_,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?u.texImage2D(n,0,l,i,r,a,l,c,f):u.texImage2D(n,0,l,l,c,f),this}}Qw.FACES=md;class o3 extends Xi{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};We(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:l,type:c=5121,offset:u=0,data:f,parameters:h={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Xt(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,f),f instanceof ne&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,u))}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const d=qw[this.dataFormat]||4,p=Kw[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*d*p,"Texture")}return this.loaded=!0,this}}const Si="EXT_color_buffer_float",xy={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Si,bpp:2},33327:{gl2:Si,bpp:4},34842:{gl2:Si,bpp:8},33326:{gl2:Si,bpp:4},33328:{gl2:Si,bpp:8},34836:{gl2:Si,bpp:16},35898:{gl2:Si,bpp:4}};function a3(t,e,n){const i=n[e];if(!i)return!1;const r=Z(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class kr extends Bn{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||a3(e,n,xy)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return F(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Z(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*xy[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const l3=256,c3=1024,u3=16384,wy=6144,Ey=6145,Ty=6146,by=34041,Jw="clear: bad arguments";function pp(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=u3,n!==!0&&(s.clearColor=n)),i&&(o|=l3,i!==!0&&(s.clearDepth=i)),r&&(o|=c3,i!==!0&&(s.clearStencil=i)),F(o!==0,Jw),Xt(t,s,()=>{t.clear(o)})}function f3(t){let{framebuffer:e=null,buffer:n=wy,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};We(t),Xt(t,{framebuffer:e},()=>{switch(n){case wy:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case Ey:t.clearBufferfv(Ey,0,[r]);break;case Ty:t.clearBufferiv(Ty,0,[r]);break;case by:const[s,o]=r;t.clearBufferfi(by,0,s,o);break;default:F(!1,Jw)}})}function h3(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return F(!1),0}}function _u(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:f}=eE(t);F(u);const{gl:h,handle:d,attachments:p}=u;a=a||u.width,l=l||u.height,s===36064&&d===null&&(s=1028),F(p[s]),c=c||p[s].type,o=g3(o,c,r,a,l),c=c||gd(o);const _=h.bindFramebuffer(36160,d);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,_||null),f&&u.delete(),o}function Sy(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=_u(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=qC({data:i,width:r,height:s}));ZC({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function d3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:f}=n;const{framebuffer:h,deleteFramebuffer:d}=eE(t);F(h);const{gl:p,handle:_}=h,T=typeof a<"u"||typeof l<"u"||typeof c<"u";a=a||0,l=l||0,c=c||0;const y=p.bindFramebuffer(36160,_);F(e);let m=null;if(e instanceof Xi&&(m=e,u=Number.isFinite(u)?u:m.width,f=Number.isFinite(f)?f:m.height,m.bind(0),e=m.target),!T)p.copyTexImage2D(e,s,o,i,r,u,f,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,i,r,u,f);break;case 35866:case 32879:We(p).copyTexSubImage3D(e,s,a,l,c,i,r,u,f);break}return m&&m.unbind(),p.bindFramebuffer(36160,y||null),d&&h.delete(),m}function eE(t){return t instanceof Ae?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:b3(t),deleteFramebuffer:!0}}function g3(t,e,n,i,r){if(t)return t;e=e||5121;const s=Fo(e,{clamped:!1}),o=h3(n);return new s(i*r*o)}const le={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function p3(t){const e=new yt(t,{format:6408,type:5126,dataFormat:6408}),n=new Ae(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const tE={[le.WEBGL2]:[!1,!0],[le.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[le.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[le.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[le.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[le.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[le.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[le.FLOAT_BLEND]:["EXT_float_blend"],[le.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[le.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[le.TEXTURE_FLOAT]:["OES_texture_float",!0],[le.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[le.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[le.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[le.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[le.COLOR_ATTACHMENT_RGBA32F]:[p3,"EXT_color_buffer_float"],[le.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[le.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[le.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[le.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[le.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[le.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},m3=2;function y3(t,e){return mp(t,e)}function mp(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>nE(t,n))}function v3(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in tE)t.luma.caps[e]===void 0&&(t.luma.caps[e]=nE(t,e));return t.luma.caps}function nE(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=_3(t,e)),t.luma.caps[e]||V.log(m3,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function _3(t,e){const n=tE[e];F(n,e);let i;const r=Z(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&!!t.getExtension(s)}else typeof r=="string"?i=!!t.getExtension(r):typeof r=="boolean"?i=r:F(!1);return i}const Py="Multiple render targets not supported";class Ae extends Bn{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Ae(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=We(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=We(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:u=void 0}=e;if(F(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const f in r){const h=r[f];(Array.isArray(h)?h[0]:h).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:c,drawBuffers:u}),r&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return F(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&V.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){F(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let c=l;if(!c)this._unattach(a);else if(c instanceof kr)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,f=0,h=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:f,level:h})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(w3(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&pp(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{f3(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return V.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return V.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return V.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return V.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return V.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return V.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=We(this.gl),l=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=hi(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?hi(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?hi(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(Sy(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>V.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Sy(this,{targetMaxHeight:100});return V.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new yt(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new kr(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new kr(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&F(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof kr?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:We(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const l=x3(r);o.framebufferTexture2D(36160,n,l,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:F(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=ZL(this.gl);n?n.readBuffer(e):F(e===36064||e===1029,Py),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=We(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):F(e.length===1&&(e[0]===36064||e[0]===1029),Py)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=v3(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function x3(t){return t<34069?t+34069:t}function w3(t){return(Ae.STATUS||{})[t]||"Framebuffer error ".concat(t)}const E3=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ae.ATTACHMENT_PARAMETERS=E3;function T3(t,e){F(t instanceof yt||t instanceof Qw||t instanceof o3);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,f=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(i,f)}function b3(t,e){const{gl:n,width:i,height:r,id:s}=t;return new Ae(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{36064:t}}))}function jl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const S3=35632,P3=35633;function A3(t){switch(t){case S3:return"fragment";case P3:return"vertex";default:return"unknown type"}}function L3(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||jl(e)||"(unnamed)",l="".concat(A3(n)," shader ").concat(a);for(let u=0;u<r.length;u++){const f=r[u];if(f.length<=1)continue;const h=f.split(":"),d=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));d!=="WARNING"?s[p]=f:o[p]=f}const c=C3(e);return{shaderName:l,errors:Ay(s,c),warnings:Ay(o,c)}}function Ay(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=iE("^^^ ".concat(a,": ").concat(c,`

`),l)}}return n}function C3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return iE(a,r-l)+n+s})}function iE(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function rE(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const M3="Shader: GLSL source code must be a JavaScript string";class Do extends Bn{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return F(!1),"unknown"}}constructor(e,n){vu(e),F(typeof n.source=="string",M3);const i=jl(n.source,null)||n.id||mi("unnamed ".concat(Do.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=jl(n,null);i&&(this.id=mi(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Do.getTypeName(this.shaderType),":").concat(this.id)}getName(){return jl(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=L3(i,this.source,this.shaderType,this.id);throw V.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),V.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Mf extends Do{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class If extends Do{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const I3={5126:oe.bind(null,"uniform1fv",ct,1,Ue),35664:oe.bind(null,"uniform2fv",ct,2,Ue),35665:oe.bind(null,"uniform3fv",ct,3,Ue),35666:oe.bind(null,"uniform4fv",ct,4,Ue),5124:oe.bind(null,"uniform1iv",Wn,1,Ue),35667:oe.bind(null,"uniform2iv",Wn,2,Ue),35668:oe.bind(null,"uniform3iv",Wn,3,Ue),35669:oe.bind(null,"uniform4iv",Wn,4,Ue),35670:oe.bind(null,"uniform1iv",Wn,1,Ue),35671:oe.bind(null,"uniform2iv",Wn,2,Ue),35672:oe.bind(null,"uniform3iv",Wn,3,Ue),35673:oe.bind(null,"uniform4iv",Wn,4,Ue),35674:oe.bind(null,"uniformMatrix2fv",ct,4,yn),35675:oe.bind(null,"uniformMatrix3fv",ct,9,yn),35676:oe.bind(null,"uniformMatrix4fv",ct,16,yn),35678:Oe,35680:Oe,5125:oe.bind(null,"uniform1uiv",qa,1,Ue),36294:oe.bind(null,"uniform2uiv",qa,2,Ue),36295:oe.bind(null,"uniform3uiv",qa,3,Ue),36296:oe.bind(null,"uniform4uiv",qa,4,Ue),35685:oe.bind(null,"uniformMatrix2x3fv",ct,6,yn),35686:oe.bind(null,"uniformMatrix2x4fv",ct,8,yn),35687:oe.bind(null,"uniformMatrix3x2fv",ct,6,yn),35688:oe.bind(null,"uniformMatrix3x4fv",ct,12,yn),35689:oe.bind(null,"uniformMatrix4x2fv",ct,8,yn),35690:oe.bind(null,"uniformMatrix4x3fv",ct,12,yn),35678:Oe,35680:Oe,35679:Oe,35682:Oe,36289:Oe,36292:Oe,36293:Oe,36298:Oe,36299:Oe,36300:Oe,36303:Oe,36306:Oe,36307:Oe,36308:Oe,36311:Oe},R3={},O3={},k3={},Ly=[0];function yp(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Ly[0]=t,t=Ly);const r=t.length;if(r%e&&V.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function ct(t,e){return yp(t,e,Float32Array,R3)}function Wn(t,e){return yp(t,e,Int32Array,O3)}function qa(t,e){return yp(t,e,Uint32Array,k3)}function Cy(t,e,n){const i=I3[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function N3(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function F3(t,e,n){for(const i in t){const r=t[i];if((!n||!!n[i])&&!D3(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function D3(t){return Array.isArray(t)||ArrayBuffer.isView(t)?B3(t):isFinite(t)||t===!0||t===!1||t instanceof Xi||t instanceof kr?!0:t instanceof Ae?!!t.texture:!1}function z3(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function B3(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Oe(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function oe(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let f=!1;if(r===null)r=new Float32Array(u),s=u,f=!0;else{F(s===u,"Uniform length cannot change.");for(let h=0;h<u;++h)if(c[h]!==r[h]){f=!0;break}}return f&&(i(o,t,a,c),r.set(c)),f}}function Ue(t,e,n,i){t[e](n,i)}function yn(t,e,n,i){t[e](n,!1,i)}const U3=5120,V3=5121,j3=5122,G3=5123,My=0,Ka=1,W3=2,H3=3,Qa=4,$3=5,Y3=6,be=5126,X3=35664,Z3=35665,q3=35666,js=5124,K3=35667,Q3=35668,J3=35669,Gs=5125,eM=36294,tM=36295,nM=36296,iM=35670,rM=35671,sM=35672,oM=35673,aM=35674,lM=35675,cM=35676,uM=35685,fM=35686,hM=35687,dM=35688,gM=35689,pM=35690,yd={[be]:[be,1,"float"],[X3]:[be,2,"vec2"],[Z3]:[be,3,"vec3"],[q3]:[be,4,"vec4"],[js]:[js,1,"int"],[K3]:[js,2,"ivec2"],[Q3]:[js,3,"ivec3"],[J3]:[js,4,"ivec4"],[Gs]:[Gs,1,"uint"],[eM]:[Gs,2,"uvec2"],[tM]:[Gs,3,"uvec3"],[nM]:[Gs,4,"uvec4"],[iM]:[be,1,"bool"],[rM]:[be,2,"bvec2"],[sM]:[be,3,"bvec3"],[oM]:[be,4,"bvec4"],[aM]:[be,8,"mat2"],[uM]:[be,8,"mat2x3"],[fM]:[be,8,"mat2x4"],[lM]:[be,12,"mat3"],[hM]:[be,12,"mat3x2"],[dM]:[be,12,"mat3x4"],[cM]:[be,16,"mat4"],[gM]:[be,16,"mat4x2"],[pM]:[be,16,"mat4x3"]};function mM(t){switch(t){case My:return My;case Ka:return Ka;case H3:return Ka;case W3:return Ka;case Qa:return Qa;case $3:return Qa;case Y3:return Qa;default:return F(!1),0}}function Iy(t){const e=yd[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function sE(t,e){switch(t){case U3:case V3:case j3:case G3:t=be;break}for(const n in yd){const[i,r,s]=yd[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class yM{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Z(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=Iy(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new ht(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=Iy(i),a=new ht({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const Ry=4,vM=35981,_M=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class oE extends Bn{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",_M),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=vM}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Mf(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new If(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,F(this.vs instanceof Mf),F(this.fs instanceof If),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(We(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new yM(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:c=5123,instanceCount:u=0,isInstanced:f=u>0,vertexArray:h=null,transformFeedback:d,framebuffer:p,parameters:_={},uniforms:T,samplers:y}=e;if((T||y)&&(V.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(T||{})),V.priority>=n){const m=p?p.id:"default",v="mode=".concat(hi(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(hi(this.gl,c)," ")+"isInstanced=".concat(f," isIndexed=").concat(l," ")+"Framebuffer=".concat(m);V.log(n,v)()}return F(h),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||f&&u===0?!1:(h.bindForDraw(r,u,()=>{if(p!==void 0&&(_=Object.assign({},_,{framebuffer:p})),d){const m=mM(i);d.begin(m)}this._bindTextures(),Xt(this.gl,_,()=>{l&&f?this.gl2.drawElementsInstanced(i,r,c,s,u):l&&Z(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,c,s):l?this.gl.drawElements(i,r,c,s):f?this.gl2.drawArraysInstanced(i,s,r,u):this.gl.drawArrays(i,s,r)}),d&&d.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V.priority>=2&&F3(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof Ae&&(s=s.texture),s instanceof Xi)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&z3(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Mf({handle:r});break;case 35632:i.fs=new If({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=mi(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),V.time(Ry,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),V.timeEnd(Ry,"linkProgram for ".concat(this._getName()))(),e.debug||V.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=N3(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Cy(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=Cy(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const xM=34918,wM=34919,EM=35007,TM=36795,bM=35976,SM=35887,PM=36202;class Mc extends Bn{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Z(e),r=mp(e,le.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:F(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(EM)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?PM:SM)}beginTransformFeedbackQuery(){return this.begin(bM)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,wM);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(TM)}getResult(){return this.gl2.getQueryParameter(this.handle,xM)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return Mc.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class aE extends Bn{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};We(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,os(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,V.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof ne?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Ja=null;function AM(t){return(!Ja||Ja.byteLength<t)&&(Ja=new ArrayBuffer(t)),Ja}function LM(t,e){const n=AM(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function CM(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const MM="elements must be GL.ELEMENT_ARRAY_BUFFER";class ut extends Bn{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Z(e)||Uw()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new ut(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return ut.MAX_ATTRIBUTES=ut.MAX_ATTRIBUTES||e.getParameter(34921),ut.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:ut._setConstantFloatArray(e,n,i);break;case Int32Array:ut._setConstantIntArray(e,n,i);break;case Uint32Array:ut._setConstantUintArray(e,n,i);break;default:F(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ut.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return F(!e||e.target===34963,MM),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=i,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),c?(F(Z(f)),h.vertexAttribIPointer(e,r,s,o,a)):f.vertexAttribPointer(e,r,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!ut.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new ne(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=LM(n.constructor,s);CM({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:F(!1)}}static _setConstantIntArray(e,n,i){switch(F(Z(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:F(!1)}}static _setConstantUintArray(e,n,i){switch(F(Z(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:F(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return F(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const IM="VertexArray: attributes must be Buffers or constants (i.e. typed array)",RM=/^(.+)__LOCATION_([0-9]+)$/,OM=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class kM{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ut(e),Xw(this,"VertexArray","v6.0",OM),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ne(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ne&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof ne&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,V.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=ht.resolve(l.accessor,c,i,r),{size:f,type:h}=u;return F(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=RM.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof ne)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof ne){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof ne){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(IM)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(ut.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){ut.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof ne){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return V.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function NM(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=zo(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function zo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return NM(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Oy(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;F(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},c=Object.keys(a).sort();let u=0;for(const d of c)!d.match(s)&&!d.match(o)&&Rf({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)d.match(o)&&Rf({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)l[d]||Rf({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;let f=0;const h={};if(!r)for(const d in i){const p=i[d];l[d]||(f++,h[d]={Type:"NOT USED: ".concat(p),[e]:zo(p)})}return{table:l,count:u,unusedTable:h,unusedCount:f}}function Rf(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=FM(o);return!s||!a?(e[r]={[n]:a?zo(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function FM(t){return t!=null}function DM(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=ky(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(zM(o.name,l))),i[a]=ky(e,r[s],l,n)}}return i}function ky(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof ne){const h=e,{data:d,changed:p}=h.getDebugData();u=p?"*":"",f=d,l=h.byteLength,a=l/d.BYTES_PER_ELEMENT/o;let _;if(n){const T=n.divisor>0;_="".concat(T?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(hi(r,s),")")}else c=!0,_="".concat(l," bytes");return{[i]:"".concat(u).concat(zo(f,{size:o,isInteger:c})),"Format ":_}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[i]:"".concat(zo(f,{size:o,isInteger:c})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function zM(t,e){const{type:n,size:i}=e,r=sE(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function BM(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=Ny(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=Ny(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function Ny(t){const{type:e,size:n}=t.accessor,i=sE(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Fy=zn()&&typeof document<"u";let UM=0;class VM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=T=>Yw(T),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:p=Fi.get("animation-loop-".concat(UM++))}=e;let{useDevicePixels:_=!0}=e;"useDevicePixelRatio"in e&&(V.deprecated("useDevicePixelRatio","useDevicePixels")(),_=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:_}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return F(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Mc.isSupported(this.gl,["timers"])?new Mc(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return V.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Fy?new Promise((e,n)=>{if(Fy&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):YC(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):$C(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?hp(this.props.gl,e):this.onCreateContext(e),!yu(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");OC(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&zC(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ae(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const ua="vs",vp="fs";function pt(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Of={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function jM(t){const e={};for(const n in t){const i=t[n],r=GM(i);e[n]=r}return e}function GM(t){let e=Dy(t);return e==="object"?t?"type"in t?Object.assign({},t,Of[t.type]):"value"in t?(e=Dy(t.value),Object.assign({type:e},t,Of[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Of[e])}function Dy(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const WM="vs",HM="fs";class zy{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:c={},inject:u={},vertexShader:f,fragmentShader:h}=e;pt(typeof n=="string"),this.name=n,this.vs=i||f,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=$M(u),o&&(this.uniforms=jM(o))}getModuleSource(e){let n;switch(e){case WM:n=this.vs||"";break;case HM:n=this.fs||"";break;default:pt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&pt(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function $M(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function YM(t){return XM(cE(t))}function XM(t){const e={},n={};return lE({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function lE(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&lE({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function cE(t,e){return t.map(n=>(n instanceof zy||(pt(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),pt(n.name,"shader module has no name"),n=new zy(n),n.dependencies=cE(n.dependencies)),n))}function ZM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const qM=7936,KM=7937,QM=7938,JM=35724,_p={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ii={};Object.keys(_p).forEach(t=>{Ii[t]=t});function eI(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function tI(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||qM),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||KM);return{gpuVendor:nI(n,i),vendor:n,renderer:i,version:t.getParameter(QM),shadingLanguageVersion:t.getParameter(JM)}}function nI(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const kf={};function By(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=_p[e];if(pt(i,e),!ZM(n))return!0;if(e in kf)return kf[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),kf[e]=l,l}function iI(t,e){const n=_p[e];pt(n,e);const i=eI(t)&&n[1]||n[0],r=typeof i=="string"?!!t.getExtension(i):i;return pt(r===!1||r===!0),r}function el(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>iI(t,n))}function rI(t){switch(tI(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function sI(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return el(t,Ii.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),el(t,Ii.GLSL_DERIVATIVES)&&By(t,Ii.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),el(t,Ii.GLSL_FRAG_DATA)&&By(t,Ii.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),el(t,Ii.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const oI=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,aI=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,lI={[ua]:oI,[vp]:aI},Gl="__LUMA_INJECT_DECLARATIONS__",Uy=/void\s+main\s*\([^)]*\)\s*\{\n?/,Vy=/}\n?[^{}]*$/,Nf=[];function jy(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===ua;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Nf.length=o.length;for(let l=0,c=o.length;l<c;++l)Nf[l]=o[l].injection;const a="".concat(Nf.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(Gl,a));break;case"vs:#main-start":r&&(t=t.replace(Uy,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(Vy,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Gl,a));break;case"fs:#main-start":r||(t=t.replace(Uy,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(Vy,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Gl,""),i&&(t=t.replace(/\}\s*$/,s=>s+lI[e])),t}function vd(t){const e={};return pt(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function as(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const uE=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],cI=[...uE,[as("attribute"),"in $1"],[as("varying"),"out $1"]],uI=[...uE,[as("varying"),"in $1"]],fE=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],fI=[...fE,[as("in"),"attribute $1"],[as("out"),"varying $1"]],hI=[...fE,[as("in"),"varying $1"]],_d="gl_FragColor",xd=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,dI=/void\s+main\s*\([^)]*\)\s*\{\n?/;function gI(t,e,n){switch(e){case 300:return n?Ic(t,cI):pI(t);case 100:return n?Ic(t,fI):mI(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Ic(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function pI(t){t=Ic(t,uI);const e=t.match(xd);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(_d,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(dI,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(_d,"\\b"),"g"),n)}return t}function mI(t){t=Ic(t,hI);const e=t.match(xd);if(e){const n=e[1];t=t.replace(xd,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),_d)}return t}const yI=`

`.concat(Gl,`

`),hE={[ua]:"vertex",[vp]:"fragment"},vI=`precision highp float;

`;function _I(t,e){const{vs:n,fs:i}=e,r=YM(e.modules||[]);return{gl:t,vs:Gy(t,Object.assign({},e,{source:n,type:ua,modules:r})),fs:Gy(t,Object.assign({},e,{source:i,type:vp,modules:r})),getUniforms:xI(r)}}function Gy(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:f}=e;pt(typeof i=="string","shader source must be a string");const h=r===ua,d=i.split(`
`);let p=100,_="",T=i;d[0].indexOf("#version ")===0?(p=300,_=d[0],T=d.slice(1).join(`
`)):_="#version ".concat(p);const y={};s.forEach(L=>{Object.assign(y,L.getDefines())}),Object.assign(y,o);let m=u?"".concat(_,`
`).concat(EI({id:n,source:i,type:r}),`
`).concat(wI({type:r}),`
`).concat(rI(t),`
`).concat(sI(t),`
`).concat(TI(y),`
`).concat(h?"":vI,`
`):"".concat(_,`
`);const v=SI(a),E={},S={},P={};for(const L in l){const C=typeof l[L]=="string"?{injection:l[L],order:0}:l[L],M=L.match(/^(v|f)s:(#)?([\w-]+)$/);if(M){const I=M[2],k=M[3];I?k==="decl"?S[L]=[C]:P[L]=[C]:E[L]=[C]}else P[L]=[C]}for(const L of s){f&&L.checkDeprecations(T,f);const C=L.getModuleSource(r,p);m+=C;const M=L.injections[r];for(const I in M){const k=I.match(/^(v|f)s:#([\w-]+)$/);if(k){const j=k[2]==="decl"?S:P;j[I]=j[I]||[],j[I].push(M[I])}else E[I]=E[I]||[],E[I].push(M[I])}}return m+=yI,m=jy(m,r,S),m+=bI(v[r],E),m+=T,m=jy(m,r,P),m=gI(m,c?100:p,h),m}function xI(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function wI(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(hE[e].toUpperCase(),`
`)}function EI(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(hE[i],`

`):""}function TI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function bI(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function SI(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const PI="void main() {gl_FragColor = vec4(0);}",dE=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,AI=`#version 300 es
`.concat(dE);function gE(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function pE(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?AI:e>300?"#version ".concat(e,`
`).concat(dE):PI;const s=MI(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function LI(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return pt(!1),null}}function CI(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return pt(!1),null}}function MI(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return pt(!1),null}}const II=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,RI={name:"fp32",vs:II,fs:null};function Bo(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Ze={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function OI(t,{precision:e=Ze.precision}={}){return t=kI(t),"".concat(parseFloat(t.toPrecision(e)))}function Zi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ti(t,e,n){return FI(t,i=>Math.max(e,Math.min(n,i)))}function ls(t,e,n){return Zi(t)?t.map((i,r)=>ls(i,e[r],n)):n*e+(1-n)*t}function Ln(t,e,n){const i=Ze.EPSILON;n&&(Ze.EPSILON=n);try{if(t===e)return!0;if(Zi(t)&&Zi(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Ln(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ze.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ze.EPSILON=i}}function kI(t){return Math.round(t/Ze.EPSILON)*Ze.EPSILON}function NI(t){return t.clone?t.clone():new Array(t.length)}function FI(t,e,n){if(Zi(t)){const i=t;n=n||NI(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function DI(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class xp extends DI(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Zi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ze)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+OI(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Ln(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ze.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function zI(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ie(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function po(t,e,n=""){if(Ze.debug&&!zI(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class mE extends xp{get x(){return this[0]}set x(e){this[0]=ie(e)}get y(){return this[1]}set y(e){this[1]=ie(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return ie(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return ie(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Bo(e>=0&&e<this.ELEMENTS,"index is out of range"),ie(this[e])}setComponent(e,n){return Bo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var mo=1e-6,qt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function BI(){var t=new qt(2);return qt!=Float32Array&&(t[0]=0,t[1]=0),t}function Wy(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function UI(t,e){return t[0]=-e[0],t[1]=-e[1],t}function yE(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function VI(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function jI(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=BI();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function GI(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function vE(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function WI(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function HI(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function _E(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}function xE(){var t=new qt(3);return qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function $I(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function Hy(t,e,n){var i=new qt(3);return i[0]=t,i[1]=e,i[2]=n,i}function YI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function XI(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function ZI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qI(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function wE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Wl(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function KI(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function wp(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function EE(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function TE(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,f=s*a-i*c,h=i*l-r*a,d=r*h-s*f,p=s*u-i*h,_=i*f-r*u,T=o*2;return u*=T,f*=T,h*=T,d*=2,p*=2,_*=2,t[0]=a+u+d,t[1]=l+f+p,t[2]=c+h+_,t}function QI(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function JI(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function eR(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function tR(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),c=Math.sqrt(s*s+o*o+a*a),u=l*c,f=u&&wE(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}var bE=YI,SE=$I,Ff=XI;(function(){var t=xE();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Df=[0,0,0];let tl;class B extends mE{static get ZERO(){return tl||(tl=new B(0,0,0),Object.freeze(tl)),tl}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Zi(e)?this.copy(e):(Ze.debug&&(ie(e),ie(n),ie(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ze.debug&&(ie(e.x),ie(e.y),ie(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ie(e)}angle(e){return tR(this,e)}cross(e){return Wl(this,this,e),this.check()}rotateX({radians:e,origin:n=Df}){return QI(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Df}){return JI(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Df}){return eR(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return wp(this,this,e),this.check()}transformAsVector(e){return vE(this,this,e),this.check()}transformByMatrix3(e){return EE(this,this,e),this.check()}transformByMatrix2(e){return WI(this,this,e),this.check()}transformByQuaternion(e){return TE(this,this,e),this.check()}}let nl;class Ep extends mE{static get ZERO(){return nl||(nl=new Ep(0,0,0,0),Object.freeze(nl)),nl}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),Zi(e)&&arguments.length===1?this.copy(e):(Ze.debug&&(ie(e),ie(n),ie(i),ie(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ze.debug&&(ie(e.x),ie(e.y),ie(e.z),ie(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ie(e)}get w(){return this[3]}set w(e){this[3]=ie(e)}transform(e){return wp(this,this,e),this.check()}transformByMatrix3(e){return _E(this,this,e),this.check()}transformByMatrix2(e){return HI(this,this,e),this.check()}transformByQuaternion(e){return TE(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class PE extends xp{toString(){let e="[";if(Ze.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=ie(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function nR(){var t=new qt(9);return qt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function iR(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function rR(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=u*o-a*c,h=-u*s+a*l,d=c*s-o*l,p=n*f+i*h+r*d;return p?(p=1/p,t[0]=f*p,t[1]=(-u*i+r*c)*p,t[2]=(a*i-r*o)*p,t[3]=h*p,t[4]=(u*n-r*l)*p,t[5]=(-a*n+r*s)*p,t[6]=d*p,t[7]=(-c*n+i*l)*p,t[8]=(o*n-i*s)*p,t):null}function sR(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function $y(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=n[0],d=n[1],p=n[2],_=n[3],T=n[4],y=n[5],m=n[6],v=n[7],E=n[8];return t[0]=h*i+d*o+p*c,t[1]=h*r+d*a+p*u,t[2]=h*s+d*l+p*f,t[3]=_*i+T*o+y*c,t[4]=_*r+T*a+y*u,t[5]=_*s+T*l+y*f,t[6]=m*i+v*o+E*c,t[7]=m*r+v*a+E*u,t[8]=m*s+v*l+E*f,t}function oR(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=h*i+d*o+c,t[7]=h*r+d*a+u,t[8]=h*s+d*l+f,t}function aR(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*i+h*o,t[1]=d*r+h*a,t[2]=d*s+h*l,t[3]=d*o-h*i,t[4]=d*a-h*r,t[5]=d*l-h*s,t[6]=c,t[7]=u,t[8]=f,t}function Yy(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function lR(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,d=r*a,p=r*l,_=s*o,T=s*a,y=s*l;return t[0]=1-f-p,t[3]=u-y,t[6]=h+T,t[1]=u+y,t[4]=1-c-p,t[7]=d-_,t[2]=h-T,t[5]=d+_,t[8]=1-c-f,t}var wd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(wd||(wd={}));const cR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ne extends PE{static get IDENTITY(){return fR()}static get ZERO(){return uR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return wd}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(cR)}fromObject(e){return this.check()}fromQuaternion(e){return lR(this,e),this.check()}set(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=s,this[5]=l,this[6]=i,this[7]=o,this[8]=c,this.check()}determinant(){return sR(this)}transpose(){return iR(this,this),this.check()}invert(){return rR(this,this),this.check()}multiplyLeft(e){return $y(this,e,this),this.check()}multiplyRight(e){return $y(this,this,e),this.check()}rotate(e){return aR(this,this,e),this.check()}scale(e){return Array.isArray(e)?Yy(this,this,e):Yy(this,this,[e,e]),this.check()}translate(e){return oR(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=VI(n||[-0,-0],e,this);break;case 3:i=EE(n||[-0,-0,-0],e,this);break;case 4:i=_E(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return po(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let il,rl;function uR(){return il||(il=new Ne([0,0,0,0,0,0,0,0,0]),Object.freeze(il)),il}function fR(){return rl||(rl=new Ne,Object.freeze(rl)),rl}function hR(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dR(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ed(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],_=e[13],T=e[14],y=e[15],m=n*a-i*o,v=n*l-r*o,E=n*c-s*o,S=i*l-r*a,P=i*c-s*a,L=r*c-s*l,C=u*_-f*p,M=u*T-h*p,I=u*y-d*p,k=f*T-h*_,W=f*y-d*_,j=h*y-d*T,H=m*j-v*W+E*k+S*I-P*M+L*C;return H?(H=1/H,t[0]=(a*j-l*W+c*k)*H,t[1]=(r*W-i*j-s*k)*H,t[2]=(_*L-T*P+y*S)*H,t[3]=(h*P-f*L-d*S)*H,t[4]=(l*I-o*j-c*M)*H,t[5]=(n*j-r*I+s*M)*H,t[6]=(T*E-p*L-y*v)*H,t[7]=(u*L-h*E+d*v)*H,t[8]=(o*W-a*I+c*C)*H,t[9]=(i*I-n*W-s*C)*H,t[10]=(p*P-_*E+y*m)*H,t[11]=(f*E-u*P-d*m)*H,t[12]=(a*M-o*k-l*C)*H,t[13]=(n*k-i*M+r*C)*H,t[14]=(_*v-p*S-T*m)*H,t[15]=(u*S-f*v+h*m)*H,t):null}function gR(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],d=t[12],p=t[13],_=t[14],T=t[15],y=e*o-n*s,m=e*a-i*s,v=e*l-r*s,E=n*a-i*o,S=n*l-r*o,P=i*l-r*a,L=c*p-u*d,C=c*_-f*d,M=c*T-h*d,I=u*_-f*p,k=u*T-h*p,W=f*T-h*_;return y*W-m*k+v*I+E*M-S*C+P*L}function Ui(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],d=e[10],p=e[11],_=e[12],T=e[13],y=e[14],m=e[15],v=n[0],E=n[1],S=n[2],P=n[3];return t[0]=v*i+E*a+S*f+P*_,t[1]=v*r+E*l+S*h+P*T,t[2]=v*s+E*c+S*d+P*y,t[3]=v*o+E*u+S*p+P*m,v=n[4],E=n[5],S=n[6],P=n[7],t[4]=v*i+E*a+S*f+P*_,t[5]=v*r+E*l+S*h+P*T,t[6]=v*s+E*c+S*d+P*y,t[7]=v*o+E*u+S*p+P*m,v=n[8],E=n[9],S=n[10],P=n[11],t[8]=v*i+E*a+S*f+P*_,t[9]=v*r+E*l+S*h+P*T,t[10]=v*s+E*c+S*d+P*y,t[11]=v*o+E*u+S*p+P*m,v=n[12],E=n[13],S=n[14],P=n[15],t[12]=v*i+E*a+S*f+P*_,t[13]=v*r+E*l+S*h+P*T,t[14]=v*s+E*c+S*d+P*y,t[15]=v*o+E*u+S*p+P*m,t}function Rc(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,c,u,f,h,d,p,_,T,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],d=e[7],p=e[8],_=e[9],T=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=d,t[8]=p,t[9]=_,t[10]=T,t[11]=y,t[12]=o*i+u*r+p*s+e[12],t[13]=a*i+f*r+_*s+e[13],t[14]=l*i+h*r+T*s+e[14],t[15]=c*i+d*r+y*s+e[15]),t}function Tp(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function pR(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,c,u,f,h,d,p,_,T,y,m,v,E,S,P,L,C,M,I,k,W,j,H,et;return a<mo?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,f=e[0],h=e[1],d=e[2],p=e[3],_=e[4],T=e[5],y=e[6],m=e[7],v=e[8],E=e[9],S=e[10],P=e[11],L=r*r*u+c,C=s*r*u+o*l,M=o*r*u-s*l,I=r*s*u-o*l,k=s*s*u+c,W=o*s*u+r*l,j=r*o*u+s*l,H=s*o*u-r*l,et=o*o*u+c,t[0]=f*L+_*C+v*M,t[1]=h*L+T*C+E*M,t[2]=d*L+y*C+S*M,t[3]=p*L+m*C+P*M,t[4]=f*I+_*k+v*W,t[5]=h*I+T*k+E*W,t[6]=d*I+y*k+S*W,t[7]=p*I+m*k+P*W,t[8]=f*j+_*H+v*et,t[9]=h*j+T*H+E*et,t[10]=d*j+y*H+S*et,t[11]=p*j+m*H+P*et,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function AE(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+f*i,t[7]=l*r+h*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=f*r-a*i,t[11]=h*r-l*i,t}function mR(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-f*i,t[3]=l*r-h*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+f*r,t[11]=l*i+h*r,t}function LE(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+f*i,t[3]=l*r+h*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=f*r-a*i,t[7]=h*r-l*i,t}function yR(t,e){var n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,c,u),t}function vR(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,d=r*a,p=r*l,_=s*o,T=s*a,y=s*l;return t[0]=1-f-p,t[1]=u+y,t[2]=h-T,t[3]=0,t[4]=u-y,t[5]=1-c-p,t[6]=d+_,t[7]=0,t[8]=h+T,t[9]=d-_,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _R(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function xR(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var wR=xR;function ER(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}var TR=ER;function bR(t,e,n,i){var r,s,o,a,l,c,u,f,h,d,p=e[0],_=e[1],T=e[2],y=i[0],m=i[1],v=i[2],E=n[0],S=n[1],P=n[2];return Math.abs(p-E)<mo&&Math.abs(_-S)<mo&&Math.abs(T-P)<mo?hR(t):(u=p-E,f=_-S,h=T-P,d=1/Math.hypot(u,f,h),u*=d,f*=d,h*=d,r=m*h-v*f,s=v*u-y*h,o=y*f-m*u,d=Math.hypot(r,s,o),d?(d=1/d,r*=d,s*=d,o*=d):(r=0,s=0,o=0),a=f*o-h*s,l=h*r-u*o,c=u*s-f*r,d=Math.hypot(a,l,c),d?(d=1/d,a*=d,l*=d,c*=d):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(r*p+s*_+o*T),t[13]=-(a*p+l*_+c*T),t[14]=-(u*p+f*_+h*T),t[15]=1,t)}function SR(){var t=new qt(4);return qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function PR(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function bp(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function AR(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function LR(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function CR(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}function MR(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function IR(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t}function Es(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function RR(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,f=c*r+l*i-o*s,h=c*s+o*r-a*i,d=-o*i-a*r-l*s;return t[0]=u*c+d*-o+f*-l-h*-a,t[1]=f*c+d*-a+h*-o-u*-l,t[2]=h*c+d*-l+u*-a-f*-o,t[3]=e[3],t}(function(){var t=SR();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Td;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Td||(Td={}));const OR=45*Math.PI/180,kR=1,zf=.1,Bf=500,NR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ke extends PE{static get IDENTITY(){return DR()}static get ZERO(){return FR()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Td}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,f,h,d,p,_,T){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=_,this[15]=T,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,f,h,d,p,_,T){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=f,this[11]=_,this[12]=r,this[13]=l,this[14]=h,this[15]=T,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(NR)}fromObject(e){return this.check()}fromQuaternion(e){return vR(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=zf,far:a=Bf}=e;return a===1/0?zR(this,n,i,r,s,o):_R(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return bR(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=zf,far:a=Bf}=e;return TR(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=OR,aspect:i=kR,focalDistance:r=1,near:s=zf,far:o=Bf}=e;Xy(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return Xy(n),wR(this,n,i,r,s),this.check()}determinant(){return gR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return dR(this,this),this.check()}invert(){return Ed(this,this),this.check()}multiplyLeft(e){return Ui(this,e,this),this.check()}multiplyRight(e){return Ui(this,this,e),this.check()}rotateX(e){return AE(this,this,e),this.check()}rotateY(e){return mR(this,this,e),this.check()}rotateZ(e){return LE(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return pR(this,this,e,n),this.check()}scale(e){return Tp(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Rc(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Es(n||[-0,-0,-0,-0],e,this),po(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=jI(n||[-0,-0],e,this);break;case 3:r=wp(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return po(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=GI(n||[-0,-0],e,this);break;case 3:i=vE(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return po(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let sl,ol;function FR(){return sl||(sl=new Ke([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(sl)),sl}function DR(){return ol||(ol=new Ke,Object.freeze(ol)),ol}function Xy(t){if(t>Math.PI*2)throw Error("expected radians")}function zR(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}function Zy(){var t=new qt(4);return qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function BR(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function CE(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function qy(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+r*c-s*l,t[1]=r*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-r*a,t[3]=o*u-i*a-r*l-s*c,t}function UR(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a,t}function VR(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a,t}function jR(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function GR(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function Hl(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3],l=n[0],c=n[1],u=n[2],f=n[3],h,d,p,_,T;return d=r*l+s*c+o*u+a*f,d<0&&(d=-d,l=-l,c=-c,u=-u,f=-f),1-d>mo?(h=Math.acos(d),p=Math.sin(h),_=Math.sin((1-i)*h)/p,T=Math.sin(i*h)/p):(_=1-i,T=i),t[0]=_*r+T*l,t[1]=_*s+T*c,t[2]=_*o+T*u,t[3]=_*a+T*f,t}function WR(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function HR(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ME(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[s*3+s]-e[o*3+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+r]+e[r*3+s])*i,t[o]=(e[o*3+r]+e[r*3+o])*i}return t}var $R=PR,YR=bp,XR=MR,ZR=IR,qR=AR,KR=LR,IE=CR,QR=function(){var t=xE(),e=Hy(1,0,0),n=Hy(0,1,0);return function(i,r,s){var o=wE(r,s);return o<-.999999?(Wl(t,e,r),SE(t)<1e-6&&Wl(t,n,r),qI(t,t),CE(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Wl(t,r,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,IE(i,i))}}();(function(){var t=Zy(),e=Zy();return function(n,i,r,s,o,a){return Hl(t,i,o,a),Hl(e,r,s,a),Hl(n,t,e,2*a*(1-a)),n}})();(function(){var t=nR();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],IE(e,ME(e,t))}})();const JR=[0,0,0,1];class Ky extends xp{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return ME(this,e),this.check()}fromAxisRotation(e,n){return CE(this,e,n),this.check()}identity(){return BR(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ie(e)}get y(){return this[1]}set y(e){this[1]=ie(e)}get z(){return this[2]}set z(e){this[2]=ie(e)}get w(){return this[3]}set w(e){this[3]=ie(e)}len(){return qR(this)}lengthSquared(){return KR(this)}dot(e){return XR(this,e)}rotationTo(e,n){return QR(this,e,n),this.check()}add(e){return $R(this,this,e),this.check()}calculateW(){return GR(this,this),this.check()}conjugate(){return HR(this,this),this.check()}invert(){return WR(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(ZR(this,e,n,i),this.check())}multiplyRight(e){return qy(this,this,e),this.check()}multiplyLeft(e){return qy(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return UR(this,this,e),this.check()}rotateY(e){return VR(this,this,e),this.check()}rotateZ(e){return jR(this,this,e),this.check()}scale(e){return YR(this,this,e),this.check()}slerp(e,n,i){let r,s,o;switch(arguments.length){case 1:({start:r=JR,target:s,ratio:o}=e);break;case 2:r=this,s=e,o=n;break;default:r=e,s=n,o=i}return Hl(this,r,s,o),this.check()}transformVector4(e,n=new Ep){return RR(n,e,this),po(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const RE={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Qy=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,eO={lightSources:{}};function Uf(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function tO(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=Uf(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=Uf(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=Uf(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function OE(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eO;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},tO({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return OE({lightSources:e})}return{}}const nO={name:"lights",vs:Qy,fs:Qy,getUniforms:OE,defines:{MAX_LIGHTS:3}},iO=new Uint8Array([0,255,255,255]),rO={pickingSelectedColor:null,pickingHighlightColor:iO,pickingActive:!1,pickingAttribute:!1};function sO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rO;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const oO=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,aO=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,lO={name:"picking",vs:oO,fs:aO,getUniforms:sO},cO=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,uO={};function fO(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function hO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uO;if(!("material"in t))return{};const{material:e}=t;return e?fO(e):{lighting_uEnabled:!1}}const dO={name:"gouraud-lighting",dependencies:[nO],vs:cO,defines:{LIGHTING_VERTEX:1},getUniforms:hO},gO=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,pO={name:"transform",vs:gO,fs:null};class fa{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new fa(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),f=this._getHash(i),h=c.map(v=>this._getHash(v.name)).sort(),d=o.map(v=>this._getHash(v)),p=Object.keys(r).sort(),_=Object.keys(s).sort(),T=[],y=[];for(const v of p)T.push(this._getHash(v)),T.push(this._getHash(r[v]));for(const v of _)y.push(this._getHash(v)),y.push(this._getHash(s[v]));const m="".concat(u,"/").concat(f,"D").concat(T.join("/"),"M").concat(h.join("/"),"I").concat(y.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[m]){const v=_I(this.gl,{vs:n,fs:i,modules:c,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[m]=new oE(this.gl,{hash:m,vs:v.vs,fs:v.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=v.getUniforms||(E=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const mO={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function yO(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=vO(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,c={...o};delete c.value,i[a]=[new ne(t,l),c],_O(s,c)}}if(r){const s=r.value||r;F(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new ne(t,{data:s,target:34963}),o]}return i}function vO(t,e){const{attributeMap:n=mO}=e||{};return n&&n[t]||t}function _O(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}F(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const mr=2,xO=1e4,wO="Model needs drawMode and vertexCount",Jy=()=>{},EO={};class qi{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=mi("model")}=n;F(yu(e)),this.id=i,this.gl=e,this.id=n.id||mi("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||fa.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},F(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),wO)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return F(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return F(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=yO(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(os(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return pp(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let c;V.priority>=mr&&(c=this._logDrawCallStart(mr));const u=this.vertexArray.getDrawParams(),{isIndexed:f=u.isIndexed,indexType:h=u.indexType,indexOffset:d=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&V.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:_,instanceCount:T}=this,{onBeforeRender:y=Jy,onAfterRender:m=Jy}=this.props;y(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(EO,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:_,instanceCount:T,offset:f?d:0}));return m(),V.priority>=mr&&this._logDrawCallEnd(c,l,i),v}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{35977:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return V.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}F(n instanceof oE,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new kM(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof ne&&n.delete()}}_setAnimationProps(e){this.animated&&F(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(os(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new aE(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:xO;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),V.group(mr,">>> DRAWING MODEL ".concat(this.id),{collapsed:V.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=DM({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Oy({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:u}=Oy({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&V.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&V.log("UNUSED UNIFORMS",Object.keys(a))();const f=BM(this.vertexArray.configuration);V.table(e,s)(),V.table(e,o)(),V.table(e+1,f)(),r&&r.log({logLevel:mr,message:"Rendered to ".concat(r.id)}),V.groupEnd(mr)()}}class TO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof ne?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&F(Z(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:c})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new aE(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],F(i[s]instanceof ne)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new ne(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const bO="transform_uSampler_",Oc="transform_uSize_",ev="transform_position";function SO(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const l={};let c=e,u={};if(o>0||i){const f=c.split(`
`),h=f.slice();if(f.forEach((d,p,_)=>{if(o>0){const T=MO(d,n);if(T){const{updatedLine:y,inject:m}=T;h[p]=y,u=vd([u,m]),Object.assign(l,T.samplerTextureMap),o--}}i&&!a&&(a=CO(d,i))}),i){F(r);const d="".concat(Oc).concat(i),p="uniform vec2 ".concat(d,`;
`),_="     vec2 ".concat(ev," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(ev,`, 0, 1.);
`);u=vd([u,{"vs:#decl":p,"vs:#main-start":_}])}c=h.join(`
`)}return{vs:c,targetTextureType:a,inject:u,samplerTextureMap:l}}function PO(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(Oc).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(Oc).concat(a)]=[s,o];return r}function AO(t){return gE(t,["attribute","in"])}function LO(t){const e="".concat(bO).concat(t),n="".concat(Oc).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function CO(t,e){const n=gE(t,["varying","out"]);return n&&n.name===e?n.type:null}function MO(t,e){const n={},i=AO(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:c}=LO(s),u=LI(r),f="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}const IO={10241:9728,10240:9728,10242:33071,10243:33071},RO="transform_output";class OO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=i[h]}this._setSourceTextureParameters();const u=PO({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=_u(n);if(!e)return i;const r=i.constructor,s=CI(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<s;c++)o[a++]=i[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof yt)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new ne(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{36064:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new Ae(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{36064:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(IO)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=T3(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=SO({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=vd([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||pE({version:rE(r),input:this.targetTextureVarying,inputType:o,output:RO}),f=this.hasSourceTextures||this.targetTextureVarying?[pO].concat(e.modules||[]):e.modules;return{vs:r,fs:u,modules:f,uniforms:s,inject:c}}}class Sp{static isSupported(e){return Z(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();F(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new qi(n,Object.assign({},e,{fs:e.fs||pE({version:rE(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){kO(n)&&(this.bufferTransform=new TO(e,n)),NO(n)&&(this.textureTransform=new OO(e,n)),F(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function kO(t){return!!(!os(t.feedbackBuffers)||!os(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function NO(t){return!!(!os(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const tv={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ha{static get DRAW_MODE(){return tv}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=mi("geometry"),drawMode:i=tv.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,F(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(F(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return F(Number.isFinite(i)),i}}let FO=1,DO=1;class kE{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=FO++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=DO++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const zO=[255,255,255],BO=1;let UO=0;class VO{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","ambient");const{color:n=zO}=e,{intensity:i=BO}=e;this.id=e.id||"ambient-".concat(UO++),this.color=n,this.intensity=i}}const jO=[255,255,255],GO=1,WO=[0,0,-1];let HO=0;class nv{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","directional"),g(this,"direction",void 0),g(this,"shadow",void 0);const{color:n=jO}=e,{intensity:i=GO}=e,{direction:r=WO}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(HO++),this.color=n,this.intensity=i,this.type="directional",this.direction=new B(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class $O{constructor(e,n={id:"pass"}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Pp extends $O{constructor(...e){super(...e),g(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return kn(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const c=this.gl;l&&XO(c,n),a&&(this._lastRenderIndex=-1);const u=[];for(const f of r){const h=s&&s[f.id];o==null||o(f);const d=this._getDrawLayerParams(f,e),p=f.subViewports||[f];for(const _ of p){const T=this._drawLayersInViewport(c,{target:n,moduleParameters:i,viewport:_,view:h,pass:e.pass,layers:e.layers},d);u.push(T)}}return u}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){const u=[],f=NE(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:o},d={};for(let p=0;p<n.length;p++){const _=n[p],T=this._shouldDrawLayer(_,h,s,d),y={shouldDrawLayer:T};T&&!c&&(y.layerRenderIndex=f(_,T),y.moduleParameters=this._getModuleParameters(_,a,i,l),y.layerParameters=this.getLayerParameters(_,p,e)),u[p]=y}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=YO(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;Xt(e,{scissorTest:!0,scissor:c},()=>pp(e,f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};kn(e,{viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:_,layerParameters:T}=l[f];if(d&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),_.viewport=o;try{h._drawLayer({moduleParameters:_,uniforms:{layerIndex:p},parameters:T})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(r))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ss(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function NE(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||NE(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function YO(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||ss(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function XO(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;kn(t,{viewport:[0,0,n,i]}),t.clear(16640)}class ZO extends Pp{constructor(e,n){super(e,n),g(this,"shadowMap",void 0),g(this,"depthBuffer",void 0),g(this,"fbo",void 0),this.shadowMap=new yt(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new kr(e,{format:33189,width:1,height:1}),this.fbo=new Ae(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Xt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=ss(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const FE="#define SMOOTH_EDGE_RADIUS 0.5",qO=`
`.concat(FE,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),KO=`
`.concat(FE,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),QO={name:"geometry",vs:qO,fs:KO},JO=Object.keys(Q).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Q[t],";")).join(""),ek=Object.keys(jt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(jt[t],";")).join(""),tk=Object.keys(Yi).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Yi[t],";")).join(""),nk="".concat(JO,`
`).concat(ek,`
`).concat(tk,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function ik(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function da(t){let e={},n;return i=>{for(const r in i)if(!ik(i[r],e[r])){n=t(i),e=i;break}return n}}const iv=[0,0,0,0],rk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],DE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sk=[0,0,0],zE=[0,0,0],ok=da(ck);function BE(t,e,n=zE){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===Q.LNGLAT_OFFSETS||e===Q.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case jt.WEB_MERCATOR:(e===Q.LNGLAT||e===Q.CARTESIAN)&&(r=[0,0,0],s=!1);break;case jt.WEB_MERCATOR_AUTO_OFFSET:e===Q.LNGLAT?i=r:e===Q.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case jt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case jt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function ak(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=iv,l=iv,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=BE(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Es([],l,o),s=i||s,o=Ui([],r,s),o=Ui([],o,rk)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function lk({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Q.DEFAULT,coordinateOrigin:r=zE,autoWrapLongitude:s=!1}){i===Q.DEFAULT&&(i=t.isGeospatial?Q.LNGLAT:Q.CARTESIAN);const o=ok({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||DE,o}function ck({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=ak(t,n,i),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=Es([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:sk,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:DE,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case Q.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case Q.LNGLAT:case Q.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case Q.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const uk={};function fk(t=uk){return"viewport"in t?lk(t):{}}const Ap={name:"project",dependencies:[RI,QO],vs:nk,getUniforms:fk};function hk(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xr(t,e){const n=Es([],e,t);return bp(n,n,1/n[3]),n}function rv(t,e){const n=t%e;return n<0?e+n:n}function bd(t,e,n){return t<e?e:t>n?n:t}function dk(t){return Math.log(t)*Math.LOG2E}const Lp=Math.log2||dk;function Nn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Gt=Math.PI,UE=Gt/4,Mt=Gt/180,Sd=180/Gt,cs=512,kc=4003e4,al=85.051129,gk=1.5;function pk(t){return Lp(t)}function us(t){const[e,n]=t;Nn(Number.isFinite(e)),Nn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Mt,r=n*Mt,s=cs*(i+Gt)/(2*Gt),o=cs*(Gt+Math.log(Math.tan(UE+r*.5)))/(2*Gt);return[s,o]}function fs(t){const[e,n]=t,i=e/cs*(2*Gt)-Gt,r=2*(Math.atan(Math.exp(n/cs*(2*Gt)-Gt))-UE);return[i*Sd,r*Sd]}function mk(t){const{latitude:e}=t;Nn(Number.isFinite(e));const n=Math.cos(e*Mt);return pk(kc*n)-9}function Vf(t){const e=Math.cos(t*Mt);return cs/kc/e}function Pd(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Nn(Number.isFinite(e)&&Number.isFinite(n));const r=cs,s=Math.cos(e*Mt),o=r/360,a=o/s,l=r/kc/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=Mt*Math.tan(e*Mt)/s,f=o*u/2,h=r/kc*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function VE(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Pd({longitude:n,latitude:i,highPrecision:!0}),u=us(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=fs(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[f[0],f[1],h]:f}function yk(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=hk();Rc(a,a,[0,0,-r]),AE(a,a,-n*Mt),LE(a,a,i*Mt);const l=s/e;return Tp(a,a,[l,l,l]),o&&Rc(a,a,ZI([],o)),a}function vk(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Nc(gk)}=t;i!==void 0&&(u=Nc(i));const f=u*Mt,h=r*Mt,d=jE(u);let p=d;o&&(p+=o[2]*a/Math.cos(h)/n);const _=f*(.5+(s?s[1]:0)/n),T=Math.sin(_)*p/Math.sin(bd(Math.PI/2-h-_,.01,Math.PI-.01)),y=Math.sin(h)*T+p,m=p*10,v=Math.min(y*c,m);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:v}}function Nc(t){return 2*Math.atan(.5/t)*Sd}function jE(t){return .5/Math.tan(.5*t*Mt)}function GE(t,e){const[n,i,r=0]=t;return Nn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Xr(e,[n,i,r,1])}function Cp(t,e,n=0){const[i,r,s]=t;if(Nn(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Xr(e,[i,r,s,1]);const o=Xr(e,[i,r,0,1]),a=Xr(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return yE([],o,a,u)}function _k(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,f=xk(t.padding),h=us([a,bd(u,-al,al)]),d=us([c,bd(l,-al,al)]),p=[Math.max(Math.abs(d[0]-h[0]),r),Math.max(Math.abs(d[1]-h[1]),r)],_=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];Nn(_[0]>0&&_[1]>0);const T=_[0]/p[0],y=_[1]/p[1],m=(f.right-f.left)/2/T,v=(f.top-f.bottom)/2/y,E=[(d[0]+h[0])/2+m,(d[1]+h[1])/2+v],S=fs(E),P=Math.min(s,Lp(Math.abs(Math.min(T,y))));return Nn(Number.isFinite(P)),{longitude:S[0],latitude:S[1],zoom:P}}function xk(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Nn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const sv=Math.PI/180;function wk(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*sv:Math.atan(.5/t.altitude),f=(90-t.pitch)*sv;return u>f-.01?(l=ov(t,0,e),c=ov(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function ov(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Xr(i,[e,0,1,1]),s=Xr(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=yE([],r,s,a),c=fs(l);return c.push(n),c}const av=512;function Ek(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=rv(r+180,360)-180),(a<-180||a>180)&&(a=rv(a+180,360)-180);const l=Lp(n/av);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=fs([0,c])[1];if(s<u)s=u;else{const f=fs([0,av-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const Tk=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,bk=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Sk=da(Mk),Pk=da(Ik),Ak=[0,0,0,1],Lk=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Ck(t,e){const[n,i,r]=t,s=Cp([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function Mk({viewport:t,center:e}){return new Ke(t.viewProjectionMatrix).invert().transform(e)}function Ik({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Ck(o,i));for(const o of e){const a=o.clone().translate(new B(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Ke().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function Rk(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Ak,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=Sk({viewport:t.viewport,center:e.project_uCenter}),s=[],o=Pk({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new B(t.viewport.center).negate());e.project_uCoordinateSystem===Q.LNGLAT&&e.project_uProjectionMode===jt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight(Lk),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const jf={name:"shadow",dependencies:[Ap],vs:Tk,fs:bk,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?Rk(t,e):{}},Ok={color:[255,255,255],intensity:1},lv=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],kk=[0,0,0,200/255];class WE{constructor(e={}){g(this,"id","lighting-effect"),g(this,"props",void 0),g(this,"shadowColor",kk),g(this,"shadow",void 0),g(this,"ambientLight",void 0),g(this,"directionalLights",void 0),g(this,"pointLights",void 0),g(this,"shadowPasses",[]),g(this,"shadowMaps",[]),g(this,"dummyShadowMap",null),g(this,"programManager",void 0),g(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=fa.getDefaultProgramManager(e),jf&&this.programManager.addDefaultModule(jf)),this.dummyShadowMap||(this.dummyShadowMap=new yt(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(jf),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Ke().lookAt({eye:new B(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new ZO(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new VO(Ok),this.directionalLights.push(new nv(lv[0]),new nv(lv[1])))}}class Nk{constructor(e={}){g(this,"_pool",[]),g(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*i+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const hs=new Nk;function eo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fk(t){return[t[12],t[13],t[14]]}function Dk(t){return{left:yr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:yr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:yr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:yr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:yr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:yr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const cv=new B;function yr(t,e,n,i){cv.set(t,e,n);const r=cv.len();return{distance:i/r,normal:new B(-t/r,-e/r,-n/r)}}function zk(t){return t-Math.fround(t)}let Ws;function Gf(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;Ws=hs.allocate(Ws,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];Ws[a+l]=c,Ws[a+l+n]=zk(c)}a+=n*2}return Ws.subarray(0,s*n*2)}function Bk(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const Uk=Math.PI/180,Vk=eo(),uv=[0,0,0],jk={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Gk({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new Ke().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new Ke().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:d=0}=s,p=ti((u+t-f)/2,0,t)-t/2,_=ti((h+e-d)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=_*2/e}return c}class or{constructor(e={}){g(this,"id",void 0),g(this,"x",void 0),g(this,"y",void 0),g(this,"width",void 0),g(this,"height",void 0),g(this,"padding",void 0),g(this,"isGeospatial",void 0),g(this,"zoom",void 0),g(this,"focalDistance",void 0),g(this,"position",void 0),g(this,"modelMatrix",void 0),g(this,"distanceScales",void 0),g(this,"scale",void 0),g(this,"center",void 0),g(this,"cameraPosition",void 0),g(this,"projectionMatrix",void 0),g(this,"viewMatrix",void 0),g(this,"viewMatrixUncentered",void 0),g(this,"viewMatrixInverse",void 0),g(this,"viewProjectionMatrix",void 0),g(this,"pixelProjectionMatrix",void 0),g(this,"pixelUnprojectionMatrix",void 0),g(this,"resolution",void 0),g(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||jk,this.focalDistance=e.focalDistance||1,this.position=e.position||uv,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?jt.WEB_MERCATOR:jt.WEB_MERCATOR_AUTO_OFFSET:jt.IDENTITY}equals(e){return e instanceof or?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ln(e.projectionMatrix,this.projectionMatrix)&&Ln(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=GE(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=Cp([r,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=us(e);return n[1]=ti(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?fs(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Pd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Dk(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=mk({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Pd({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=uv;if(s&&(a=o?new Ke(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new B(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=Vk,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ke().multiplyRight(n).translate(new B(this.center).negate()),this.projectionMatrix=i||Gk({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*Uk,focalDistance:u,padding:c,near:a,far:l});const f=eo();Ui(f,f,this.projectionMatrix),Ui(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Ed([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Fk(this.viewMatrixInverse);const h=eo(),d=eo();Tp(h,h,[this.width/2,-this.height/2,1]),Rc(h,h,[1,-1,0]),Ui(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Ed(eo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Y.warn("Pixel project matrix not invertible")()}}g(or,"displayName","Viewport");class yi extends or{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:_,padding:T,legacyMeterSizes:y=!1}=e;let{width:m,height:v,altitude:E=1.5}=e;const S=Math.pow(2,r);m=m||1,v=v||1;let P,L=null;if(h)E=h[5]/2,P=Nc(E);else{e.fovy?(P=e.fovy,E=jE(P)):P=Nc(E);let M;if(T){const{top:I=0,bottom:k=0}=T;M=[0,ti((I+v-k)/2,0,v)-v/2]}L=vk({width:m,height:v,scale:S,center:_&&[0,0,_[2]*Vf(n)],offset:M,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(L.near=c),Number.isFinite(u)&&(L.far=u)}let C=yk({height:v,pitch:s,bearing:o,scale:S,altitude:E});p&&(C=new Ke().translate([512*p,0,0]).multiplyLeft(C)),super({...e,width:m,height:v,viewMatrix:C,longitude:i,latitude:n,zoom:r,...L,fovy:P,focalDistance:E}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"pitch",void 0),g(this,"bearing",void 0),g(this,"altitude",void 0),g(this,"fovy",void 0),g(this,"orthographic",void 0),g(this,"_subViewports",void 0),g(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=P,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new yi({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Vf(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Vf(i);return[n,i,r]}addMetersToLngLat(e,n){return VE(e,n)}panByPosition(e,n){const i=Cp(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Wy([],r,UI([],i)),o=Wy([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=wk(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=_k({width:i,height:r,bounds:e,...n});return new yi({width:i,height:r,longitude:s,latitude:o,zoom:a})}}g(yi,"displayName","WebMercatorViewport");const fv=[0,0,0];function Wf(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof yi){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function Wk(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===Q.DEFAULT&&(r=e.isGeospatial?Q.LNGLAT:Q.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function HE(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Es([],[o,a,l,1],n)),i){case Q.LNGLAT:return Wf([o,a,l],e,s);case Q.LNGLAT_OFFSETS:return Wf([o+r[0],a+r[1],l+(r[2]||0)],e,s);case Q.METER_OFFSETS:return Wf(VE(r,[o,a,l]),e,s);case Q.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function Hk(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=Wk(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=fv,shaderCoordinateOrigin:u=fv,offsetMode:f=!1}=l?BE(n,i,r):{},h=HE(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const d=n.projectPosition(c||u);bE(h,h,d)}return h}const hv={blendFunc:[1,0,32771,0],blendEquation:32774};class $E extends Pp{constructor(...e){super(...e),g(this,"pickZ",void 0),g(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p,moduleParameters:_}){const T=this.gl;this.pickZ=p;const y=this._resetColorEncoder(p),m=Xt(T,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...hv,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(E=>E.useInPicking),pass:d,isPicking:!0,moduleParameters:_}));return this._colorEncoderState=null,{decodePickingColor:y&&Yk.bind(null,y),stats:m}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(Object.assign(r,hv),r.blend=!0,r.blendColor=$k(this._colorEncoderState,e,i)):r.blend=!1,o.includes("terrain")&&(r.blend=!1),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function $k(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(Y.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function Yk(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const wr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Fc=Symbol.for("component"),di=Symbol.for("propTypes"),Hf=Symbol.for("deprecatedProps"),Zr=Symbol.for("asyncPropDefaults"),Ki=Symbol.for("asyncPropOriginal"),ni=Symbol.for("asyncPropResolved");function xu(t,e=()=>!0){return Array.isArray(t)?YE(t,e,[]):e(t)?[t]:[]}function YE(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?YE(r,e,n):e(r)&&n.push(r)}return n}function Xk({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class Zk{constructor(e,n,i){g(this,"id",void 0),g(this,"context",void 0),g(this,"isLoaded",void 0),g(this,"persistent",void 0),g(this,"_loadCount",0),g(this,"_subscribers",new Set),g(this,"_data",void 0),g(this,"_loader",void 0),g(this,"_error",void 0),g(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=Ac(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class qk{constructor({gl:e,protocol:n}){g(this,"protocol",void 0),g(this,"_context",void 0),g(this,"_resources",void 0),g(this,"_consumers",void 0),g(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new Zk(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const Kk=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ga={name:"project32",dependencies:[Ap],vs:Kk},pa={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...lO},Qk=[Ap],Jk=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function eN(t){const e=fa.getDefaultProgramManager(t);for(const n of Qk)e.addDefaultModule(n);for(const n of Jk)e.addShaderHook(n);return e}const tN="layerManager.setLayers",nN="layerManager.activateViewport";class iN{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){g(this,"layers",void 0),g(this,"context",void 0),g(this,"resourceManager",void 0),g(this,"_lastRenderedLayers",[]),g(this,"_needsRedraw",!1),g(this,"_needsUpdate",!1),g(this,"_nextLayers",null),g(this,"_debug",!1),g(this,"activateViewport",o=>{Ve(nN,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new qk({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&eN(e),stats:i||new dp({id:"deck.gl"}),viewport:r||new or({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new kE,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ve(tN,this,n,e),this._lastRenderedLayers=e;const i=xu(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?Y.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&Y.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=wr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=wr.MATCHED,n!==e&&(e.lifecycle=wr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=wr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=wr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Wt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Wt(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Wt(t[s],e[s],n-1))return!1;return!0}return!1}class rN{constructor(e){g(this,"width",void 0),g(this,"height",void 0),g(this,"views",void 0),g(this,"viewState",void 0),g(this,"controllers",void 0),g(this,"timeline",void 0),g(this,"_viewports",void 0),g(this,"_viewportMap",void 0),g(this,"_isUpdating",void 0),g(this,"_needsRedraw",void 0),g(this,"_needsUpdate",void 0),g(this,"_eventManager",void 0),g(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=xu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Wt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Y.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s&&i){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==s.type)&&(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const sN=/([0-9]+\.?[0-9]*)(%|px)/;function Hn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=sN.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function $n(t,e){return t.relative?Math.round(t.position*e):t.position}function Me(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class ds{constructor(e){g(this,"id",void 0),g(this,"viewportInstance",void 0),g(this,"_x",void 0),g(this,"_y",void 0),g(this,"_width",void 0),g(this,"_height",void 0),g(this,"_padding",void 0),g(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Me(!l||l instanceof or),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Hn(i),this._y=Hn(r),this._width=Hn(s),this._height=Hn(o),this._padding=a&&{left:Hn(a.left||0),right:Hn(a.right||0),top:Hn(a.top||0),bottom:Hn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Wt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return!r.height||!r.width?null:new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:$n(this._x,e),y:$n(this._y,n),width:$n(this._width,e),height:$n(this._height,n)};return this._padding&&(i.padding={left:$n(this._padding.left,e),top:$n(this._padding.top,n),right:$n(this._padding.right,e),bottom:$n(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ma{constructor(e){g(this,"_inProgress",void 0),g(this,"_handle",void 0),g(this,"_timeline",void 0),g(this,"time",void 0),g(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const dv=()=>{},Ad={BREAK:1,SNAP_TO_END:2,IGNORE:3},oN=t=>t,aN=Ad.BREAK;class lN{constructor(e){g(this,"getControllerState",void 0),g(this,"props",void 0),g(this,"propsInTransition",void 0),g(this,"transition",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ma(e.timeline),this.onViewStateChange=e.onViewStateChange||dv,this.onStateChange=e.onStateChange||dv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===Ad.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Ad.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||oN,interpolator:s,interruption:n.transitionInterruption||aN,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class cN{constructor(e){g(this,"_propsToCompare",void 0),g(this,"_propsToExtract",void 0),g(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Ln(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Me(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const uN=["longitude","latitude","zoom","bearing","pitch"],fN=["longitude","latitude","zoom"];class XE extends cN{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:uN,required:fN},super(i.transitionProps),g(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=ls(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,ls(e.around,n.around,i)))}return r}}const Yn={transitionDuration:0},hN=300,ll=t=>1-(1-t)*(1-t),vr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Pi={};class dN{constructor(e){g(this,"props",void 0),g(this,"state",{}),g(this,"transitionManager",void 0),g(this,"eventManager",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"makeViewport",void 0),g(this,"_controllerState",void 0),g(this,"_events",{}),g(this,"_interactionState",{isDragging:!1}),g(this,"_customEvents",[]),g(this,"_eventStartBlocked",null),g(this,"_panMove",!1),g(this,"invertPan",!1),g(this,"dragMode","rotate"),g(this,"inertia",0),g(this,"scrollZoom",!0),g(this,"dragPan",!0),g(this,"dragRotate",!0),g(this,"doubleClickZoom",!0),g(this,"touchZoom",!0),g(this,"touchRotate",!1),g(this,"keyboard",!0),this.transitionManager=new lN({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?hN:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(vr.WHEEL,u&&i),this.toggleEvents(vr.PAN,u),this.toggleEvents(vr.PINCH,u&&(a||l)),this.toggleEvents(vr.TRIPLE_PAN,u&&l),this.toggleEvents(vr.DOUBLE_TAP,u&&o),this.toggleEvents(vr.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Yn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Yn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ll},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Yn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ll},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Yn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Yn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ll},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Pi._startPinchRotation=e.rotation,Pi._lastPinchEvent=e,this.updateViewport(i,Yn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Pi._startPinchRotation-i})}return this.updateViewport(n,Yn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pi._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Pi;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:ll},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pi._startPinchRotation=null,Pi._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Yn:e?{...n,transitionInterpolator:new XE({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class gN{constructor(e,n){g(this,"_viewportProps",void 0),g(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const gv=5,pN=1.2;class mN extends gN{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:_,startZoomLngLat:T,startRotatePos:y,startBearing:m,startPitch:v,startZoom:E,normalize:S=!0}=e;Me(Number.isFinite(s)),Me(Number.isFinite(r)),Me(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:S,position:u},{startPanLngLat:_,startZoomLngLat:T,startRotatePos:y,startBearing:m,startPitch:v,startZoom:E}),g(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=ti(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=ti(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=ti(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,Ek(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>gv&&(h=o/(l-u)*pN):o<0&&l>gv&&(h=1-a/l),h=ti(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),_=r+180*f;let T=i;return h>0?T=i+h*(p-i):h<0&&(T=i-h*(d-i)),{pitch:T,bearing:_}}}class yN extends dN{constructor(...e){super(...e),g(this,"ControllerState",mN),g(this,"transition",{transitionDuration:300,transitionInterpolator:new XE({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),g(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class ZE extends ds{get ViewportType(){return yi}get ControllerType(){return yN}}g(ZE,"displayName","MapView");const vN=new WE;function _N(t,e){var n,i;const r=(n=t.order)!==null&&n!==void 0?n:1/0,s=(i=e.order)!==null&&i!==void 0?i:1/0;return r-s}class xN{constructor(){g(this,"effects",void 0),g(this,"_resolvedEffects",[]),g(this,"_defaultEffects",[]),g(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>_N(r,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Wt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const s=n[r.id];s&&s!==r?s.setProps?(s.setProps(r.props),i.push(s)):(s.cleanup(),i.push(r)):i.push(r),delete n[r.id]}for(const r in n)n[r].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof WE)||this._resolvedEffects.push(vN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class wN extends Pp{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const EN="deckRenderer.renderLayers";class TN{constructor(e){g(this,"gl",void 0),g(this,"layerFilter",void 0),g(this,"drawPickingColors",void 0),g(this,"drawLayersPass",void 0),g(this,"pickLayersPass",void 0),g(this,"renderCount",void 0),g(this,"_needsRedraw",void 0),g(this,"renderBuffers",void 0),g(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new wN(e),this.pickLayersPass=new $E(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Ae.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,s=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ve(EN,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Ae(this.gl),new Ae(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s.id===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const bN={pickedColor:null,pickedObjectIndex:-1};function SN({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,f=-1,h=0;for(let d=0;d<c;d++){const p=d+a-i,_=p*p;if(_>u)h+=4*l;else for(let T=0;T<l;T++){if(t[h+3]-1>=0){const m=T+o-n,v=m*m+_;v<=u&&(u=v,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),p=e(d);if(p){const _=Math.floor(f/4/l),T=f/4-_*l;return{...p,pickedColor:d,pickedX:o+T,pickedY:a+_}}Y.error("Picked non-existent layer. Is picking buffer corrupt?")()}return bN}function PN({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):Y.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function qE({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=LN((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function AN(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const p=r.find(_=>_.props.id===h);p&&l.unshift(p)}n.layerId=d,n.index=a,n.info=null}}const c=qE(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=KE({layer:f,info:h,mode:i});const d=h.layer;f===o&&i==="hover"&&(n.info=h),u.set(d.id,h),i==="hover"&&d.updateAutoHighlight(h)}),u}function KE({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function LN(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class CN{constructor(e){g(this,"gl",void 0),g(this,"pickingFBO",void 0),g(this,"depthFBO",void 0),g(this,"pickLayersPass",void 0),g(this,"layerFilter",void 0),g(this,"lastPickedInfo",void 0),g(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new $E(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(h=>h.id===o):null,c=a&&r.find(h=>h.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ae(i),Ae.isSupported(i,{colorBufferFloat:!0}))){const r=new Ae(i);r.attach({36064:new yt(i,{format:Z(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this._getPickable(e),d=ss(this.gl);if(!h)return{result:[],emptyInfo:qE({viewports:i,x:r,y:s,pixelRatio:d})};this._resizeBuffer();const p=Af(this.gl,[r,s],!0),_=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],T=Math.round(o*d),{width:y,height:m}=this.pickingFBO,v=this._getPickingRect({deviceX:_[0],deviceY:_[1],deviceRadius:T,deviceWidth:y,deviceHeight:m}),E={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let S;const P=[],L=new Set;for(let C=0;C<a;C++){let M;if(v){const k=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:v,cullRect:E,effects:f,pass:"picking:".concat(l)});M=SN({...k,deviceX:_[0],deviceY:_[1],deviceRadius:T,deviceRect:v})}else M={pickedColor:null,pickedObjectIndex:-1};let I;if(M.pickedLayer&&c&&this.depthFBO){const{pickedColors:k}=this._drawAndSample({layers:[M.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:M.pickedX,y:M.pickedY,width:1,height:1},cullRect:E,effects:f,pass:"picking:".concat(l,":z")},!0);k[3]&&(I=k[0])}M.pickedLayer&&C+1<a&&(L.add(M.pickedLayer),M.pickedLayer.disablePickingIndex(M.pickedObjectIndex)),S=AN({pickInfo:M,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:i,x:r,y:s,z:I,pixelRatio:d});for(const k of S.values())k.layer&&P.push(k);if(!M.pickedColor)break}for(const C of L)C.restorePickingColors();return{result:P,emptyInfo:S.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const d=ss(this.gl),p=Af(this.gl,[r,s],!0),_=p.x,T=p.y+p.height,y=Af(this.gl,[r+o,s+a],!0),m=y.x+y.width,v=y.y,E={x:_,y:v,width:m-_,height:T-v},S=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:E,cullRect:{x:r,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),P=PN(S),L=new Map,C=Number.isFinite(c);for(let M=0;M<P.length&&!(C&&c&&L.size>=c);M++){const I=P[M];let k={color:I.pickedColor,layer:null,index:I.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};k=KE({layer:I.pickedLayer,info:k,mode:l}),L.has(k.object)||L.set(k.object,k)}return Array.from(L.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const m of a)m.useInPicking&&(f.preRenderStats[m.id]=m.preRender(this.gl,f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:_,height:T}=s,y=new(c?Float32Array:Uint8Array)(_*T*4);return _u(u,{sourceX:d,sourceY:p,sourceWidth:_,sourceHeight:T,target:y}),{pickedColors:y,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const MN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class IN{constructor(e){g(this,"el",null),g(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,MN),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var QE={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(x,w,b){return setTimeout(v(x,b),w)}function h(x,w,b){return Array.isArray(x)?(d(x,b[w],b),!0):!1}function d(x,w,b){var A;if(x)if(x.forEach)x.forEach(w,b);else if(x.length!==r)for(A=0;A<x.length;)w.call(b,x[A],A,x),A++;else for(A in x)x.hasOwnProperty(A)&&w.call(b,x[A],A,x)}function p(x,w,b){var A="DEPRECATED METHOD: "+w+`
`+b+` AT 
`;return function(){var R=new Error("get-stack-trace"),z=R&&R.stack?R.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",X=e.console&&(e.console.warn||e.console.log);return X&&X.call(e.console,A,z),x.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(w){if(w===r||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(w),A=1;A<arguments.length;A++){var R=arguments[A];if(R!==r&&R!==null)for(var z in R)R.hasOwnProperty(z)&&(b[z]=R[z])}return b}:_=Object.assign;var T=p(function(w,b,A){for(var R=Object.keys(b),z=0;z<R.length;)(!A||A&&w[R[z]]===r)&&(w[R[z]]=b[R[z]]),z++;return w},"extend","Use `assign`."),y=p(function(w,b){return T(w,b,!0)},"merge","Use `assign`.");function m(x,w,b){var A=w.prototype,R;R=x.prototype=Object.create(A),R.constructor=x,R._super=A,b&&_(R,b)}function v(x,w){return function(){return x.apply(w,arguments)}}function E(x,w){return typeof x==a?x.apply(w&&w[0]||r,w):x}function S(x,w){return x===r?w:x}function P(x,w,b){d(I(w),function(A){x.addEventListener(A,b,!1)})}function L(x,w,b){d(I(w),function(A){x.removeEventListener(A,b,!1)})}function C(x,w){for(;x;){if(x==w)return!0;x=x.parentNode}return!1}function M(x,w){return x.indexOf(w)>-1}function I(x){return x.trim().split(/\s+/g)}function k(x,w,b){if(x.indexOf&&!b)return x.indexOf(w);for(var A=0;A<x.length;){if(b&&x[A][b]==w||!b&&x[A]===w)return A;A++}return-1}function W(x){return Array.prototype.slice.call(x,0)}function j(x,w,b){for(var A=[],R=[],z=0;z<x.length;){var X=w?x[z][w]:x[z];k(R,X)<0&&A.push(x[z]),R[z]=X,z++}return b&&(w?A=A.sort(function(Re,$e){return Re[w]>$e[w]}):A=A.sort()),A}function H(x,w){for(var b,A,R=w[0].toUpperCase()+w.slice(1),z=0;z<s.length;){if(b=s[z],A=b?b+R:w,A in x)return A;z++}return r}var et=1;function Kt(){return et++}function Ot(x){var w=x.ownerDocument||x;return w.defaultView||w.parentWindow||e}var D=/mobile|tablet|ip(ad|hone|od)|android/i,G="ontouchstart"in e,$=H(e,"PointerEvent")!==r,he=G&&D.test(navigator.userAgent),ue="touch",lr="pen",kt="mouse",Ts="kinect",dn=25,we=1,Ei=2,Ee=4,tt=8,wa=1,bs=2,Ss=4,Ps=8,As=16,Qt=bs|Ss,Ti=Ps|As,om=Qt|Ti,am=["x","y"],Ea=["clientX","clientY"];function Et(x,w){var b=this;this.manager=x,this.callback=w,this.element=x.element,this.target=x.options.inputTarget,this.domHandler=function(A){E(x.options.enable,[x])&&b.handler(A)},this.init()}Et.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(Ot(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&L(this.element,this.evEl,this.domHandler),this.evTarget&&L(this.target,this.evTarget,this.domHandler),this.evWin&&L(Ot(this.element),this.evWin,this.domHandler)}};function db(x){var w,b=x.options.inputClass;return b?w=b:$?w=Du:he?w=Sa:G?w=zu:w=ba,new w(x,gb)}function gb(x,w,b){var A=b.pointers.length,R=b.changedPointers.length,z=w&we&&A-R===0,X=w&(Ee|tt)&&A-R===0;b.isFirst=!!z,b.isFinal=!!X,z&&(x.session={}),b.eventType=w,pb(x,b),x.emit("hammer.input",b),x.recognize(b),x.session.prevInput=b}function pb(x,w){var b=x.session,A=w.pointers,R=A.length;b.firstInput||(b.firstInput=lm(w)),R>1&&!b.firstMultiple?b.firstMultiple=lm(w):R===1&&(b.firstMultiple=!1);var z=b.firstInput,X=b.firstMultiple,Le=X?X.center:z.center,Re=w.center=cm(A);w.timeStamp=u(),w.deltaTime=w.timeStamp-z.timeStamp,w.angle=Fu(Le,Re),w.distance=Ta(Le,Re),mb(b,w),w.offsetDirection=fm(w.deltaX,w.deltaY);var $e=um(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=$e.x,w.overallVelocityY=$e.y,w.overallVelocity=c($e.x)>c($e.y)?$e.x:$e.y,w.scale=X?_b(X.pointers,A):1,w.rotation=X?vb(X.pointers,A):0,w.maxPointers=b.prevInput?w.pointers.length>b.prevInput.maxPointers?w.pointers.length:b.prevInput.maxPointers:w.pointers.length,yb(b,w);var en=x.element;C(w.srcEvent.target,en)&&(en=w.srcEvent.target),w.target=en}function mb(x,w){var b=w.center,A=x.offsetDelta||{},R=x.prevDelta||{},z=x.prevInput||{};(w.eventType===we||z.eventType===Ee)&&(R=x.prevDelta={x:z.deltaX||0,y:z.deltaY||0},A=x.offsetDelta={x:b.x,y:b.y}),w.deltaX=R.x+(b.x-A.x),w.deltaY=R.y+(b.y-A.y)}function yb(x,w){var b=x.lastInterval||w,A=w.timeStamp-b.timeStamp,R,z,X,Le;if(w.eventType!=tt&&(A>dn||b.velocity===r)){var Re=w.deltaX-b.deltaX,$e=w.deltaY-b.deltaY,en=um(A,Re,$e);z=en.x,X=en.y,R=c(en.x)>c(en.y)?en.x:en.y,Le=fm(Re,$e),x.lastInterval=w}else R=b.velocity,z=b.velocityX,X=b.velocityY,Le=b.direction;w.velocity=R,w.velocityX=z,w.velocityY=X,w.direction=Le}function lm(x){for(var w=[],b=0;b<x.pointers.length;)w[b]={clientX:l(x.pointers[b].clientX),clientY:l(x.pointers[b].clientY)},b++;return{timeStamp:u(),pointers:w,center:cm(w),deltaX:x.deltaX,deltaY:x.deltaY}}function cm(x){var w=x.length;if(w===1)return{x:l(x[0].clientX),y:l(x[0].clientY)};for(var b=0,A=0,R=0;R<w;)b+=x[R].clientX,A+=x[R].clientY,R++;return{x:l(b/w),y:l(A/w)}}function um(x,w,b){return{x:w/x||0,y:b/x||0}}function fm(x,w){return x===w?wa:c(x)>=c(w)?x<0?bs:Ss:w<0?Ps:As}function Ta(x,w,b){b||(b=am);var A=w[b[0]]-x[b[0]],R=w[b[1]]-x[b[1]];return Math.sqrt(A*A+R*R)}function Fu(x,w,b){b||(b=am);var A=w[b[0]]-x[b[0]],R=w[b[1]]-x[b[1]];return Math.atan2(R,A)*180/Math.PI}function vb(x,w){return Fu(w[1],w[0],Ea)+Fu(x[1],x[0],Ea)}function _b(x,w){return Ta(w[0],w[1],Ea)/Ta(x[0],x[1],Ea)}var xb={mousedown:we,mousemove:Ei,mouseup:Ee},wb="mousedown",Eb="mousemove mouseup";function ba(){this.evEl=wb,this.evWin=Eb,this.pressed=!1,Et.apply(this,arguments)}m(ba,Et,{handler:function(w){var b=xb[w.type];b&we&&w.button===0&&(this.pressed=!0),b&Ei&&w.which!==1&&(b=Ee),this.pressed&&(b&Ee&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[w],changedPointers:[w],pointerType:kt,srcEvent:w}))}});var Tb={pointerdown:we,pointermove:Ei,pointerup:Ee,pointercancel:tt,pointerout:tt},bb={2:ue,3:lr,4:kt,5:Ts},hm="pointerdown",dm="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(hm="MSPointerDown",dm="MSPointerMove MSPointerUp MSPointerCancel");function Du(){this.evEl=hm,this.evWin=dm,Et.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(Du,Et,{handler:function(w){var b=this.store,A=!1,R=w.type.toLowerCase().replace("ms",""),z=Tb[R],X=bb[w.pointerType]||w.pointerType,Le=X==ue,Re=k(b,w.pointerId,"pointerId");z&we&&(w.button===0||Le)?Re<0&&(b.push(w),Re=b.length-1):z&(Ee|tt)&&(A=!0),!(Re<0)&&(b[Re]=w,this.callback(this.manager,z,{pointers:b,changedPointers:[w],pointerType:X,srcEvent:w}),A&&b.splice(Re,1))}});var Sb={touchstart:we,touchmove:Ei,touchend:Ee,touchcancel:tt},Pb="touchstart",Ab="touchstart touchmove touchend touchcancel";function gm(){this.evTarget=Pb,this.evWin=Ab,this.started=!1,Et.apply(this,arguments)}m(gm,Et,{handler:function(w){var b=Sb[w.type];if(b===we&&(this.started=!0),!!this.started){var A=Lb.call(this,w,b);b&(Ee|tt)&&A[0].length-A[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:A[0],changedPointers:A[1],pointerType:ue,srcEvent:w})}}});function Lb(x,w){var b=W(x.touches),A=W(x.changedTouches);return w&(Ee|tt)&&(b=j(b.concat(A),"identifier",!0)),[b,A]}var Cb={touchstart:we,touchmove:Ei,touchend:Ee,touchcancel:tt},Mb="touchstart touchmove touchend touchcancel";function Sa(){this.evTarget=Mb,this.targetIds={},Et.apply(this,arguments)}m(Sa,Et,{handler:function(w){var b=Cb[w.type],A=Ib.call(this,w,b);A&&this.callback(this.manager,b,{pointers:A[0],changedPointers:A[1],pointerType:ue,srcEvent:w})}});function Ib(x,w){var b=W(x.touches),A=this.targetIds;if(w&(we|Ei)&&b.length===1)return A[b[0].identifier]=!0,[b,b];var R,z,X=W(x.changedTouches),Le=[],Re=this.target;if(z=b.filter(function($e){return C($e.target,Re)}),w===we)for(R=0;R<z.length;)A[z[R].identifier]=!0,R++;for(R=0;R<X.length;)A[X[R].identifier]&&Le.push(X[R]),w&(Ee|tt)&&delete A[X[R].identifier],R++;if(Le.length)return[j(z.concat(Le),"identifier",!0),Le]}var Rb=2500,pm=25;function zu(){Et.apply(this,arguments);var x=v(this.handler,this);this.touch=new Sa(this.manager,x),this.mouse=new ba(this.manager,x),this.primaryTouch=null,this.lastTouches=[]}m(zu,Et,{handler:function(w,b,A){var R=A.pointerType==ue,z=A.pointerType==kt;if(!(z&&A.sourceCapabilities&&A.sourceCapabilities.firesTouchEvents)){if(R)Ob.call(this,b,A);else if(z&&kb.call(this,A))return;this.callback(w,b,A)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ob(x,w){x&we?(this.primaryTouch=w.changedPointers[0].identifier,mm.call(this,w)):x&(Ee|tt)&&mm.call(this,w)}function mm(x){var w=x.changedPointers[0];if(w.identifier===this.primaryTouch){var b={x:w.clientX,y:w.clientY};this.lastTouches.push(b);var A=this.lastTouches,R=function(){var z=A.indexOf(b);z>-1&&A.splice(z,1)};setTimeout(R,Rb)}}function kb(x){for(var w=x.srcEvent.clientX,b=x.srcEvent.clientY,A=0;A<this.lastTouches.length;A++){var R=this.lastTouches[A],z=Math.abs(w-R.x),X=Math.abs(b-R.y);if(z<=pm&&X<=pm)return!0}return!1}var ym=H(o.style,"touchAction"),vm=ym!==r,_m="compute",xm="auto",Bu="manipulation",bi="none",Ls="pan-x",Cs="pan-y",Pa=Fb();function Uu(x,w){this.manager=x,this.set(w)}Uu.prototype={set:function(x){x==_m&&(x=this.compute()),vm&&this.manager.element.style&&Pa[x]&&(this.manager.element.style[ym]=x),this.actions=x.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var x=[];return d(this.manager.recognizers,function(w){E(w.options.enable,[w])&&(x=x.concat(w.getTouchAction()))}),Nb(x.join(" "))},preventDefaults:function(x){var w=x.srcEvent,b=x.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var A=this.actions,R=M(A,bi)&&!Pa[bi],z=M(A,Cs)&&!Pa[Cs],X=M(A,Ls)&&!Pa[Ls];if(R){var Le=x.pointers.length===1,Re=x.distance<2,$e=x.deltaTime<250;if(Le&&Re&&$e)return}if(!(X&&z)&&(R||z&&b&Qt||X&&b&Ti))return this.preventSrc(w)},preventSrc:function(x){this.manager.session.prevented=!0,x.preventDefault()}};function Nb(x){if(M(x,bi))return bi;var w=M(x,Ls),b=M(x,Cs);return w&&b?bi:w||b?w?Ls:Cs:M(x,Bu)?Bu:xm}function Fb(){if(!vm)return!1;var x={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(b){x[b]=w?e.CSS.supports("touch-action",b):!0}),x}var Aa=1,Tt=2,cr=4,Vn=8,gn=Vn,Ms=16,Jt=32;function pn(x){this.options=_({},this.defaults,x||{}),this.id=Kt(),this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Aa,this.simultaneous={},this.requireFail=[]}pn.prototype={defaults:{},set:function(x){return _(this.options,x),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(x){if(h(x,"recognizeWith",this))return this;var w=this.simultaneous;return x=La(x,this),w[x.id]||(w[x.id]=x,x.recognizeWith(this)),this},dropRecognizeWith:function(x){return h(x,"dropRecognizeWith",this)?this:(x=La(x,this),delete this.simultaneous[x.id],this)},requireFailure:function(x){if(h(x,"requireFailure",this))return this;var w=this.requireFail;return x=La(x,this),k(w,x)===-1&&(w.push(x),x.requireFailure(this)),this},dropRequireFailure:function(x){if(h(x,"dropRequireFailure",this))return this;x=La(x,this);var w=k(this.requireFail,x);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(x){return!!this.simultaneous[x.id]},emit:function(x){var w=this,b=this.state;function A(R){w.manager.emit(R,x)}b<Vn&&A(w.options.event+wm(b)),A(w.options.event),x.additionalEvent&&A(x.additionalEvent),b>=Vn&&A(w.options.event+wm(b))},tryEmit:function(x){if(this.canEmit())return this.emit(x);this.state=Jt},canEmit:function(){for(var x=0;x<this.requireFail.length;){if(!(this.requireFail[x].state&(Jt|Aa)))return!1;x++}return!0},recognize:function(x){var w=_({},x);if(!E(this.options.enable,[this,w])){this.reset(),this.state=Jt;return}this.state&(gn|Ms|Jt)&&(this.state=Aa),this.state=this.process(w),this.state&(Tt|cr|Vn|Ms)&&this.tryEmit(w)},process:function(x){},getTouchAction:function(){},reset:function(){}};function wm(x){return x&Ms?"cancel":x&Vn?"end":x&cr?"move":x&Tt?"start":""}function Em(x){return x==As?"down":x==Ps?"up":x==bs?"left":x==Ss?"right":""}function La(x,w){var b=w.manager;return b?b.get(x):x}function Nt(){pn.apply(this,arguments)}m(Nt,pn,{defaults:{pointers:1},attrTest:function(x){var w=this.options.pointers;return w===0||x.pointers.length===w},process:function(x){var w=this.state,b=x.eventType,A=w&(Tt|cr),R=this.attrTest(x);return A&&(b&tt||!R)?w|Ms:A||R?b&Ee?w|Vn:w&Tt?w|cr:Tt:Jt}});function Ca(){Nt.apply(this,arguments),this.pX=null,this.pY=null}m(Ca,Nt,{defaults:{event:"pan",threshold:10,pointers:1,direction:om},getTouchAction:function(){var x=this.options.direction,w=[];return x&Qt&&w.push(Cs),x&Ti&&w.push(Ls),w},directionTest:function(x){var w=this.options,b=!0,A=x.distance,R=x.direction,z=x.deltaX,X=x.deltaY;return R&w.direction||(w.direction&Qt?(R=z===0?wa:z<0?bs:Ss,b=z!=this.pX,A=Math.abs(x.deltaX)):(R=X===0?wa:X<0?Ps:As,b=X!=this.pY,A=Math.abs(x.deltaY))),x.direction=R,b&&A>w.threshold&&R&w.direction},attrTest:function(x){return Nt.prototype.attrTest.call(this,x)&&(this.state&Tt||!(this.state&Tt)&&this.directionTest(x))},emit:function(x){this.pX=x.deltaX,this.pY=x.deltaY;var w=Em(x.direction);w&&(x.additionalEvent=this.options.event+w),this._super.emit.call(this,x)}});function Vu(){Nt.apply(this,arguments)}m(Vu,Nt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bi]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.scale-1)>this.options.threshold||this.state&Tt)},emit:function(x){if(x.scale!==1){var w=x.scale<1?"in":"out";x.additionalEvent=this.options.event+w}this._super.emit.call(this,x)}});function ju(){pn.apply(this,arguments),this._timer=null,this._input=null}m(ju,pn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[xm]},process:function(x){var w=this.options,b=x.pointers.length===w.pointers,A=x.distance<w.threshold,R=x.deltaTime>w.time;if(this._input=x,!A||!b||x.eventType&(Ee|tt)&&!R)this.reset();else if(x.eventType&we)this.reset(),this._timer=f(function(){this.state=gn,this.tryEmit()},w.time,this);else if(x.eventType&Ee)return gn;return Jt},reset:function(){clearTimeout(this._timer)},emit:function(x){this.state===gn&&(x&&x.eventType&Ee?this.manager.emit(this.options.event+"up",x):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function Gu(){Nt.apply(this,arguments)}m(Gu,Nt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bi]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.rotation)>this.options.threshold||this.state&Tt)}});function Wu(){Nt.apply(this,arguments)}m(Wu,Nt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Qt|Ti,pointers:1},getTouchAction:function(){return Ca.prototype.getTouchAction.call(this)},attrTest:function(x){var w=this.options.direction,b;return w&(Qt|Ti)?b=x.overallVelocity:w&Qt?b=x.overallVelocityX:w&Ti&&(b=x.overallVelocityY),this._super.attrTest.call(this,x)&&w&x.offsetDirection&&x.distance>this.options.threshold&&x.maxPointers==this.options.pointers&&c(b)>this.options.velocity&&x.eventType&Ee},emit:function(x){var w=Em(x.offsetDirection);w&&this.manager.emit(this.options.event+w,x),this.manager.emit(this.options.event,x)}});function Ma(){pn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Ma,pn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Bu]},process:function(x){var w=this.options,b=x.pointers.length===w.pointers,A=x.distance<w.threshold,R=x.deltaTime<w.time;if(this.reset(),x.eventType&we&&this.count===0)return this.failTimeout();if(A&&R&&b){if(x.eventType!=Ee)return this.failTimeout();var z=this.pTime?x.timeStamp-this.pTime<w.interval:!0,X=!this.pCenter||Ta(this.pCenter,x.center)<w.posThreshold;this.pTime=x.timeStamp,this.pCenter=x.center,!X||!z?this.count=1:this.count+=1,this._input=x;var Le=this.count%w.taps;if(Le===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=gn,this.tryEmit()},w.interval,this),Tt):gn}return Jt},failTimeout:function(){return this._timer=f(function(){this.state=Jt},this.options.interval,this),Jt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function mn(x,w){return w=w||{},w.recognizers=S(w.recognizers,mn.defaults.preset),new Hu(x,w)}mn.VERSION="2.0.7",mn.defaults={domEvents:!1,touchAction:_m,enable:!0,inputTarget:null,inputClass:null,preset:[[Gu,{enable:!1}],[Vu,{enable:!1},["rotate"]],[Wu,{direction:Qt}],[Ca,{direction:Qt},["swipe"]],[Ma],[Ma,{event:"doubletap",taps:2},["tap"]],[ju]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Db=1,Tm=2;function Hu(x,w){this.options=_({},mn.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||x,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=x,this.input=db(this),this.touchAction=new Uu(this,this.options.touchAction),bm(this,!0),d(this.options.recognizers,function(b){var A=this.add(new b[0](b[1]));b[2]&&A.recognizeWith(b[2]),b[3]&&A.requireFailure(b[3])},this)}Hu.prototype={set:function(x){return _(this.options,x),x.touchAction&&this.touchAction.update(),x.inputTarget&&(this.input.destroy(),this.input.target=x.inputTarget,this.input.init()),this},stop:function(x){this.session.stopped=x?Tm:Db},recognize:function(x){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(x);var b,A=this.recognizers,R=w.curRecognizer;(!R||R&&R.state&gn)&&(R=w.curRecognizer=null);for(var z=0;z<A.length;)b=A[z],w.stopped!==Tm&&(!R||b==R||b.canRecognizeWith(R))?b.recognize(x):b.reset(),!R&&b.state&(Tt|cr|Vn)&&(R=w.curRecognizer=b),z++}},get:function(x){if(x instanceof pn)return x;for(var w=this.recognizers,b=0;b<w.length;b++)if(w[b].options.event==x)return w[b];return null},add:function(x){if(h(x,"add",this))return this;var w=this.get(x.options.event);return w&&this.remove(w),this.recognizers.push(x),x.manager=this,this.touchAction.update(),x},remove:function(x){if(h(x,"remove",this))return this;if(x=this.get(x),x){var w=this.recognizers,b=k(w,x);b!==-1&&(w.splice(b,1),this.touchAction.update())}return this},on:function(x,w){if(x!==r&&w!==r){var b=this.handlers;return d(I(x),function(A){b[A]=b[A]||[],b[A].push(w)}),this}},off:function(x,w){if(x!==r){var b=this.handlers;return d(I(x),function(A){w?b[A]&&b[A].splice(k(b[A],w),1):delete b[A]}),this}},emit:function(x,w){this.options.domEvents&&zb(x,w);var b=this.handlers[x]&&this.handlers[x].slice();if(!(!b||!b.length)){w.type=x,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var A=0;A<b.length;)b[A](w),A++}},destroy:function(){this.element&&bm(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function bm(x,w){var b=x.element;if(b.style){var A;d(x.options.cssProps,function(R,z){A=H(b.style,z),w?(x.oldCssProps[A]=b.style[A],b.style[A]=R):b.style[A]=x.oldCssProps[A]||""}),w||(x.oldCssProps={})}}function zb(x,w){var b=n.createEvent("Event");b.initEvent(x,!0,!0),b.gesture=w,w.target.dispatchEvent(b)}_(mn,{INPUT_START:we,INPUT_MOVE:Ei,INPUT_END:Ee,INPUT_CANCEL:tt,STATE_POSSIBLE:Aa,STATE_BEGAN:Tt,STATE_CHANGED:cr,STATE_ENDED:Vn,STATE_RECOGNIZED:gn,STATE_CANCELLED:Ms,STATE_FAILED:Jt,DIRECTION_NONE:wa,DIRECTION_LEFT:bs,DIRECTION_RIGHT:Ss,DIRECTION_UP:Ps,DIRECTION_DOWN:As,DIRECTION_HORIZONTAL:Qt,DIRECTION_VERTICAL:Ti,DIRECTION_ALL:om,Manager:Hu,Input:Et,TouchAction:Uu,TouchInput:Sa,MouseInput:ba,PointerEventInput:Du,TouchMouseInput:zu,SingleTouchInput:gm,Recognizer:pn,AttrRecognizer:Nt,Tap:Ma,Pan:Ca,Swipe:Wu,Pinch:Vu,Rotate:Gu,Press:ju,on:P,off:L,each:d,merge:y,extend:T,assign:_,inherit:m,bindFn:v,prefixed:H});var Bb=typeof e<"u"?e:typeof self<"u"?self:{};Bb.Hammer=mn,typeof r=="function"&&r.amd?r(function(){return mn}):t.exports?t.exports=mn:e[i]=mn})(window,document,"Hammer")})(QE);var ya=QE.exports;const RN=Jc(ya),rn=Ub({__proto__:null,default:RN},[ya]),JE=1,eT=2,Ld=4,ON={mousedown:JE,mousemove:eT,mouseup:Ld};function kN(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function NN(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(kN(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function FN(t){t.prototype.handler=function(n){let i=ON[n.type];i&JE&&n.button>=0&&(this.pressed=!0),i&eT&&n.which===0&&(i=Ld),this.pressed&&(i&Ld&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}NN(ya.PointerEventInput);FN(ya.MouseInput);const DN=ya.Manager;class wu{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const zN=rn?[[rn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[rn.Rotate,{enable:!1}],[rn.Pinch,{enable:!1}],[rn.Swipe,{enable:!1}],[rn.Pan,{threshold:0,enable:!1}],[rn.Press,{enable:!1}],[rn.Tap,{event:"doubletap",taps:2,enable:!1}],[rn.Tap,{event:"anytap",enable:!1}],[rn.Tap,{enable:!1}]]:null,pv={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},BN={doubletap:["tap"]},UN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Mp={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},VN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},mv={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},jN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Nr=typeof window<"u"?window:global;let Cd=!1;try{const t={get passive(){return Cd=!0,!0}};Nr.addEventListener("test",null,t),Nr.removeEventListener("test",null)}catch{Cd=!1}const GN=jN.indexOf("firefox")!==-1,{WHEEL_EVENTS:WN}=Mp,yv="wheel",vv=4.000244140625,HN=40,$N=.25;class YN extends wu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;Nr.WheelEvent&&(GN&&r.deltaMode===Nr.WheelEvent.DOM_DELTA_PIXEL&&(s/=Nr.devicePixelRatio),r.deltaMode===Nr.WheelEvent.DOM_DELTA_LINE&&(s*=HN)),s!==0&&s%vv===0&&(s=Math.floor(s/vv)),r.shiftKey&&s&&(s=s*$N),this.callback({type:yv,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(WN),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Cd?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===yv&&(this.options.enable=n)}}const{MOUSE_EVENTS:XN}=Mp,_v="pointermove",xv="pointerover",wv="pointerout",Ev="pointerenter",Tv="pointerleave";class ZN extends wu{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(XN),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===_v&&(this.enableMoveEvent=n),e===xv&&(this.enableOverEvent=n),e===wv&&(this.enableOutEvent=n),e===Ev&&(this.enableEnterEvent=n),e===Tv&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(xv,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(wv,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Ev,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Tv,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(_v,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:qN}=Mp,bv="keydown",Sv="keyup";class KN extends wu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:bv,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:Sv,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(qN),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===bv&&(this.enableDownEvent=n),e===Sv&&(this.enableUpEvent=n)}}const Pv="contextmenu";class QN extends wu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:Pv,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Pv&&(this.options.enable=n)}}const Md=1,Dc=2,Id=4,JN={pointerdown:Md,pointermove:Dc,pointerup:Id,mousedown:Md,mousemove:Dc,mouseup:Id},eF=1,tF=2,nF=3,iF=0,rF=1,sF=2,oF=1,aF=2,lF=4;function cF(t){const e=JN[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===Id||e===Dc&&!Number.isFinite(n)?(s=r===eF,o=r===tF,a=r===nF):e===Dc?(s=!!(n&oF),o=!!(n&lF),a=!!(n&aF)):e===Md&&(s=i===iF,o=i===rF,a=i===sF),{leftButton:s,middleButton:o,rightButton:a}}function uF(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const $f={srcElement:"root",priority:0};class fF{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=$f;typeof i=="string"||i&&i.addEventListener?l={...$f,srcElement:i}:i&&(l={...$f,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:f}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...cF(e),...uF(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const hF={events:null,recognizers:null,recognizerOptions:{},Manager:DN,touchAction:"none",tabIndex:0};class dF{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=UN[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...hF,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||zN}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(pv).forEach(r=>{const s=this.manager.get(r);s&&pv[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new YN(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ZN(e,this._onOtherEvent,{enable:!1}),this.keyInput=new KN(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new QN(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=BN[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=mv[e]||e;let c=a.get(l);c||(c=new fF(this),a.set(l,c),c.recognizerName=VN[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=mv[e]||e,s=i.get(r);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Ai(){}const gF=({isDragging:t})=>t?"grabbing":"grab",tT={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ai,onResize:Ai,onViewStateChange:Ai,onInteractionStateChange:Ai,onBeforeRender:Ai,onAfterRender:Ai,onLoad:Ai,onError:t=>Y.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:gF,getTooltip:null,debug:!1,drawPickingColors:!1};class Eu{constructor(e){g(this,"props",void 0),g(this,"width",0),g(this,"height",0),g(this,"userData",{}),g(this,"canvas",null),g(this,"viewManager",null),g(this,"layerManager",null),g(this,"effectManager",null),g(this,"deckRenderer",null),g(this,"deckPicker",null),g(this,"eventManager",null),g(this,"tooltip",null),g(this,"metrics",void 0),g(this,"animationLoop",void 0),g(this,"stats",void 0),g(this,"viewState",void 0),g(this,"cursorState",void 0),g(this,"_needsRedraw",void 0),g(this,"_pickRequest",void 0),g(this,"_lastPointerDownInfo",null),g(this,"_metricsCounter",void 0),g(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),g(this,"_onEvent",n=>{const i=ry[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),c=this.props[i.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),g(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...tT,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Y.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Uw()==="IE"&&Y.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new dp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&hs.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a,l;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var c;(c=this.canvas.parentElement)===null||c===void 0||c.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Y.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Y.removed("onLayerClick","onClick")(),e.initialViewState&&!Wt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Me(this.viewManager),this.viewManager.views}getViewports(e){return Me(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Me(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Me(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const r=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,s=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(r!==this.width||s!==this.height){var o,a;this.width=r,this.height=s,(o=this.viewManager)===null||o===void 0||o.setProps({width:r,height:s}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:s})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new VM({width:n,height:i,useDevicePixels:u,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,gl:r,onCreateContext:f=>Yw({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new ZE({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,hp(e,{enable:!0,copyState:!0})),this.tooltip=new IN(this.canvas),kn(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new kE;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new dF(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in ry)this.eventManager.on(r,this._onEvent);this.viewManager=new rN({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new iN(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new xN,this.deckRenderer=new TN(e),this.deckPicker=new CN(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;kn(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Y.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Fi.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}g(Eu,"defaultProps",tT);g(Eu,"VERSION",$L);class Yf{constructor(e,n){g(this,"opts",void 0),g(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function pF(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function $l(t){return t.stride||t.size*t.bytesPerElement}function nT(t,e){e.offset&&Y.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=$l(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function mF(t,e){const n=nT(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class yF{constructor(e,n,i){g(this,"gl",void 0),g(this,"id",void 0),g(this,"size",void 0),g(this,"settings",void 0),g(this,"value",void 0),g(this,"doublePrecision",void 0),g(this,"_buffer",void 0),g(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&y3(e,le.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=pF(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new ne(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*$l(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hs.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=mF(this.getAccessor(),n||{});return i[e]=new Yf(this,s.high),i["".concat(e,"64Low")]=r?new Yf(this,s.low):new Float32Array(this.size),i}if(n){const i=nT(this.getAccessor(),n);return{[e]:new Yf(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ne?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=$l(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=$l(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=Gf(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Gf(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=hs.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?Gf(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Y.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let o=s;for(;--o>=0;)n[i+o]=r[o];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const Av=[],Lv=[];function Tu(t,e=0,n=1/0){let i=Av;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Lv.length=t.length,i=Lv):i=Av,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function iT(t){return t&&t[Symbol.asyncIterator]}function rT(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:d})=>{if(!s){const y=h*l+c;for(let m=0;m<n;m++)d[m]=t[y+m];return d}const p=s[h],_=s[h+1]||u;let T;if(o){T=new Array(_-p);for(let y=p;y<_;y++){const m=y*l+c;d=new Array(n);for(let v=0;v<n;v++)d[v]=t[m+v];T[y-p]=d}}else if(l===n)T=t.subarray(p*n+c,_*n+c);else{T=new t.constructor((_-p)*n);let y=0;for(let m=p;m<_;m++){const v=m*l+c;for(let E=0;E<n;E++)T[y++]=t[v+E]}}return T}}const vF=[],Yl=[[0,1/0]];function _F(t,e){if(t===Yl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function Xf(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<r;f++)n[i+c]=u[f]||0,c++}}function xF({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return Xf({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,f)=>i(u+a,f)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const f=r[u]*n,h=s[u]*n;Xf({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&Xf({source:[],target:e,start:a,size:n,getData:l}),e}const wF={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function sT(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...wF[n],...e,...t,type:n}}function oT(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function aT(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function lT(t){t.push(t.shift())}function Ip(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function cT({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,f=Ip(n,e),h=n.isConstant;if(!u&&i>=f)return;const d=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(m,v)=>n.normalizeConstant(y(m,v))}const p=h?(y,m)=>s(d,m):(y,m)=>s(d.subarray(y,y+a),m),_=t.getData({length:i}),T=new Float32Array(f);xF({source:_,target:T,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),t.byteLength<T.byteLength+l&&t.reallocate(T.byteLength+l),t.subData({data:T,offset:l})}class Rp extends yF{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Yl}),g(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return sT(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=_F(this.state.updateRanges,[i,r])}else this.state.updateRanges=Yl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=vF}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Yl),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Me(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=!!o.size&&o.size!==this.size;return i.binaryAccessor=rT(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:s[h]);Me(typeof p=="function",'accessor "'.concat(h,'" is not a function'));let _=e.getVertexOffset(i);const{iterable:T,objectInfo:y}=Tu(n,i,r);for(const m of T){y.index++;let v=p(m,y);if(d&&(v=d.call(this,v)),f){const E=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(v&&Array.isArray(v[0])){let S=_;for(const P of v)e._normalizeValue(P,c,S),S+=u}else v&&v.length>u?c.set(v,_):(e._normalizeValue(v,y.target,0),Xk({target:c,source:y.target,start:_,count:E}));_+=E*u}else e._normalizeValue(v,c,_),_+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class EF{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","interpolation"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.transition=new ma(i),this.attribute=n,this.attributeInTransition=new Rp(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=bF(e,n);const r={byteLength:0,usage:35050};this.buffers=[new ne(e,r),new ne(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;lT(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)cT({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=Ip(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:oT(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const TF=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function bF(t,e){const n=aT(e.size);return new Sp(t,{vs:TF,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class SF{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","spring"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"texture",void 0),g(this,"framebuffer",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new ma(i),this.attribute=n,this.attributeInTransition=new Rp(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=AF(e),this.framebuffer=LF(e,this.texture),this.transform=PF(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new ne(e,r),new ne(e,r),new ne(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)cT({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=Ip(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:oT(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),lT(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),_u(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function PF(t,e,n){const i=aT(e.size);return new Sp(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function AF(t){return new yt(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function LF(t,e){return new Ae(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const CF={interpolation:EF,spring:SF};class MF{constructor(e,{id:n,timeline:i}){g(this,"id",void 0),g(this,"isSupported",void 0),g(this,"gl",void 0),g(this,"timeline",void 0),g(this,"transitions",void 0),g(this,"needsRedraw",void 0),g(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Sp.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){Y.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=CF[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(Y.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Cv="attributeManager.invalidate",IF="attributeManager.updateStart",RF="attributeManager.updateEnd",OF="attribute.updateStart",kF="attribute.allocate",NF="attribute.updateEnd";class FF{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"attributes",void 0),g(this,"updateTriggers",void 0),g(this,"needsRedraw",void 0),g(this,"userData",void 0),g(this,"stats",void 0),g(this,"attributeTransitionManager",void 0),g(this,"mergeBoundsMemoized",da(Bk)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new MF(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ve(Cv,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ve(Cv,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;Ve(IF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&Y.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ve(RF,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])===null||r===void 0?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new Rp(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ve(OF,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ve(kF,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ve(NF,n,i))}}class DF extends ma{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=ls(n,i,o)}}const Mv=1e-5;function Iv(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function zF(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Iv(t[o],e[o],n[o],i,r);return s}return Iv(t,e,n,i,r)}function Rv(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class BF extends ma{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=zF(s,o,n,i,r);const l=Rv(a,n),c=Rv(a,o);l<Mv&&c<Mv&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const UF={interpolation:DF,spring:BF};class VF{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=sT(r),!r)return;const o=UF[r.type];if(!o){Y.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function jF(t){const e=t[di];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function GF(t,e){const n=uT({newProps:t,oldProps:e,propTypes:t[di],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=HF(t,e);let r=!1;return i||(r=$F(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:YF(t,e),transitionsChanged:WF(t,e)}}function WF(t,e){if(!t.transitions)return!1;const n={},i=t[di];let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Rd(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function uT({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=Rd(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=Rd(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function Rd(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function HF(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function $F(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Ov(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&Ov(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function YF(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function Ov(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},uT({oldProps:r,newProps:i,triggerName:n})}const XF="count(): argument not an object",ZF="count(): argument not a container";function qF(t){if(!QF(t))throw new Error(XF);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(KF(t))return Object.keys(t).length;throw new Error(ZF)}function KF(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function QF(t){return t!==null&&typeof t=="object"}function JF(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const eD={10241:9987,10240:9729,10242:33071,10243:33071},Od={};function tD(t,e,n,i){if(n instanceof yt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={10241:n.data.length>1?9985:9729});const s=new yt(e,{...n,parameters:{...eD,...r,...i}});return Od[s.id]=t,s}function nD(t,e){!e||!(e instanceof yt)||Od[e.id]===t&&(e.delete(),delete Od[e.id])}const iD={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||kd(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Wt(t,e,1)}},accessor:{validate(t,e){const n=zc(t);return n==="function"||n===zc(e.value)},equal(t,e,n){return typeof e=="function"?!0:Wt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||kd(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Wt(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Wt(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:tD(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{nD(n.id,t)}}};function rD(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=sD(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function sD(t,e){switch(zc(e)){case"object":return Hs(t,e);case"array":return Hs(t,{type:"array",value:e,compare:!1});case"boolean":return Hs(t,{type:"boolean",value:e});case"number":return Hs(t,{type:"number",value:e});case"function":return Hs(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Hs(t,e){return"type"in e?{name:t,...iD[e.type],...e}:"value"in e?{name:t,type:zc(e.value),...e}:{name:t,type:"object",value:e}}function kd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function zc(t){return kd(t)?"array":t===null?"null":typeof t}function oD(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const i=Nd(t.constructor,n),r=Object.create(i);r[Fc]=t,r[Ki]={},r[ni]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)r[a]=o[a]}return Object.freeze(r),r}const aD="_mergedDefaultProps";function Nd(t,e){let n=aD;if(e)for(const r of e){const s=r.constructor;s&&(n+=":".concat(s.extensionName||s.name))}const i=fT(t,n);return i||(t[n]=lD(t,e||[]))}function lD(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=Nd(i),s=fT(t,"defaultProps")||{},o=rD(s),a=Object.assign(Object.create(null),r,o.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[di],o.propTypes),c=Object.assign(Object.create(null),r==null?void 0:r[Hf],o.deprecatedProps);for(const u of e){const f=Nd(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[di]),Object.assign(c,f[Hf]))}return cD(a,t),fD(a,l),uD(a,c),a[di]=l,a[Hf]=c,e.length===0&&!Op(t,"_propTypes")&&(t._propTypes=l),a}function cD(t,e){const n=dD(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function uD(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])Op(this,s)||(this[s]=i);Y.deprecated(r,e[n].join("/"))()}})}function fD(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=hD(o))}t[Zr]=n,t[Ki]={},Object.defineProperties(t,i)}function hD(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||iT(e)?this[Ki][t]=e:this[ni][t]=e},get(){if(this[ni]){if(t in this[ni])return this[ni][t]||this[Zr][t];if(t in this[Ki]){const e=this[Fc]&&this[Fc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Zr][t]}}return this[Zr][t]}}}function Op(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function fT(t,e){return Op(t,e)&&t[e]}function dD(t){const e=t.componentName;return e||Y.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let gD=0;class kp{constructor(...e){g(this,"id",void 0),g(this,"props",void 0),g(this,"count",void 0),this.props=oD(this,e),this.id=this.props.id,this.count=gD++}clone(e){const{props:n}=this,i={};for(const r in n[Zr])r in n[ni]?i[r]=n[ni][r]:r in n[Ki]&&(i[r]=n[Ki][r]);return new this.constructor({...n,...i,...e})}}g(kp,"componentName","Component");g(kp,"defaultProps",{});const pD=Object.freeze({});class mD{constructor(e){g(this,"component",void 0),g(this,"onAsyncPropUpdated",void 0),g(this,"asyncProps",void 0),g(this,"oldProps",void 0),g(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||pD}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Fc]||this.component;const n=e[ni]||{},i=e[Ki]||e,r=e[Zr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(iT(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[di];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class yD extends mD{constructor({attributeManager:e,layer:n}){super(n),g(this,"attributeManager",void 0),g(this,"needsRedraw",void 0),g(this,"needsUpdate",void 0),g(this,"subLayers",void 0),g(this,"usesPickingColorCache",void 0),g(this,"hasPickingBuffer",void 0),g(this,"changeFlags",void 0),g(this,"viewport",void 0),g(this,"uniformTransitions",void 0),g(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const vD="layer.changeFlag",_D="layer.initialize",xD="layer.update",wD="layer.finalize",ED="layer.matched",kv=2**24-1,TD=Object.freeze([]),bD=da(({oldViewport:t,viewport:e})=>t.equals(e));let sn=new Uint8ClampedArray(0);const SD={data:{type:"data",value:TD,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:Ac(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):Ac(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Q.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Un extends kp{constructor(...e){super(...e),g(this,"internalState",null),g(this,"lifecycle",wr.NO_STATE),g(this,"context",void 0),g(this,"state",void 0),g(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Me(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=HE(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=GE(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Me(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Me(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Hk(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Q.DEFAULT||e===Q.LNGLAT||e===Q.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Me(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:qF(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=JF(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!bD({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(sn.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>kv&&Y.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),sn=hs.allocate(sn,n,{size:3,copy:!0,maxCount:Math.max(n,kv)});const r=Math.floor(sn.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),sn[o*3+0]=s[0],sn[o*3+1]=s[1],sn[o*3+2]=s[2]}e.value=sn.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,s=i||r,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==sn.buffer&&(i.value=sn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Me(!this.internalState),Me(Number.isFinite(this.props.coordinateSystem)),Ve(_D,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new yD({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Y.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new VF(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ve(ED,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ve(xD,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ve(wD,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];kn(s.gl,{polygonOffset:l}),Xt(s.gl,i,()=>{const c={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Ve(vD,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=GF(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){jF(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new FF(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),(n||a!==r.highlightedObjectIndex)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}g(Un,"defaultProps",SD);g(Un,"layerName","Layer");const PD="compositeLayer.renderLayers";class bu extends Un{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:_,extensions:T,fetch:y,operation:m,_subLayerProps:v}=this.props,E={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:_,extensions:T,fetch:y,operation:m},S=v&&e.id&&v[e.id],P=S&&S.updateTriggers,L=e.id||"sublayer";if(S){const C=this.props[di],M=e.type?e.type._propTypes:{};for(const I in S){const k=M[I]||C[I];k&&k.type==="accessor"&&(S[I]=this.getSubLayerAccessor(S[I]))}}Object.assign(E,e,S),E.id="".concat(this.props.id,"-").concat(L),E.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...P};for(const C of T){const M=C.getSubLayerProps.call(this,C);M&&Object.assign(E,M,{updateTriggers:Object.assign(E.updateTriggers,M.updateTriggers)})}return E}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=xu(s,Boolean),this.internalState.subLayers=i}Ve(PD,this,r,i);for(const s of i)s.parent=this}}g(bu,"layerName","CompositeLayer");const cl=Math.PI/180,Nv=180/Math.PI,Xl=6370972,Fr=256;function AD(){const t=Fr/Xl,e=Math.PI/180*Fr;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class LD extends or{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);const u=new Ke().lookAt({eye:[0,-c,0],up:[0,0,1]}),f=Math.pow(2,r);u.rotateX(n*cl),u.rotateZ(-i*cl),u.scale(f/l);const h=Math.atan(.5/c),d=Fr*2*f/l;super({...e,height:l,viewMatrix:u,longitude:i,latitude:n,zoom:r,distanceScales:AD(),fovyRadians:h*2,focalDistance:c,near:s,far:Math.min(2,1/d+1)*c*o}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return jt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(o))c=Zf(l,[r,a,o,1]);else{const d=Zf(l,[r,a,-1,1]),p=Zf(l,[r,a,1,1]),_=((i||0)/Xl+1)*Fr,T=Ff(bE([],d,p)),y=Ff(d),m=Ff(p),E=4*((4*y*m-(T-y-m)**2)/16)/T,S=Math.sqrt(y-E),P=Math.sqrt(Math.max(0,_*_-E)),L=(S-P)/Math.sqrt(T);c=KI([],d,p,L)}const[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i,r=0]=e,s=n*cl,o=i*cl,a=Math.cos(o),l=(r/Xl+1)*Fr;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=SE(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*Nv,c=o*Nv,u=(s/Fr-1)*Xl;return[l,c,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function Zf(t,e){const n=Es([],e,t);return bp(n,n,1/n[3]),n}class Np{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){g(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Wt(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}}g(Np,"defaultProps",{});g(Np,"extensionName","LayerExtension");class hT{constructor(e){g(this,"opts",void 0),g(this,"typedArrayManager",void 0),g(this,"indexStarts",[0]),g(this,"vertexStarts",[0]),g(this,"vertexCount",0),g(this,"instanceCount",0),g(this,"attributes",void 0),g(this,"_attributeDefs",void 0),g(this,"data",void 0),g(this,"getGeometry",void 0),g(this,"geometryBuffer",void 0),g(this,"buffers",void 0),g(this,"positionSize",void 0),g(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=hs,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Me(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?rT(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=Tu(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const d=f&&this.normalizeGeometry(f);c[h]=d,i[h+1]=i[h]+(d?this.getGeometrySize(d):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof ne){const f=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;r=r||f.length/h}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((f,h)=>{const d=c[h]||f;u.vertexStart=i[h],u.indexStart=n[h];const p=h<i.length-1?i[h+1]:r;u.geometrySize=p-i[h],u.geometryIndex=h,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const CD=typeof window<"u"?N.useLayoutEffect:N.useEffect,MD=CD;function Bc(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const ID={position:"absolute",zIndex:-1};function dT(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>dT(n,e));if(Su(t)){if(RD(t))return e.style=ID,N.cloneElement(t,e);if(OD(t))return N.cloneElement(t,e)}return t}function Su(t){return t&&typeof t=="object"&&"type"in t||!1}function RD(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function OD(t){const e=t.type;return e&&e.deckGLViewProps}function Fd(t){if(typeof t=="function")return N.createElement(ds,{},t);if(Array.isArray(t))return t.map(Fd);if(Su(t)){if(t.type===N.Fragment)return Fd(t.props.children);if(Bc(t.type,ds))return t}return t}function kD({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return N.Children.forEach(Fd(t),o=>{if(Su(o)){const a=o.type;if(Bc(a,Un)){const l=ND(a,o.props);r.push(l)}else i.push(o);if(Bc(a,ds)&&a!==ds&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function ND(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function FD({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of t){let a=s,l=o;Su(o)&&Bc(o.type,ds)&&(a=o.props.id||s,l=o.props.children);const c=i.getViewport(a),u=i.getViewState(a);if(c){u.padding=c.padding;const{x:f,y:h,width:d,height:p}=c;l=dT(l,{x:f,y:h,width:d,height:p,viewport:c,viewState:u}),r[a]||(r[a]={viewport:c,children:[]}),r[a].children.push(l)}}return Object.keys(r).map(o=>{const{viewport:a,children:l}=r[o],{x:c,y:u,width:f,height:h}=a,d={position:"absolute",left:c,top:u,width:f,height:h},p="view-".concat(o),_=N.createElement("div",{key:p,id:p,style:d},...l);if(n){const T={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:y=>{y.viewId=o,e._onViewStateChange(y)}};return N.createElement(n,{key:p,value:T},_)}return _})}const DD={mixBlendMode:null};function zD({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in DD?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function BD(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function gT(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function UD(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():gT(t)}});return i}const pT=N.forwardRef((t,e)=>{const[n,i]=N.useState(0),s=N.useRef({control:null,version:n,forceUpdate:()=>i(S=>S+1)}).current,o=N.useRef(null),a=N.useRef(null),l=N.useMemo(()=>kD(t),[t.layers,t.views,t.children]);let c=!0;const u=S=>{var P;return c&&t.viewState?(s.viewStateUpdateRequested=S,null):(s.viewStateUpdateRequested=null,(P=t.onViewStateChange)===null||P===void 0?void 0:P.call(t,S))},f=S=>{if(c)s.interactionStateUpdateRequested=S;else{var P;s.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)===null||P===void 0||P.call(t,S)}},h=N.useMemo(()=>{const S={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete S._customRender,s.deck&&s.deck.setProps(S),S},[t]);N.useEffect(()=>{const S=t.Deck||Eu;return s.deck=UD(s,S,{...h,parent:o.current,canvas:a.current}),()=>{var P;return(P=s.deck)===null||P===void 0?void 0:P.finalize()}},[]),MD(()=>{gT(s);const{viewStateUpdateRequested:S,interactionStateUpdateRequested:P}=s;S&&u(S),P&&f(P)}),N.useImperativeHandle(e,()=>BD(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:_,height:T,id:y,style:m}=t,{containerStyle:v,canvasStyle:E}=N.useMemo(()=>zD({width:_,height:T,style:m}),[_,T,m]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const S=FD({children:l.children,deck:s.deck,ContextProvider:p}),P=N.createElement("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:E});s.control=N.createElement("div",{id:"".concat(y||"deckgl","-wrapper"),ref:o,style:v},[P,S])}return c=!1,s.control});pT.defaultProps=Eu.defaultProps;const VD=pT;function Zl(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function jD(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function mT(t){let e,n,i;t.length!==2?(e=Zl,n=(a,l)=>Zl(t(a),l),i=(a,l)=>t(a)-l):(e=t===Zl||t===jD?t:GD,n=t,i=t);function r(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const f=c+u>>>1;n(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const f=c+u>>>1;n(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){const f=r(a,l,c,u-1);return f>c&&i(a[f-1],l)>-i(a[f],l)?f-1:f}return{left:r,center:o,right:s}}function GD(){return 0}function WD(t){return t===null?NaN:+t}const HD=mT(Zl),$D=HD.right;mT(WD).center;const YD=$D,XD=Math.sqrt(50),ZD=Math.sqrt(10),qD=Math.sqrt(2);function Uc(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=XD?10:s>=ZD?5:s>=qD?2:1;let a,l,c;return r<0?(c=Math.pow(10,-r)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,r)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=n&&n<2?Uc(t,e,n*2):[a,l,c]}function KD(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Uc(e,t,n):Uc(t,e,n);if(!(s>=r))return[];const a=s-r+1,l=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(r+c)/-o;else for(let c=0;c<a;++c)l[c]=(r+c)*o;return l}function Dd(t,e,n){return e=+e,t=+t,n=+n,Uc(t,e,n)[2]}function QD(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Dd(e,t,n):Dd(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function JD(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Fp(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function yT(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function va(){}var Uo=.7,Vc=1/Uo,qr="\\s*([+-]?\\d+)\\s*",Vo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ez=/^#([0-9a-f]{3,8})$/,tz=new RegExp(`^rgb\\(${qr},${qr},${qr}\\)$`),nz=new RegExp(`^rgb\\(${hn},${hn},${hn}\\)$`),iz=new RegExp(`^rgba\\(${qr},${qr},${qr},${Vo}\\)$`),rz=new RegExp(`^rgba\\(${hn},${hn},${hn},${Vo}\\)$`),sz=new RegExp(`^hsl\\(${Vo},${hn},${hn}\\)$`),oz=new RegExp(`^hsla\\(${Vo},${hn},${hn},${Vo}\\)$`),Fv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fp(va,jo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Dv,formatHex:Dv,formatHex8:az,formatHsl:lz,formatRgb:zv,toString:zv});function Dv(){return this.rgb().formatHex()}function az(){return this.rgb().formatHex8()}function lz(){return vT(this).formatHsl()}function zv(){return this.rgb().formatRgb()}function jo(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ez.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Bv(e):n===3?new rt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ul(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ul(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=tz.exec(t))?new rt(e[1],e[2],e[3],1):(e=nz.exec(t))?new rt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=iz.exec(t))?ul(e[1],e[2],e[3],e[4]):(e=rz.exec(t))?ul(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=sz.exec(t))?jv(e[1],e[2]/100,e[3]/100,1):(e=oz.exec(t))?jv(e[1],e[2]/100,e[3]/100,e[4]):Fv.hasOwnProperty(t)?Bv(Fv[t]):t==="transparent"?new rt(NaN,NaN,NaN,0):null}function Bv(t){return new rt(t>>16&255,t>>8&255,t&255,1)}function ul(t,e,n,i){return i<=0&&(t=e=n=NaN),new rt(t,e,n,i)}function cz(t){return t instanceof va||(t=jo(t)),t?(t=t.rgb(),new rt(t.r,t.g,t.b,t.opacity)):new rt}function zd(t,e,n,i){return arguments.length===1?cz(t):new rt(t,e,n,i??1)}function rt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Fp(rt,zd,yT(va,{brighter(t){return t=t==null?Vc:Math.pow(Vc,t),new rt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Uo:Math.pow(Uo,t),new rt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new rt(Vi(this.r),Vi(this.g),Vi(this.b),jc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Uv,formatHex:Uv,formatHex8:uz,formatRgb:Vv,toString:Vv}));function Uv(){return`#${Di(this.r)}${Di(this.g)}${Di(this.b)}`}function uz(){return`#${Di(this.r)}${Di(this.g)}${Di(this.b)}${Di((isNaN(this.opacity)?1:this.opacity)*255)}`}function Vv(){const t=jc(this.opacity);return`${t===1?"rgb(":"rgba("}${Vi(this.r)}, ${Vi(this.g)}, ${Vi(this.b)}${t===1?")":`, ${t})`}`}function jc(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Vi(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Di(t){return t=Vi(t),(t<16?"0":"")+t.toString(16)}function jv(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ut(t,e,n,i)}function vT(t){if(t instanceof Ut)return new Ut(t.h,t.s,t.l,t.opacity);if(t instanceof va||(t=jo(t)),!t)return new Ut;if(t instanceof Ut)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(e===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-e)/a+2:o=(e-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Ut(o,a,l,t.opacity)}function fz(t,e,n,i){return arguments.length===1?vT(t):new Ut(t,e,n,i??1)}function Ut(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Fp(Ut,fz,yT(va,{brighter(t){return t=t==null?Vc:Math.pow(Vc,t),new Ut(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Uo:Math.pow(Uo,t),new Ut(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new rt(qf(t>=240?t-240:t+120,r,i),qf(t,r,i),qf(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Ut(Gv(this.h),fl(this.s),fl(this.l),jc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=jc(this.opacity);return`${t===1?"hsl(":"hsla("}${Gv(this.h)}, ${fl(this.s)*100}%, ${fl(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Gv(t){return t=(t||0)%360,t<0?t+360:t}function fl(t){return Math.max(0,Math.min(1,t||0))}function qf(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Dp=t=>()=>t;function hz(t,e){return function(n){return t+n*e}}function dz(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function gz(t){return(t=+t)==1?_T:function(e,n){return n-e?dz(e,n,t):Dp(isNaN(e)?n:e)}}function _T(t,e){var n=e-t;return n?hz(t,n):Dp(isNaN(t)?e:t)}const Wv=function t(e){var n=gz(e);function i(r,s){var o=n((r=zd(r)).r,(s=zd(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),c=_T(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function pz(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function mz(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function yz(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=zp(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function vz(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Gc(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function _z(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=zp(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Bd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Kf=new RegExp(Bd.source,"g");function xz(t){return function(){return t}}function wz(t){return function(e){return t(e)+""}}function Ez(t,e){var n=Bd.lastIndex=Kf.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=Bd.exec(t))&&(r=Kf.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Gc(i,r)})),n=Kf.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?wz(l[0].x):xz(e):(e=l.length,function(c){for(var u=0,f;u<e;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function zp(t,e){var n=typeof e,i;return e==null||n==="boolean"?Dp(e):(n==="number"?Gc:n==="string"?(i=jo(e))?(e=i,Wv):Ez:e instanceof jo?Wv:e instanceof Date?vz:mz(e)?pz:Array.isArray(e)?yz:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_z:Gc)(t,e)}function Tz(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function bz(t){return function(){return t}}function Sz(t){return+t}var Hv=[0,1];function Dr(t){return t}function Ud(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:bz(isNaN(e)?NaN:.5)}function Pz(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Az(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=Ud(r,i),s=n(o,s)):(i=Ud(i,r),s=n(s,o)),function(a){return s(i(a))}}function Lz(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=Ud(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var l=YD(t,a,1,i)-1;return s[l](r[l](a))}}function Cz(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Mz(){var t=Hv,e=Hv,n=zp,i,r,s,o=Dr,a,l,c;function u(){var h=Math.min(t.length,e.length);return o!==Dr&&(o=Pz(t[0],t[h-1])),a=h>2?Lz:Az,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?s:(l||(l=a(t.map(i),e,n)))(i(o(h)))}return f.invert=function(h){return o(r((c||(c=a(e,t.map(i),Gc)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,Sz),u()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),u()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=Tz,u()},f.clamp=function(h){return arguments.length?(o=h?!0:Dr,u()):o!==Dr},f.interpolate=function(h){return arguments.length?(n=h,u()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return i=h,r=d,u()}}function Iz(){return Mz()(Dr,Dr)}function Rz(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Wc(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function gs(t){return t=Wc(Math.abs(t)),t?t[1]:NaN}function Oz(t,e){return function(n,i){for(var r=n.length,s=[],o=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function kz(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Nz=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hc(t){if(!(e=Nz.exec(t)))throw new Error("invalid format: "+t);var e;return new Bp({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Hc.prototype=Bp.prototype;function Bp(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Bp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fz(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var xT;function Dz(t,e){var n=Wc(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(xT=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Wc(t,Math.max(0,e+s-1))[0]}function $v(t,e){var n=Wc(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Yv={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Rz,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>$v(t*100,e),r:$v,s:Dz,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Xv(t){return t}var Zv=Array.prototype.map,qv=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function zz(t){var e=t.grouping===void 0||t.thousands===void 0?Xv:Oz(Zv.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Xv:kz(Zv.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(f){f=Hc(f);var h=f.fill,d=f.align,p=f.sign,_=f.symbol,T=f.zero,y=f.width,m=f.comma,v=f.precision,E=f.trim,S=f.type;S==="n"?(m=!0,S="g"):Yv[S]||(v===void 0&&(v=12),E=!0,S="g"),(T||h==="0"&&d==="=")&&(T=!0,h="0",d="=");var P=_==="$"?n:_==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",L=_==="$"?i:/[%p]/.test(S)?o:"",C=Yv[S],M=/[defgprs%]/.test(S);v=v===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function I(k){var W=P,j=L,H,et,Kt;if(S==="c")j=C(k)+j,k="";else{k=+k;var Ot=k<0||1/k<0;if(k=isNaN(k)?l:C(Math.abs(k),v),E&&(k=Fz(k)),Ot&&+k==0&&p!=="+"&&(Ot=!1),W=(Ot?p==="("?p:a:p==="-"||p==="("?"":p)+W,j=(S==="s"?qv[8+xT/3]:"")+j+(Ot&&p==="("?")":""),M){for(H=-1,et=k.length;++H<et;)if(Kt=k.charCodeAt(H),48>Kt||Kt>57){j=(Kt===46?r+k.slice(H+1):k.slice(H))+j,k=k.slice(0,H);break}}}m&&!T&&(k=e(k,1/0));var D=W.length+k.length+j.length,G=D<y?new Array(y-D+1).join(h):"";switch(m&&T&&(k=e(G+k,G.length?y-j.length:1/0),G=""),d){case"<":k=W+k+j+G;break;case"=":k=W+G+k+j;break;case"^":k=G.slice(0,D=G.length>>1)+W+k+j+G.slice(D);break;default:k=G+W+k+j;break}return s(k)}return I.toString=function(){return f+""},I}function u(f,h){var d=c((f=Hc(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(gs(h)/3)))*3,_=Math.pow(10,-p),T=qv[8+p/3];return function(y){return d(_*y)+T}}return{format:c,formatPrefix:u}}var hl,wT,ET;Bz({thousands:",",grouping:[3],currency:["$",""]});function Bz(t){return hl=zz(t),wT=hl.format,ET=hl.formatPrefix,hl}function Uz(t){return Math.max(0,-gs(Math.abs(t)))}function Vz(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(gs(e)/3)))*3-gs(Math.abs(t)))}function jz(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,gs(e)-gs(t))+1}function Gz(t,e,n,i){var r=QD(t,e,n),s;switch(i=Hc(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Vz(r,o))&&(i.precision=s),ET(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=jz(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Uz(r))&&(i.precision=s-(i.type==="%")*2);break}}return wT(i)}function Wz(t){var e=t.domain;return t.ticks=function(n){var i=e();return KD(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Gz(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],a=i[s],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=r,r=s,s=c);u-- >0;){if(c=Dd(o,a,n),c===l)return i[r]=o,i[s]=a,e(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function TT(){var t=Iz();return t.copy=function(){return Cz(t,TT())},JD.apply(t,arguments),Wz(t)}const Hz=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,$z=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Yz=1024,Xz=4,Kv=()=>{},Qv={10241:9987,10240:9729,10242:33071,10243:33071};function Zz(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function qz(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),o=Math.floor(e.height*r);return r===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Go(t){return t&&(t.id||t.url)}function Kz(t,e,n,i){const r=t.width,s=t.height,o=new yt(t.gl,{width:e,height:n,parameters:i});return d3(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function Jv(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Go(r);t[o]={...r,x:s,y:n}}}function Qz({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Go(c);if(!n[u]){const{height:f,width:h}=c;i+h+e>o&&(Jv(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+h+e,s=Math.max(s,f)}}return a.length>0&&Jv(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:Zz(s+r+e)}}function Jz(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Tu(t);for(const o of r){s.index++;const a=e(o,s),l=Go(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class e4{constructor(e,{onUpdate:n=Kv,onError:i=Kv}){g(this,"gl",void 0),g(this,"onUpdate",void 0),g(this,"onError",void 0),g(this,"_loadOptions",null),g(this,"_texture",null),g(this,"_externalTexture",null),g(this,"_mapping",{}),g(this,"_textureParameters",null),g(this,"_pendingCount",0),g(this,"_autoPacking",!1),g(this,"_xOffset",0),g(this,"_yOffset",0),g(this,"_rowHeight",0),g(this,"_buffer",Xz),g(this,"_canvasWidth",Yz),g(this,"_canvasHeight",0),g(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Go(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(Jz(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=Qz({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new yt(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Qv})),this._texture.height!==this._canvasHeight&&(this._texture=Kz(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Qv)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Ac(i.url,this._loadOptions).then(r=>{const s=Go(i),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:f,width:h,height:d}=qz(n,r,c,u);this._texture.setSubImageData({data:f,x:a+(c-h)/2,y:l+(u-d)/2,width:h,height:d}),o.width=h,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const bT=[0,0,0,255],t4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:bT},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Pu extends Un{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:Hz,fs:$z,modules:[ga,pa]})}initializeState(){this.state={iconManager:new e4(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:bT},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state,h=o||this.internalState.isAsyncPropLoading("iconAtlas");if(f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&f.packIcons(l,c),r.extensionsChanged){var d;const{gl:p}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:Yi[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new qi(e,{...this.getShaders(),id:this.props.id,geometry:new ha({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):Y.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}g(Pu,"defaultProps",t4);g(Pu,"layerName","IconLayer");const n4=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,i4=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,e_=[0,0,0,255],r4={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:e_},getLineColor:{type:"accessor",value:e_},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Up extends Un{getShaders(){return super.getShaders({vs:n4,fs:i4,modules:[ga,pa]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:Yi[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:Yi[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new qi(e,{...this.getShaders(),id:this.props.id,geometry:new ha({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}g(Up,"defaultProps",r4);g(Up,"layerName","ScatterplotLayer");const ST={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function PT(t,e,n={}){return s4(t,n)!==e?(o4(t,n),!0):!1}function s4(t,e={}){return Math.sign($c(t,e))}function $c(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function o4(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function a4(t,e,n=2,i){const r=e&&e.length,s=r?e[0]*n:t.length;let o=AT(t,0,s,n,!0,i&&i[0]);const a=[];if(!o||o.next===o.prev)return a;let l,c,u,f,h,d,p;if(r&&(o=h4(t,e,o,n,i)),t.length>80*n){f=c=t[0],h=u=t[1];for(let _=n;_<s;_+=n)d=t[_],p=t[_+1],d<f&&(f=d),p<h&&(h=p),d>c&&(c=d),p>u&&(u=p);l=Math.max(c-f,u-h),l=l!==0?1/l:0}return Wo(o,a,n,f,h,l),a}function AT(t,e,n,i,r,s){let o,a;if(s===void 0&&(s=$c(t,{start:e,end:n,size:i})),r===s<0)for(o=e;o<n;o+=i)a=t_(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=t_(o,t[o],t[o+1],a);return a&&Au(a,a.next)&&($o(a),a=a.next),a}function vi(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Au(n,n.next)||ge(n.prev,n,n.next)===0)){if($o(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Wo(t,e,n,i,r,s,o){if(!t)return;!o&&s&&y4(t,i,r,s);let a=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?c4(t,i,r,s):l4(t)){e.push(l.i/n),e.push(t.i/n),e.push(c.i/n),$o(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=u4(vi(t),e,n),Wo(t,e,n,i,r,s,2)):o===2&&f4(t,e,n,i,r,s):Wo(vi(t),e,n,i,r,s,1);break}}}function l4(t){const e=t.prev,n=t,i=t.next;if(ge(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(zr(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&ge(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function c4(t,e,n,i){const r=t.prev,s=t,o=t.next;if(ge(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,f=Vd(a,l,e,n,i),h=Vd(c,u,e,n,i);let d=t.prevZ,p=t.nextZ;for(;d&&d.z>=f&&p&&p.z<=h;){if(d!==t.prev&&d!==t.next&&zr(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&ge(d.prev,d,d.next)>=0||(d=d.prevZ,p!==t.prev&&p!==t.next&&zr(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ge(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==t.prev&&d!==t.next&&zr(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&ge(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==t.prev&&p!==t.next&&zr(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ge(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function u4(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Au(r,s)&&LT(r,i,i.next,s)&&Ho(r,s)&&Ho(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),$o(i),$o(i.next),i=t=s),i=i.next}while(i!==t);return vi(i)}function f4(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&x4(o,a)){let l=CT(o,a);o=vi(o,o.next),l=vi(l,l.next),Wo(o,e,n,i,r,s),Wo(l,e,n,i,r,s);return}a=a.next}o=o.next}while(o!==t)}function h4(t,e,n,i,r){const s=[];let o,a,l,c,u;for(o=0,a=e.length;o<a;o++)l=e[o]*i,c=o<a-1?e[o+1]*i:t.length,u=AT(t,l,c,i,!1,r&&r[o+1]),u===u.next&&(u.steiner=!0),s.push(_4(u));for(s.sort(d4),o=0;o<s.length;o++)g4(s[o],n),n=vi(n,n.next);return n}function d4(t,e){return t.x-e.x}function g4(t,e){if(e=p4(t,e),e){const n=CT(e,t);vi(e,e.next),vi(n,n.next)}}function p4(t,e){let n=e;const i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const h=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=i&&h>s){if(s=h,h===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;const a=o,l=o.x,c=o.y;let u=1/0,f;n=o;do i>=n.x&&n.x>=l&&i!==n.x&&zr(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)&&(f=Math.abs(r-n.y)/(i-n.x),Ho(n,t)&&(f<u||f===u&&(n.x>o.x||n.x===o.x&&m4(o,n)))&&(o=n,u=f)),n=n.next;while(n!==a);return o}function m4(t,e){return ge(t.prev,t,e.prev)<0&&ge(e.next,t,t.next)<0}function y4(t,e,n,i){let r=t;do r.z===null&&(r.z=Vd(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,v4(r)}function v4(t){let e,n,i=1,r,s,o,a,l,c;do{for(s=t,t=null,c=null,r=0;s;){for(r++,a=s,o=0,n=0;n<i&&(o++,a=a.nextZ,!!a);n++);for(l=i;o>0||l>0&&a;)o!==0&&(l===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,l--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;s=a}c.nextZ=null,i*=2}while(r>1);return t}function Vd(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function _4(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function zr(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function x4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!w4(t,e)&&(Ho(t,e)&&Ho(e,t)&&E4(t,e)&&(ge(t.prev,t,e.prev)||ge(t,e.prev,e))||Au(t,e)&&ge(t.prev,t,t.next)>0&&ge(e.prev,e,e.next)>0)}function ge(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Au(t,e){return t.x===e.x&&t.y===e.y}function LT(t,e,n,i){const r=gl(ge(t,e,n)),s=gl(ge(t,e,i)),o=gl(ge(n,i,t)),a=gl(ge(n,i,e));return!!(r!==s&&o!==a||r===0&&dl(t,n,e)||s===0&&dl(t,i,e)||o===0&&dl(n,t,i)||a===0&&dl(n,e,i))}function dl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function gl(t){return t>0?1:t<0?-1:0}function w4(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&LT(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ho(t,e){return ge(t.prev,t,t.next)<0?ge(t,e,t.next)>=0&&ge(t,t.prev,e)>=0:ge(t,e,t.prev)<0||ge(t,t.next,e)<0}function E4(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function CT(t,e){const n=new jd(t.i,t.x,t.y),i=new jd(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function t_(t,e,n,i){const r=new jd(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function $o(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ht(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Gd(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Yo(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Wd(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function ql(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function MT(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=Yo(t,0,n,o);let h,d;const p=RT(f,r,s,[]),_=[];Ht(c,f);for(let T=1;T<l;T++){for(h=Yo(t,T,n,o,h),d=ql(h,p);d;){Wd(f,h,d,p,_);const y=ql(_,p);y&&(Wd(f,_,y,p,_),d=y),Ht(c,_),Gd(f,_),b4(p,r,d),i&&c.length>n&&(c=[],u.push(c),Ht(c,f)),d=ql(h,p)}Ht(c,h),Gd(f,h)}return i?u:u[0]}const n_=0,T4=1;function pl(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function IT(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(T4):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:d}=l.shift();S4(f,i,d[0]||f.length,c),u=RT(c[0],r,s,u);const p=ql(c[1],u);if(p){let _=i_(f,h,i,0,d[0]||f.length,u,p);const T={pos:_[0].pos,types:_[0].types,holes:[]},y={pos:_[1].pos,types:_[1].types,holes:[]};l.push(T,y);for(let m=0;m<d.length;m++)_=i_(f,h,i,d[m],d[m+1]||f.length,u,p),_[0]&&(T.holes.push(T.pos.length),T.pos=pl(T.pos,_[0].pos),o&&(T.types=pl(T.types,_[0].types))),_[1]&&(y.holes.push(y.pos.length),y.pos=pl(y.pos,_[1].pos),o&&(y.types=pl(y.types,_[1].types)))}else{const _={positions:f};o&&(_.edgeTypes=h),d.length&&(_.holeIndices=d),a.push(_)}}return a}function i_(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],f=[],h=[];let d,p,_;const T=Yo(t,a-1,n,i);let y=Math.sign(o&8?T[1]-s[3]:T[0]-s[2]),m=e&&e[a-1],v=0,E=0;for(let S=0;S<a;S++)d=Yo(t,S,n,i,d),p=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),_=e&&e[i/n+S],p&&y&&y!==p&&(Wd(T,d,o,s,h),Ht(l,h)&&u.push(m),Ht(c,h)&&f.push(m)),p<=0?(Ht(l,d)&&u.push(_),v-=p):u.length&&(u[u.length-1]=n_),p>=0?(Ht(c,d)&&f.push(_),E+=p):f.length&&(f[f.length-1]=n_),Gd(T,d),y=p,m=_;return[v?{pos:l,types:e&&u}:null,E?{pos:c,types:e&&f}:null]}function RT(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function b4(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function S4(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const P4=85.051129;function A4(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);OT(o,n,0,r-i);const a=MT(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)kT(l,n);return a}function L4(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,d=c,p=C4(t,i,l,h);for(let _=p;_<h;_++)o[c++]=t[_];for(let _=l;_<p;_++)o[c++]=t[_];OT(o,i,d,c),M4(o,i,d,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=IT(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const f of u)kT(f.positions,i);return u}function C4(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function M4(t,e,n,i,r=P4){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=Yo(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Ht(t,a),a[1]=Math.sign(a[1])*r,Ht(t,a),a[0]=s,Ht(t,a)}}function OT(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function kT(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}function I4(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?MT(r,{size:e,gridResolution:n}):i?A4(r,{size:e}):r}const R4=1,O4=2,Qf=4;class k4 extends hT{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?I4(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(r_(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&r_(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=Qf,i[s+o-2]=Qf):(i[s]+=R4,i[s+o-2]+=O4),i[s+o-1]=Qf}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function r_(t){return Array.isArray(t[0])}const N4=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,F4=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,NT=[0,0,0,255],D4={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:NT},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Jf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Vp extends Un{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:N4,fs:F4,modules:[ga,pa]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Jf,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Jf,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Jf,defaultValue:NT},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new k4({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:Yi[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new qi(e,{...this.getShaders(),id:this.props.id,geometry:new ha({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}g(Vp,"defaultProps",D4);g(Vp,"layerName","PathLayer");var jp={exports:{}};jp.exports=Lu;jp.exports.default=Lu;function Lu(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=FT(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,d;if(i&&(s=j4(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<r;p+=n)f=t[p],h=t[p+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return Xo(s,o,n,a,l,d,0),o}function FT(t,e,n,i,r){var s,o;if(r===Yd(t,e,n,i)>0)for(s=e;s<n;s+=i)o=s_(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=s_(s,t[s],t[s+1],o);return o&&Cu(o,o.next)&&(qo(o),o=o.next),o}function Qi(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Cu(n,n.next)||pe(n.prev,n,n.next)===0)){if(qo(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Xo(t,e,n,i,r,s,o){if(t){!o&&s&&Y4(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?B4(t,i,r,s):z4(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),qo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=U4(Qi(t),e,n),Xo(t,e,n,i,r,s,2)):o===2&&V4(t,e,n,i,r,s):Xo(Qi(t),e,n,i,r,s,1);break}}}}function z4(t){var e=t.prev,n=t,i=t.next;if(pe(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,p=i.next;p!==e;){if(p.x>=u&&p.x<=h&&p.y>=f&&p.y<=d&&Br(r,a,s,l,o,c,p.x,p.y)&&pe(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function B4(t,e,n,i){var r=t.prev,s=t,o=t.next;if(pe(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,f=s.y,h=o.y,d=a<l?a<c?a:c:l<c?l:c,p=u<f?u<h?u:h:f<h?f:h,_=a>l?a>c?a:c:l>c?l:c,T=u>f?u>h?u:h:f>h?f:h,y=Hd(d,p,e,n,i),m=Hd(_,T,e,n,i),v=t.prevZ,E=t.nextZ;v&&v.z>=y&&E&&E.z<=m;){if(v.x>=d&&v.x<=_&&v.y>=p&&v.y<=T&&v!==r&&v!==o&&Br(a,u,l,f,c,h,v.x,v.y)&&pe(v.prev,v,v.next)>=0||(v=v.prevZ,E.x>=d&&E.x<=_&&E.y>=p&&E.y<=T&&E!==r&&E!==o&&Br(a,u,l,f,c,h,E.x,E.y)&&pe(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;v&&v.z>=y;){if(v.x>=d&&v.x<=_&&v.y>=p&&v.y<=T&&v!==r&&v!==o&&Br(a,u,l,f,c,h,v.x,v.y)&&pe(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;E&&E.z<=m;){if(E.x>=d&&E.x<=_&&E.y>=p&&E.y<=T&&E!==r&&E!==o&&Br(a,u,l,f,c,h,E.x,E.y)&&pe(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function U4(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Cu(r,s)&&DT(r,i,i.next,s)&&Zo(r,s)&&Zo(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),qo(i),qo(i.next),i=t=s),i=i.next}while(i!==t);return Qi(i)}function V4(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&q4(o,a)){var l=zT(o,a);o=Qi(o,o.next),l=Qi(l,l.next),Xo(o,e,n,i,r,s,0),Xo(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function j4(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=FT(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Z4(c));for(r.sort(G4),s=0;s<r.length;s++)n=W4(r[s],n);return n}function G4(t,e){return t.x-e.x}function W4(t,e){var n=H4(t,e);if(!n)return e;var i=zT(n,t);return Qi(i,i.next),Qi(n,n.next)}function H4(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&Br(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),Zo(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&$4(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function $4(t,e){return pe(t.prev,t,e.prev)<0&&pe(e.next,t,t.next)<0}function Y4(t,e,n,i){var r=t;do r.z===0&&(r.z=Hd(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,X4(r)}function X4(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function Hd(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Z4(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Br(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function q4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!K4(t,e)&&(Zo(t,e)&&Zo(e,t)&&Q4(t,e)&&(pe(t.prev,t,e.prev)||pe(t,e.prev,e))||Cu(t,e)&&pe(t.prev,t,t.next)>0&&pe(e.prev,e,e.next)>0)}function pe(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Cu(t,e){return t.x===e.x&&t.y===e.y}function DT(t,e,n,i){var r=yl(pe(t,e,n)),s=yl(pe(t,e,i)),o=yl(pe(n,i,t)),a=yl(pe(n,i,e));return!!(r!==s&&o!==a||r===0&&ml(t,n,e)||s===0&&ml(t,i,e)||o===0&&ml(n,t,i)||a===0&&ml(n,e,i))}function ml(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function yl(t){return t>0?1:t<0?-1:0}function K4(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&DT(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Zo(t,e){return pe(t.prev,t,t.next)<0?pe(t,e,t.next)>=0&&pe(t,t.prev,e)>=0:pe(t,e,t.prev)<0||pe(t,t.next,e)<0}function Q4(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function zT(t,e){var n=new $d(t.i,t.x,t.y),i=new $d(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function s_(t,e,n,i){var r=new $d(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function qo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $d(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Lu.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Yd(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Yd(t,c,u,n))}var f=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,d=i[a+1]*n,p=i[a+2]*n;f+=Math.abs((t[h]-t[p])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[p+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Yd(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}Lu.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var J4=jp.exports;const eB=Jc(J4),vl=ST.CLOCKWISE,o_=ST.COUNTER_CLOCKWISE,ii={isClosed:!0};function tB(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function to(t){return"positions"in t?t.positions:t}function Kl(t){return"holeIndices"in t?t.holeIndices:null}function nB(t){return Array.isArray(t[0])}function iB(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function rB(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function sB(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function a_(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!rB(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return ii.start=e,ii.end=s,ii.size=i,PT(t,r,ii),s}function l_(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!sB(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return ii.start=e,ii.end=l,ii.size=i,PT(t,o,ii),l}function oB(t,e){tB(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=l_(n,o,r,e,s[a-1],s[a],a===0?vl:o_),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!nB(t))return l_(n,0,t,e,0,n.length,vl),n;if(!iB(t)){let r=0;for(const[s,o]of t.entries())r=a_(n,r,o,e,s===0?vl:o_),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return a_(n,0,t,e,vl),n}function eh(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=t[s*3+e]*t[o*3+n],r-=t[o*3+e]*t[s*3+n]}return Math.abs(r/2)}function c_(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+i]=c}}function aB(t,e,n,i){let r=Kl(t);r&&(r=r.map(a=>a/e));let s=to(t);const o=i&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=eh(s,0,1),l=eh(s,0,2),c=eh(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),c_(s,0,2,1)):(n||(s=s.slice()),c_(s,2,0,1)))}return eB(s,r,e)}class lB extends hT{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=oB(e,this.positionSize);return this.opts.resolution?IT(to(n),Kl(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?L4(to(n),Kl(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(u_(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return to(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&u_(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=aB(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,r+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=to(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&Kl(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function u_(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const BT=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cB=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(BT,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),uB=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(BT,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),fB=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Yc=[0,0,0,255],hB={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Yc},getLineColor:{type:"accessor",value:Yc},material:!0},_l={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Gp extends Un{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?cB:uB,fs:fB,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ga,dO,pa]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:r}=this.props;n.isGeospatial&&i===Q.DEFAULT&&(i=Q.LNGLAT);let s;i===Q.LNGLAT&&(r?s=n.projectPosition.bind(n):s=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new lB({preproject:s,fp64:this.use64bitPositions(),IndexType:!e||mp(e,le.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const o=this.getAttributeManager(),a=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:_l,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,transition:_l,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:_l,accessor:"getFillColor",defaultValue:Yc,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:_l,accessor:"getLineColor",defaultValue:Yc,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(l,{index:c,target:u})=>this.encodePickingColor(l&&l.__source?l.__source.index:c,u),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:!!n,elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new qi(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new qi(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new ha({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}g(Gp,"defaultProps",hB);g(Gp,"layerName","SolidPolygonLayer");function dB({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const d=e(t[h]);if(a>h&&d>=r&&(a=h),d>=s){l=h;break}}let c=a;const f=l-a!==i.length?t.slice(l):void 0;for(let h=0;h<i.length;h++)t[c++]=i[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+i.length}}function gB(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?pB(t,i,n):null}function pB(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function mB(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const yB=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,th=192/256,f_=[],vB={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Wp extends Pu{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:yB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&Y.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state,o=r?Math.max(i,th*(1-r)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:th,outlineBuffer:o,gamma:i,sdf:!!n,outlineColor:s},super.draw(e),n&&r){const{iconManager:a}=this.state;a.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:th}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):f_}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):f_}}g(Wp,"defaultProps",vB);g(Wp,"layerName","MultiIconLayer");const yo=1e20;class _B{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=r,this.radius=i;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(r)),f=c+2*this.buffer,h=u+2*this.buffer,d=Math.max(f*h,0),p=new Uint8ClampedArray(d),_={data:p,width:f,height:h,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return _;const{ctx:T,buffer:y,gridInner:m,gridOuter:v}=this;T.clearRect(y,y,c,u),T.fillText(e,y,y+a);const E=T.getImageData(y,y,c,u);v.fill(yo,0,d),m.fill(0,0,d);for(let S=0;S<u;S++)for(let P=0;P<c;P++){const L=E.data[4*(S*c+P)+3]/255;if(L===0)continue;const C=(S+y)*f+P+y;if(L===1)v[C]=0,m[C]=yo;else{const M=.5-L;v[C]=M>0?M*M:0,m[C]=M<0?M*M:0}}h_(v,0,0,f,h,f,this.f,this.v,this.z),h_(m,y,y,c,u,f,this.f,this.v,this.z);for(let S=0;S<d;S++){const P=Math.sqrt(v[S])-Math.sqrt(m[S]);p[S]=Math.round(255-255*(P/this.radius+this.cutoff))}return _}}function h_(t,e,n,i,r,s,o,a,l){for(let c=e;c<e+i;c++)d_(t,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)d_(t,c*s+e,1,i,o,a,l)}function d_(t,e,n,i,r,s,o){s[0]=0,o[0]=-yo,o[1]=yo,r[0]=t[e];for(let a=1,l=0,c=0;a<i;a++){r[a]=t[e+a*n];const u=a*a;do{const f=s[l];c=(r[a]-r[f]+u-f*f)/(a-f)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=yo}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=r[c]+u*u}}const xB=32,wB=[];function EB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function TB({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+i*2;for(const f of t)if(!s[f]){const h=e(f);c+h+i*2>r&&(c=0,l++),s[f]={x:c+i,y:a+l*u+i,width:h,height:u,layoutWidth:h,layoutHeight:n},c+=h+i*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:EB(a+(l+1)*u)}}function UT(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.layoutWidth)||0}return r}function VT(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=UT(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function bB(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=UT(t,a,l,r);c+f>i&&(o<a&&(s.push(a),o=a,c=0),f>i&&(f=VT(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=f}return c}function SB(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?VT(t,r,s,n,i,o):bB(t,r,s,n,i,o),o}function PB(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.layoutHeight),r[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(Y.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),r[l]=o,o+=xB)}s[0]=o,s[1]=a}function AB(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,f=[0,0],h=[0,0];let d=0,p=0,_=0;for(let y=0;y<=o;y++){const m=s[y];if((m===`
`||y===o)&&(_=y),_>p){const v=u?SB(s,n,i,r,p,_):wB;for(let E=0;E<=v.length;E++){const S=E===0?p:v[E-1],P=E<v.length?v[E]:_;PB(s,S,P,r,a,h);for(let L=S;L<P;L++){var T;const C=s[L],M=((T=r[C])===null||T===void 0?void 0:T.layoutOffsetY)||0;l[L]=d+h[1]/2+M,c[L]=h[0]}d=d+h[1]*e,f[0]=Math.max(f[0],h[0])}p=_}m===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return f[1]=d,{x:a,y:l,rowWidth:c,size:f}}function LB({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const d=t.constructor;h=new d(c);for(let p=0;p<c;p++)h[p]=t[p*a+l]}for(let d=0;d<e;d++){const p=r[d],_=r[d+1]||c,T=h.subarray(p,_);f[d]=String.fromCodePoint.apply(null,T),u&&T.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:f,characterCount:c}}class jT{constructor(e=5){g(this,"limit",void 0),g(this,"_cache",{}),g(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function CB(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Kr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:CB(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},g_=1024,p_=.9,m_=1.2,GT=3;let Xc=new jT(GT);function MB(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Xc.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function IB(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function y_(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function RB(t){Y.assert(Number.isFinite(t)&&t>=GT,"Invalid cache limit"),Xc=new jT(t)}class OB{constructor(){g(this,"props",{...Kr}),g(this,"_key",void 0),g(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*m_+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=MB(this._key,this.props.characterSet),i=Xc.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const r=this._generateFontAtlas(n,i);this._atlas=r,Xc.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=g_);const f=u.getContext("2d",{willReadFrequently:!0});y_(f,i,s,r);const{mapping:h,canvasHeight:d,xOffset:p,yOffset:_}=TB({getFontWidth:T=>f.measureText(T).width,fontHeight:s*m_,buffer:o,characterSet:e,maxCanvasWidth:g_,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const T=f.getImageData(0,0,u.width,u.height);u.height=d,f.putImageData(T,0,0)}if(y_(f,i,s,r),a){const T=new _B({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:i,fontWeight:"".concat(r)});for(const y of e){const{data:m,width:v,height:E,glyphTop:S}=T.draw(y);h[y].width=v,h[y].layoutOffsetY=s*p_-S;const P=f.createImageData(v,E);IB(m,P),f.putImageData(P,h[y].x,h[y].y)}}else for(const T of e)f.fillText(T,h[T].x,h[T].y+o+s*p_);return{xOffset:p,yOffset:_,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}const kB=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,NB=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,FB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Hp extends Un{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:kB,fs:NB,modules:[ga,pa]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:Yi[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new qi(e,{...this.getShaders(),id:this.props.id,geometry:new ha({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}g(Hp,"defaultProps",FB);g(Hp,"layerName","TextBackgroundLayer");const v_={start:1,middle:0,end:-1},__={top:1,center:0,bottom:-1},nh=[0,0,0,255],DB=1,zB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:nh},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Kr.characterSet},fontFamily:Kr.fontFamily,fontWeight:Kr.fontWeight,lineHeight:DB,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:nh},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:nh},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class $p extends bu{constructor(...e){super(...e),g(this,"state",void 0),g(this,"getBoundingRect",(n,i)=>{let{size:[r,s]}=this.transformParagraph(n,i);const{fontSize:o}=this.state.fontAtlasManager.props;r/=o,s/=o;const{getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=v_[typeof a=="function"?a(n,i):a],u=__[typeof l=="function"?l(n,i):l];return[(c-1)*r/2,(u-1)*s/2,r,s]}),g(this,"getIconOffsets",(n,i)=>{const{getTextAnchor:r,getAlignmentBaseline:s}=this.props,{x:o,y:a,rowWidth:l,size:[c,u]}=this.transformParagraph(n,i),f=v_[typeof r=="function"?r(n,i):r],h=__[typeof s=="function"?s(n,i):s],d=o.length,p=new Array(d*2);let _=0;for(let T=0;T<d;T++){const y=(1-f)*(c-l[T])/2;p[_++]=(f-1)*c/2+y+o[T],p[_++]=(h-1)*u/2+a[T]}return p})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new OB},this.props.maxWidth>0&&Y.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:c,characterCount:u}=LB({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=u,s=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=Tu(n);o=[0],a=0;for(const f of c){u.index++;const h=Array.from(s(f,u)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,r=i.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return AB(c,a,o,l*i.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:_,getBorderColor:T,getBorderWidth:y,backgroundPadding:m,background:v,billboard:E,fontSettings:S,outlineWidth:P,outlineColor:L,sizeScale:C,sizeUnits:M,sizeMinPixels:I,sizeMaxPixels:k,transitions:W,updateTriggers:j}=this.props,H=this.getSubLayerClass("characters",Wp),et=this.getSubLayerClass("background",Hp);return[v&&new et({getFillColor:_,getLineColor:T,getLineWidth:y,padding:m,getPosition:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:C,sizeUnits:M,sizeMinPixels:I,sizeMaxPixels:k,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getSize:W.getSize,getFillColor:W.getBackgroundColor,getLineColor:W.getBorderColor,getLineWidth:W.getBorderWidth,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset,getBoundingRect:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new H({sdf:S.sdf,smoothing:Number.isFinite(S.smoothing)?S.smoothing:Kr.smoothing,outlineWidth:P/(S.radius||Kr.radius),outlineColor:L,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:C*r,sizeUnits:M,sizeMinPixels:I*r,sizeMaxPixels:k*r,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getColor:W.getColor,getSize:W.getSize,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:j.getText,getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset,getIconOffsets:{getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){RB(e)}}g($p,"defaultProps",zB);g($p,"layerName","TextLayer");const Ql={circle:{type:Up,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Pu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:$p,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Jl={type:Vp,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Xd={type:Gp,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function $s({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function ih(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function BB(t){if(Array.isArray(t))return t;switch(Y.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Y.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function x_(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){Y.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];w_(f,i,e,a,o)}}else w_(l,i,e,a,o)}return i}function w_(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!VB(s,o)){Y.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},i,r)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))})});break}}const UB={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function VB(t,e){let n=UB[t];for(Y.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function WT(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function xl(t){return t.geometry.coordinates}function jB(t,e){const n=WT(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=xl,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=xl,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=xl,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=xl,n}function GB(t,e){const n=WT(),{points:i,lines:r,polygons:s}=t,o=mB(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const WB=["points","linestrings","polygons"],HB={...$s(Ql.circle),...$s(Ql.icon),...$s(Ql.text),...$s(Jl),...$s(Xd),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class _a extends bu{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=GB(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=BB(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=x_(i,r,c);for(const f in l)o[f].push(dB({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=x_(i,r);const a=jB(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=WB.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Xd.type);if(s){const o=ih(this,Xd.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,Jl.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,Jl.type);if(o||a){const l=ih(this,Jl.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=Ql[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const f=ih(this,c.props);let h=n.points;if(a==="text"&&i){const{instancePickingColors:d,...p}=h.data.attributes;h={...h,data:{...h.data,attributes:p}}}o.push(new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=gB(s,o);return e(a,r)}}}g(_a,"layerName","GeoJsonLayer");g(_a,"defaultProps",HB);class $B{constructor(e){g(this,"index",void 0),g(this,"isVisible",void 0),g(this,"isSelected",void 0),g(this,"parent",void 0),g(this,"children",void 0),g(this,"content",void 0),g(this,"state",void 0),g(this,"layers",void 0),g(this,"id",void 0),g(this,"zoom",void 0),g(this,"userData",void 0),g(this,"boundingBox",void 0),g(this,"_abortController",void 0),g(this,"_loader",void 0),g(this,"_loaderId",void 0),g(this,"_isLoaded",void 0),g(this,"_isCancelled",void 0),g(this,"_needsReload",void 0),g(this,"_bbox",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:i,onError:r}){const{index:s,id:o,bbox:a,userData:l,zoom:c}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:f}=this._abortController,h=await n.scheduleRequest(this,_=>_.isSelected?1:-1);if(!h){this._isCancelled=!0;return}if(this._isCancelled){h.done();return}let d=null,p;try{d=await e({index:s,id:o,bbox:a,userData:l,zoom:c,signal:f})}catch(_){p=_||!0}finally{h.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?r(p,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}const je={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},E_=new B,YB=new B;class Yp{constructor(e=[0,0,0],n=[0,0,0],i){g(this,"center",void 0),g(this,"halfDiagonal",void 0),g(this,"minimum",void 0),g(this,"maximum",void 0),i=i||E_.copy(e).add(n).scale(.5),this.center=new B(i),this.halfDiagonal=new B(n).subtract(this.center),this.minimum=new B(e),this.maximum=new B(n)}clone(){return new Yp(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=YB.from(e.normal),r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-r>0?je.INSIDE:s+r<0?je.OUTSIDE:je.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=E_.from(e).subtract(this.center),{halfDiagonal:i}=this;let r=0,s;return s=Math.abs(n.x)-i.x,s>0&&(r+=s*s),s=Math.abs(n.y)-i.y,s>0&&(r+=s*s),s=Math.abs(n.z)-i.z,s>0&&(r+=s*s),r}}const Ys=new B,T_=new B;class Xp{constructor(e=[0,0,0],n=0){g(this,"center",void 0),g(this,"radius",void 0),this.radius=-0,this.center=new B,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Ys.from(n),this.center=new B().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Xp(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,s=e.radius,o=Ys.copy(r).subtract(n),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();const l=(i+a+s)*.5;return T_.copy(o).scale((-i+l)/a).add(n),this.center.copy(T_),this.radius=l,this}expand(e){const i=Ys.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=yR(Ys,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=Ys.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?je.OUTSIDE:s<i?je.INTERSECTING:je.INSIDE}}const XB=new B,ZB=new B,wl=new B,El=new B,Tl=new B,qB=new B,KB=new B,vn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Zp{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){g(this,"center",void 0),g(this,"halfAxes",void 0),this.center=new B().from(e),this.halfAxes=new Ne(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new B(e).len(),new B(n).len(),new B(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new B(e).normalize(),s=new B(n).normalize(),o=new B(i).normalize();return new Ky().fromMatrix3(new Ne([...r,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new Ky(i),s=new Ne().fromQuaternion(r);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new B().from(e),this.halfAxes=s,this}clone(){return new Zp(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Xp){const n=this.halfAxes,i=n.getColumn(0,wl),r=n.getColumn(1,El),s=n.getColumn(2,Tl),o=XB.copy(i).add(r).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,s=i.x,o=i.y,a=i.z,l=Math.abs(s*r[vn.COLUMN0ROW0]+o*r[vn.COLUMN0ROW1]+a*r[vn.COLUMN0ROW2])+Math.abs(s*r[vn.COLUMN1ROW0]+o*r[vn.COLUMN1ROW1]+a*r[vn.COLUMN1ROW2])+Math.abs(s*r[vn.COLUMN2ROW0]+o*r[vn.COLUMN2ROW1]+a*r[vn.COLUMN2ROW2]),c=i.dot(n)+e.distance;return c<=-l?je.OUTSIDE:c>=l?je.INSIDE:je.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=ZB.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,wl),s=i.getColumn(1,El),o=i.getColumn(2,Tl),a=r.magnitude(),l=s.magnitude(),c=o.magnitude();r.normalize(),s.normalize(),o.normalize();let u=0,f;return f=Math.abs(n.dot(r))-a,f>0&&(u+=f*f),f=Math.abs(n.dot(s))-l,f>0&&(u+=f*f),f=Math.abs(n.dot(o))-c,f>0&&(u+=f*f),u}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,wl),c=a.getColumn(1,El),u=a.getColumn(2,Tl),f=qB.copy(l).add(c).add(u).add(o),h=KB.copy(f).subtract(e);let d=n.dot(h);return r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).add(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).subtract(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).subtract(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).add(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).add(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).subtract(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).subtract(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),i[0]=r,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,wl);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,El);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Tl);return r.transformAsPoint(e),this.halfAxes=new Ne([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const b_=new B,S_=new B;class ps{constructor(e=[0,0,1],n=0){g(this,"normal",void 0),g(this,"distance",void 0),this.normal=new B,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Bo(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=b_.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),Bo(Ln(this.normal.len(),1)),this.distance=r,this}clone(){return new ps(this.normal,this.distance)}equals(e){return Ln(this.distance,e.distance)&&Ln(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=S_.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=b_.from(e);const i=this.getPointDistance(e),r=S_.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const P_=[new B([1,0,0]),new B([0,1,0]),new B([0,0,1])],A_=new B,QB=new B;new ps(new B(1,0,0),0);class Pn{constructor(e=[]){g(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*P_.length;const n=e.center,i=e.radius;let r=0;for(const s of P_){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new ps),a||(a=this.planes[r+1]=new ps);const l=A_.copy(s).scale(-i).add(n);-s.dot(l),o.fromPointNormal(l,s);const c=A_.copy(s).scale(i).add(n),u=QB.copy(s).negate();-u.dot(c),a.fromPointNormal(c,u),r+=2}return this}computeVisibility(e){let n=je.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case je.OUTSIDE:return je.OUTSIDE;case je.INTERSECTING:n=je.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Bo(Number.isFinite(n),"parentPlaneMask is required."),n===Pn.MASK_OUTSIDE||n===Pn.MASK_INSIDE)return n;let i=Pn.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=r[s],l=e.intersectPlane(a);if(l===je.OUTSIDE)return Pn.MASK_OUTSIDE;l===je.INTERSECTING&&(i|=o)}return i}}g(Pn,"MASK_OUTSIDE",4294967295);g(Pn,"MASK_INSIDE",0);g(Pn,"MASK_INDETERMINATE",2147483647);new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;new B;const on=new Ne,JB=new Ne,eU=new Ne,bl=new Ne,L_=new Ne;function tU(t,e={}){const n=RE.EPSILON20,i=10;let r=0,s=0;const o=JB,a=eU;o.identity(),a.copy(t);const l=n*nU(a);for(;s<i&&iU(a)>l;)rU(a,bl),L_.copy(bl).transpose(),a.multiplyRight(bl),a.multiplyLeft(L_),o.multiplyRight(bl),++r>2&&(++s,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function nU(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const Zd=[1,0,0],qd=[2,2,1];function iU(t){let e=0;for(let n=0;n<3;++n){const i=t[on.getElementIndex(qd[n],Zd[n])];e+=2*i*i}return Math.sqrt(e)}function rU(t,e){const n=RE.EPSILON15;let i=0,r=1;for(let c=0;c<3;++c){const u=Math.abs(t[on.getElementIndex(qd[c],Zd[c])]);u>i&&(r=c,i=u)}const s=Zd[r],o=qd[r];let a=1,l=0;if(Math.abs(t[on.getElementIndex(o,s)])>n){const c=t[on.getElementIndex(o,o)],u=t[on.getElementIndex(s,s)],f=t[on.getElementIndex(o,s)],h=(c-u)/2/f;let d;h<0?d=-1/(-h+Math.sqrt(1+h*h)):d=1/(h+Math.sqrt(1+h*h)),a=1/Math.sqrt(1+d*d),l=d*a}return Ne.IDENTITY.to(e),e[on.getElementIndex(s,s)]=e[on.getElementIndex(o,o)]=a,e[on.getElementIndex(o,s)]=l,e[on.getElementIndex(s,o)]=-l,e}const Xn=new B,sU=new B,oU=new B,aU=new B,lU=new B,cU=new Ne,uU={diagonal:new Ne,unitary:new Ne};function fU(t,e=new Zp){if(!t||t.length===0)return e.halfAxes=new Ne([0,0,0,0,0,0,0,0,0]),e.center=new B,e;const n=t.length,i=new B(0,0,0);for(const M of t)i.add(M);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const M of t){const I=Xn.copy(M).subtract(i);s+=I.x*I.x,o+=I.x*I.y,a+=I.x*I.z,l+=I.y*I.y,c+=I.y*I.z,u+=I.z*I.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const f=cU;f[0]=s,f[1]=o,f[2]=a,f[3]=o,f[4]=l,f[5]=c,f[6]=a,f[7]=c,f[8]=u;const{unitary:h}=tU(f,uU),d=e.halfAxes.copy(h);let p=d.getColumn(0,oU),_=d.getColumn(1,aU),T=d.getColumn(2,lU),y=-Number.MAX_VALUE,m=-Number.MAX_VALUE,v=-Number.MAX_VALUE,E=Number.MAX_VALUE,S=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const M of t)Xn.copy(M),y=Math.max(Xn.dot(p),y),m=Math.max(Xn.dot(_),m),v=Math.max(Xn.dot(T),v),E=Math.min(Xn.dot(p),E),S=Math.min(Xn.dot(_),S),P=Math.min(Xn.dot(T),P);p=p.multiplyByScalar(.5*(E+y)),_=_.multiplyByScalar(.5*(S+m)),T=T.multiplyByScalar(.5*(P+v)),e.center.copy(p).add(_).add(T);const L=sU.set(y-E,m-S,v-P).multiplyByScalar(.5),C=new Ne([L[0],0,0,0,L[1],0,0,0,L[2]]);return e.halfAxes.multiplyRight(C),e}const Ur=512,C_=3,HT=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],$T=HT.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),hU=$T.concat([[.25,.5],[.75,.5]]);class Vr{constructor(e,n,i){g(this,"x",void 0),g(this,"y",void 0),g(this,"z",void 0),g(this,"childVisible",void 0),g(this,"selected",void 0),g(this,"_children",void 0),this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new Vr(e,n,i),new Vr(e,n+1,i),new Vr(e+1,n,i),new Vr(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:r,minZ:s,maxZ:o,bounds:a,offset:l,project:c}=e,u=this.getBoundingVolume(r,l,c);if(a&&!this.insideBounds(a)||i.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:h}=this;if(h<o&&h>=s){const d=u.distanceTo(n.cameraPosition)*n.scale/n.height;h+=Math.floor(Math.log2(d))}if(h>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const h of this.children)h.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,i,r]){const s=Math.pow(2,this.z),o=Ur/s;return this.x*o<i&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,i){if(i){const l=this.z<1?hU:this.z<2?$T:HT,c=[];for(const u of l){const f=Qd(this.x+u[0],this.y+u[1],this.z);f[2]=e[0],c.push(i(f)),e[0]!==e[1]&&(f[2]=e[1],c.push(i(f)))}return fU(c)}const r=Math.pow(2,this.z),s=Ur/r,o=this.x*s+n*Ur,a=Ur-(this.y+1)*s;return new Yp([o,a,e[0]],[o+s,a+s,e[1]])}}function dU(t,e,n,i){const r=t instanceof LD&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:p})=>new ps(d.clone().negate(),p)),o=new Pn(s),a=t.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=t instanceof yi&&t.pitch<=60?e:0;if(i){const[d,p,_,T]=i,y=us([d,T]),m=us([_,p]);i=[y[0],Ur-y[1],m[0],Ur-m[1]]}const f=new Vr(0,0,0),h={viewport:t,project:r,cullingVolume:o,elevationBounds:[l,c],minZ:u,maxZ:e,bounds:i,offset:0};if(f.update(h),t instanceof yi&&t.subViewports&&t.subViewports.length>1){for(h.offset=-1;f.update(h)&&!(--h.offset<-C_););for(h.offset=1;f.update(h)&&!(++h.offset>C_););}return f.getSelected()}const Fn=512,gU=[-1/0,-1/0,1/0,1/0],YT={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function XT(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function pU(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function ZT(t,e){if(!t||!t.length)return null;const{index:n,id:i}=e;if(Array.isArray(t)){const s=pU(i)%t.length;t=t[s]}let r=t;for(const s of Object.keys(n)){const o=new RegExp("{".concat(s,"}"),"g");r=r.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function mU(t,e,n){let i;if(e&&e.length===2){const[r,s]=e,o=t.getBounds({z:r}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function yU({viewport:t,z:e=0,cullRect:n}){return(t.subViewports||[t]).map(r=>Kd(r,e,n))}function Kd(t,e,n){if(!Array.isArray(e)){const s=n.x-t.x,o=n.y-t.y,{width:a,height:l}=n,c={targetZ:e},u=t.unproject([s,o],c),f=t.unproject([s+a,o],c),h=t.unproject([s,o+l],c),d=t.unproject([s+a,o+l],c);return[Math.min(u[0],f[0],h[0],d[0]),Math.min(u[1],f[1],h[1],d[1]),Math.max(u[0],f[0],h[0],d[0]),Math.max(u[1],f[1],h[1],d[1])]}const i=Kd(t,e[0],n),r=Kd(t,e[1],n);return[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[2],r[2]),Math.max(i[3],r[3])]}function vU(t,e,n){return n?XT(t,n).map(r=>r*e/Fn):t.map(i=>i*e/Fn)}function qp(t,e){return Math.pow(2,t)*Fn/e}function Qd(t,e,n){const i=qp(n,Fn),r=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function M_(t,e,n,i){const r=qp(n,i);return[t/r*Fn,e/r*Fn]}function _U(t,e,n,i,r=Fn){if(t.isGeospatial){const[c,u]=Qd(e,n,i),[f,h]=Qd(e+1,n+1,i);return{west:c,north:u,east:f,south:h}}const[s,o]=M_(e,n,i,r),[a,l]=M_(e+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function xU(t,e,n,i,r){const s=mU(t,null,i),o=qp(e,n),[a,l,c,u]=vU(s,o,r),f=[];for(let h=Math.floor(a);h<c;h++)for(let d=Math.floor(l);d<u;d++)f.push({x:h,y:d,z:e});return f}function wU({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:s=Fn,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let c=t.isGeospatial?Math.round(t.zoom+Math.log2(Fn/s))+l:Math.ceil(t.zoom)+l;if(typeof n=="number"&&Number.isFinite(n)&&c<n){if(!r)return[];c=n}typeof e=="number"&&Number.isFinite(e)&&c>e&&(c=e);let u=r;return o&&a&&r&&!t.isGeospatial&&(u=XT(r,o)),t.isGeospatial?dU(t,c,i,r):xU(t,c,s,u||gU,a)}function EU(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function TU(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function bU(t){let e={},n;return i=>{for(const r in i)if(!SU(i[r],e[r])){n=t(i),e=i;break}return n}}function SU(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}const I_=1,Mu=2,PU="never",AU="no-overlap",Kp="best-available",LU=5,CU={[Kp]:RU,[AU]:OU,[PU]:()=>{}},MU={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class IU{constructor(e){g(this,"opts",void 0),g(this,"_requestScheduler",void 0),g(this,"_cache",void 0),g(this,"_dirty",void 0),g(this,"_tiles",void 0),g(this,"_cacheByteSize",void 0),g(this,"_viewport",void 0),g(this,"_zRange",void 0),g(this,"_selectedTiles",void 0),g(this,"_frameNumber",void 0),g(this,"_modelMatrix",void 0),g(this,"_modelMatrixInverse",void 0),g(this,"_maxZoom",void 0),g(this,"_minZoom",void 0),g(this,"onTileLoad",void 0),g(this,"_getCullBounds",bU(yU)),this.opts={...MU,...e},this.onTileLoad=n=>{var i,r;(i=(r=this.opts).onTileLoad)===null||i===void 0||i.call(r,n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new zA({maxRequests:e.maxRequests,throttleRequests:!!(e.maxRequests&&e.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ke,this._modelMatrixInverse=new Ke,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:i}={}){const r=new Ke(i),s=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Ln(this._zRange,n)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:r}=e;for(const[s,o,a,l]of i){let c;if("west"in r)c=r.west<a&&r.east>s&&r.south<l&&r.north>o;else{const u=Math.min(r.top,r.bottom),f=Math.max(r.top,r.bottom);c=r.left<a&&r.right>s&&u<l&&f>o}if(c)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:i,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:l,zoomOffset:c}=this.opts;return wU({viewport:e,maxZoom:n,minZoom:i,zRange:r,tileSize:a,extent:l,modelMatrix:s,modelMatrixInverse:o,zoomOffset:c})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:_U(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),i=Math.floor(e.y/2),r=e.z-1;return{x:n,y:i,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||Kp,n=new Array(this._cache.size);let i=0;for(const r of this._cache.values())n[i++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:CU[e])(Array.from(this._cache.values())),i=0;for(const r of this._cache.values())if(n[i++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let i=0;for(const r of this._cache.values())r.isLoading&&(i++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&i>e&&n.length>0;)n.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const i=this._getNearestAncestor(n);n.parent=i,i!=null&&i.children&&i.children.push(n)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:LU*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(const[l,c]of e){if(!c.isVisible&&!c.isSelected){var o,a;this._cacheByteSize-=n.maxCacheByteSize?c.byteLength:0,e.delete(l),(o=(a=this.opts).onTileUnload)===null||o===void 0||o.call(a,c)}if(e.size<=i&&this._cacheByteSize<=r)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,c)=>l.zoom-c.zoom),this._dirty=!1)}_getTile(e,n){const i=this.getTileId(e);let r=this._cache.get(i),s=!1;return!r&&n?(r=new $B(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let i=e.index;for(;this.getTileZoom(i)>n;){i=this.getParentIndex(i);const r=this._getTile(i);if(r)return r}return null}}function RU(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!qT(e)&&Qp(e);for(const e of t)e.isVisible=!!(e.state&Mu)}function OU(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&qT(n);const e=Array.from(t).sort((n,i)=>n.zoom-i.zoom);for(const n of e)if(n.isVisible=!!(n.state&Mu),n.children&&(n.isVisible||n.state&I_))for(const i of n.children)i.state=I_;else n.isSelected&&Qp(n)}function qT(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Mu,!0;e=e.parent}return!1}function Qp(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Mu:Qp(e)}const kU={TilesetClass:IU,data:{type:"data",value:[]},dataComparator:YT.equal,renderSubLayers:{type:"function",value:t=>new _a(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Kp,zRange:null,maxRequests:6,zoomOffset:0};class Jp extends bu{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var e,n,i;return(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||(i=n.selectedTiles)===null||i===void 0?void 0:i.every(r=>r.isLoaded&&r.layers&&r.layers.every(s=>s.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():this.state.tileset.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:l,zoomOffset:c}=this.props;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:s,maxRequests:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==r;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:r}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?ZT(n,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:n}){const i=n.props.tile;return e.picked&&(e.tile=i),e.sourceTile=i,e}_updateAutoHighlight(e){const n=e.sourceTile;if(n&&n.layers)for(const i of n.layers)i.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=xu(i,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,n)}}g(Jp,"defaultProps",kU);g(Jp,"layerName","TileLayer");const NU={clipBounds:[0,0,1,1],clipByInstance:void 0},KT=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,FU={name:"clip-vs",vs:KT},DU={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},zU={name:"clip-fs",fs:KT},BU={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class em extends Np{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[FU],inject:DU}:{modules:[zU],inject:BU}}draw({uniforms:e}){const{clipBounds:n}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const i=this.projectPosition([n[0],n[1],0]),r=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[0],r[0]),Math.max(i[1],r[1])]}}}g(em,"defaultProps",NU);g(em,"extensionName","ClipExtension");function UU(t,e,n){const i=VU(t),r=Object.keys(i).filter(s=>i[s]!==Array);return jU(t,{propArrayTypes:i,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function VU(t){const e={};for(const n of t)if(n.properties)for(const i in n.properties){const r=n.properties[i];e[i]=XU(r,e[i])}return e}function jU(t,e,n){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:l,polygonObjectsCount:c,polygonRingsCount:u,polygonFeaturesCount:f,propArrayTypes:h,coordLength:d}=e,{numericPropKeys:p=[],PositionDataType:_=Float32Array,triangulate:T=!0}=n,y=t[0]&&"id"in t[0],m=t.length>65535?Uint32Array:Uint16Array,v={type:"Point",positions:new _(i*d),globalFeatureIds:new m(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},E={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new _(s*d),globalFeatureIds:new m(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},S={type:"Polygon",polygonIndices:l>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:l>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new _(l*d),globalFeatureIds:new m(l),featureIds:f>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};T&&(S.triangles=[]);for(const L of[v,E,S])for(const C of p){const M=h[C];L.numericProps[C]=new M(L.positions.length/d)}E.pathIndices[o]=s,S.polygonIndices[c]=l,S.primitivePolygonIndices[u]=l;const P={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const L of t){const C=L.geometry,M=L.properties||{};switch(C.type){case"Point":GU(C,v,P,d,M),v.properties.push(sh(M,p)),y&&v.fields.push({id:L.id}),P.pointFeature++;break;case"LineString":WU(C,E,P,d,M),E.properties.push(sh(M,p)),y&&E.fields.push({id:L.id}),P.lineFeature++;break;case"Polygon":HU(C,S,P,d,M),S.properties.push(sh(M,p)),y&&S.fields.push({id:L.id}),P.polygonFeature++;break;default:throw new Error("Invalid geometry type")}P.feature++}return YU(v,E,S,d)}function GU(t,e,n,i,r){e.positions.set(t.data,n.pointPosition*i);const s=t.data.length/i;tm(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function WU(t,e,n,i,r){e.positions.set(t.data,n.linePosition*i);const s=t.data.length/i;tm(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=t.indices[o],c=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(c-l)/i}}function HU(t,e,n,i,r){e.positions.set(t.data,n.polygonPosition*i);const s=t.data.length/i;tm(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=n.polygonPosition;e.polygonIndices[n.polygonObject++]=l;const c=t.areas[o],u=t.indices[o],f=t.indices[o+1];for(let d=0,p=u.length;d<p;++d){const _=u[d],T=d===p-1?f===void 0?t.data.length:f[0]:u[d+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(T-_)/i}const h=n.polygonPosition;$U(e,c,u,{startPosition:l,endPosition:h,coordLength:i})}}function $U(t,e,n,i){let{startPosition:r,endPosition:s,coordLength:o}=i;if(!t.triangles)return;const a=r*o,l=s*o,c=t.positions.subarray(a,l),u=n[0],f=n.slice(1).map(d=>(d-u)/o),h=a4(c,f,o,e);for(let d=0,p=h.length;d<p;++d)t.triangles.push(r+h[d])}function rh(t,e){const n={};for(const i in t)n[i]={value:t[i],size:e};return n}function YU(t,e,n,i){const r={points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:rh(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:rh(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:i},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:rh(n.numericProps,1)}};return n.triangles&&(r.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),r}function tm(t,e,n,i){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+i)}}function sh(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function XU(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function R_(t,e){const n=e==null?void 0:e.globalFeatureId;return n!==void 0?ZU(t,n):qU(t,e==null?void 0:e.type)}function ZU(t,e){const n=QT(t);for(const i of n){let r=0,s=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){const a=i.featureIds.value[o];if(a!==s){if(e===i.globalFeatureIds.value[r])return Zc(i,r,o);r=o,s=a}}if(e===i.globalFeatureIds.value[r])return Zc(i,r,i.featureIds.value.length)}throw new Error("featureId:".concat(e," not found"))}function qU(t,e){const n=QT(t,e);return QU(n)}function KU(t,e,n){switch(t.type){case"Point":return n6(t,e,n);case"LineString":return t6(t,e,n);case"Polygon":return JT(t,e,n);default:const i=t;throw new Error("Unsupported geometry type: ".concat(i==null?void 0:i.type))}}function QT(t,e){if(!!!(t.points||t.lines||t.polygons))return t.type=e||i6(t),[t];const i=[];return t.points&&(t.points.type="Point",i.push(t.points)),t.lines&&(t.lines.type="LineString",i.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",i.push(t.polygons)),i}function QU(t){const e=[];for(const n of t){if(n.featureIds.value.length===0)continue;let i=0,r=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const o=n.featureIds.value[s];o!==r&&(e.push(Zc(n,i,s)),i=s,r=o)}e.push(Zc(n,i,n.featureIds.value.length))}return e}function Zc(t,e,n){const i=KU(t,e,n),r=e6(t,e,n),s=JU(t,e,n);return{type:"Feature",geometry:i,properties:r,...s}}function JU(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.fields&&t.fields[t.featureIds.value[e]]}function e6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const i in t.numericProps)n[i]=t.numericProps[i].value[e];return n}function JT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:i}=t,r=t.polygonIndices.value.filter(l=>l>=e&&l<=n),s=t.primitivePolygonIndices.value.filter(l=>l>=e&&l<=n);if(!(r.length>2)){const l=[];for(let c=0;c<s.length-1;c++){const u=s[c],f=s[c+1],h=qc(i,u,f);l.push(h)}return{type:"Polygon",coordinates:l}}const a=[];for(let l=0;l<r.length-1;l++){const c=r[l],u=r[l+1],f=JT(t,c,u).coordinates;a.push(f)}return{type:"MultiPolygon",coordinates:a}}function t6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:i}=t,r=t.pathIndices.value.filter(a=>a>=e&&a<=n);if(!(r.length>2))return{type:"LineString",coordinates:qc(i,r[0],r[1])};const o=[];for(let a=0;a<r.length-1;a++){const l=qc(i,r[a],r[a+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function n6(t,e,n){const{positions:i}=t,r=qc(i,e,n);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function qc(t,e,n){e=e||0,n=n||t.value.length/t.size;const i=[];for(let r=e;r<n;r++){const s=Array();for(let o=r*t.size;o<(r+1)*t.size;o++)s.push(Number(t.value[o]));i.push(s)}return i}function i6(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var nm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */nm.read=function(t,e,n,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,c=l>>1,u=-7,f=n?r-1:0,h=n?-1:1,d=t[e+f];for(f+=h,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+t[e+f],f+=h,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-c}return(d?-1:1)*o*Math.pow(2,s-i)};nm.write=function(t,e,n,i,r,s){var o,a,l,c=s*8-r-1,u=(1<<c)-1,f=u>>1,h=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,p=i?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?e+=h/l:e+=h*Math.pow(2,1-f),e*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*l-1)*Math.pow(2,r),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;t[n+d]=a&255,d+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[n+d]=o&255,d+=p,o/=256,c-=8);t[n+d-p]|=_*128};var r6=ee,Sl=nm;function ee(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ee.Varint=0;ee.Fixed64=1;ee.Bytes=2;ee.Fixed32=5;var Jd=65536*65536,O_=1/Jd,s6=12,eb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");ee.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Pl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=N_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Pl(this.buf,this.pos)+Pl(this.buf,this.pos+4)*Jd;return this.pos+=8,t},readSFixed64:function(){var t=Pl(this.buf,this.pos)+N_(this.buf,this.pos+4)*Jd;return this.pos+=8,t},readFloat:function(){var t=Sl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Sl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,i;return i=e[this.pos++],n=i&127,i<128||(i=e[this.pos++],n|=(i&127)<<7,i<128)||(i=e[this.pos++],n|=(i&127)<<14,i<128)||(i=e[this.pos++],n|=(i&127)<<21,i<128)?n:(i=e[this.pos],n|=(i&15)<<28,o6(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=s6&&eb?x6(this.buf,e,t):_6(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ee.Bytes)return t.push(this.readVarint(e));var n=_n(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ee.Bytes)return t.push(this.readSVarint());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ee.Bytes)return t.push(this.readBoolean());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ee.Bytes)return t.push(this.readFloat());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ee.Bytes)return t.push(this.readDouble());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ee.Bytes)return t.push(this.readFixed32());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ee.Bytes)return t.push(this.readSFixed32());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ee.Bytes)return t.push(this.readFixed64());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ee.Bytes)return t.push(this.readSFixed64());var e=_n(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===ee.Varint)for(;this.buf[this.pos++]>127;);else if(e===ee.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ee.Fixed32)this.pos+=4;else if(e===ee.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xr(this.buf,t&-1,this.pos),xr(this.buf,Math.floor(t*O_),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xr(this.buf,t&-1,this.pos),xr(this.buf,Math.floor(t*O_),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){a6(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=w6(this.buf,t,this.pos);var n=this.pos-e;n>=128&&k_(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Sl.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Sl.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&k_(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,ee.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,u6,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,f6,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,g6,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,h6,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d6,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,p6,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,m6,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,y6,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,v6,e)},writeBytesField:function(t,e){this.writeTag(t,ee.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ee.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ee.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ee.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ee.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ee.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ee.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ee.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ee.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ee.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function o6(t,e,n){var i=n.buf,r,s;if(s=i[n.pos++],r=(s&112)>>4,s<128||(s=i[n.pos++],r|=(s&127)<<3,s<128)||(s=i[n.pos++],r|=(s&127)<<10,s<128)||(s=i[n.pos++],r|=(s&127)<<17,s<128)||(s=i[n.pos++],r|=(s&127)<<24,s<128)||(s=i[n.pos++],r|=(s&1)<<31,s<128))return _r(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function _n(t){return t.type===ee.Bytes?t.readVarint()+t.pos:t.pos+1}function _r(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function a6(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),l6(n,i,e),c6(i,e)}function l6(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function c6(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function k_(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function u6(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function f6(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function h6(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function d6(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function g6(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function p6(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function m6(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function y6(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function v6(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Pl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function xr(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function N_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function _6(t,e,n){for(var i="",r=e;r<n;){var s=t[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>n)break;var l,c,u;a===1?s<128&&(o=s):a===2?(l=t[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[r+1],c=t[r+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[r+1],c=t[r+2],u=t[r+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function x6(t,e,n){return eb.decode(t.subarray(e,n))}function w6(t,e,n){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=r;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=r&63|128)}return n}const tb=Jc(r6);function E6(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let s=0;s<e;s++){const o=T6(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&n.push(i),n}function T6(t){let e=0;for(let n=0,i=t.length-1,r,s;n<t.length;i=n++)r=t[n],s=t[i],e+=(s[0]-r[0])*(r[1]+s[1]);return e}function b6(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?S6(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function S6(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let P6=class nb{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,n,i,r,s){g(this,"properties",void 0),g(this,"extent",void 0),g(this,"type",void 0),g(this,"id",void 0),g(this,"_pbf",void 0),g(this,"_geometry",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,e.readFields(b6,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0;const a=[];let l;for(;e.pos<n;){if(r<=0){const c=e.readVarint();i=c&7,r=c>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(l&&a.push(l),l=[]),l&&l.push([s,o]);else if(i===7)l&&l.push(l[0].slice());else throw new Error("unknown command ".concat(i))}return l&&a.push(l),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0,a=1/0,l=-1/0,c=1/0,u=-1/0;for(;e.pos<n;){if(r<=0){const f=e.readVarint();i=f&7,r=f>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>l&&(l=s),o<c&&(c=o),o>u&&(u=o);else if(i!==7)throw new Error("unknown command ".concat(i))}return[a,c,l,u]}_toGeoJSON(e){let n=this.loadGeometry(),i=nb.types[this.type],r,s;switch(this.type){case 1:const a=[];for(r=0;r<n.length;r++)a[r]=n[r][0];n=a,e(n,this);break;case 2:for(r=0;r<n.length;r++)e(n[r],this);break;case 3:for(n=E6(n),r=0;r<n.length;r++)for(s=0;s<n[r].length;s++)e(n[r][s],this);break}n.length===1?n=n[0]:i="Multi".concat(i);const o={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;function l(c){for(let u=0;u<c.length;u++){const f=c[u];f[0]=(f[0]+o)*360/s-180;const h=180-(f[1]+a)*360/s;f[1]=360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90}}return this._toGeoJSON(l)}},A6=class{constructor(e,n){g(this,"version",void 0),g(this,"name",void 0),g(this,"extent",void 0),g(this,"length",void 0),g(this,"_pbf",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(L6,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new P6(this._pbf,n,this.extent,this._keys,this._values)}};function L6(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(C6(n)))}function C6(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}let M6=class{constructor(e,n){g(this,"layers",void 0),this.layers=e.readFields(I6,{},n)}};function I6(t,e,n){if(t===3&&n){const i=new A6(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function R6(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[$c(t.data)]],indices:[t.indices]};const i=[],r=[];let s=[],o=[],a,l=0;for(let c,u=0,f;u<e;u++){f=t.indices[u]-l,c=t.indices[u+1]-l||t.data.length;const h=t.data.slice(f,c),d=$c(h);if(d===0){const p=t.data.slice(0,f),_=t.data.slice(c);t.data=p.concat(_),l+=c-f;continue}a===void 0&&(a=d<0),a===d<0?(o.length&&(i.push(s),r.push(o)),o=[f],s=[d]):(s.push(d),o.push(f))}return s&&i.push(s),o.length&&r.push(o),{type:n,areas:i,indices:r,data:t.data}}function O6(t,e,n,i){for(let r=0,s=t.length;r<s;r+=2){t[r]=(t[r]+e)*360/i-180;const o=180-(t[r+1]+n)*360/i;t[r+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function k6(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?N6(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function N6(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let F_,Li,oh,Al,ah,lh,Xs;class F6{constructor(e,n,i,r,s,o){g(this,"properties",void 0),g(this,"extent",void 0),g(this,"type",void 0),g(this,"id",void 0),g(this,"_pbf",void 0),g(this,"_geometry",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_geometryInfo",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,this._geometryInfo=o,e.readFields(k6,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,F_=e.readVarint()+e.pos,Li=1,Al=0,ah=0,lh=0,Xs=0;const n=[],i=[];for(;e.pos<F_;)if(Al<=0&&(oh=e.readVarint(),Li=oh&7,Al=oh>>3),Al--,Li===1||Li===2)ah+=e.readSVarint(),lh+=e.readSVarint(),Li===1&&n.push(Xs),i.push(ah,lh),Xs+=2;else if(Li===7){if(Xs>0){const r=n[n.length-1];i.push(i[r],i[r+1]),Xs+=2}}else throw new Error("unknown command ".concat(Li));return{data:i,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let i;e(n.data,this);const r=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/r,i={type:"LineString",...n};break;case 3:i=R6(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/r;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;return this._toBinaryCoordinates(l=>O6(l,o,a,s))}}class D6{constructor(e,n){g(this,"version",void 0),g(this,"name",void 0),g(this,"extent",void 0),g(this,"length",void 0),g(this,"_pbf",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(z6,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new F6(this._pbf,i,this.extent,this._keys,this._values,n)}}function z6(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(B6(n)))}function B6(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class U6{constructor(e,n){g(this,"layers",void 0),this.layers=e.readFields(V6,{},n)}}function V6(t,e,n){if(t===3&&n){const i=new D6(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function D_(t,e){var n,i;const r=G6(e),s=(e==null||(n=e.gis)===null||n===void 0?void 0:n.format)||(e==null||(i=e.mvt)===null||i===void 0?void 0:i.shape);switch(s){case"columnar-table":return{shape:"columnar-table",data:ch(t,r)};case"geojson-row-table":return{shape:"geojson-row-table",data:z_(t,r)};case"geojson":return z_(t,r);case"binary-geometry":return ch(t,r);case"binary":return ch(t,r);default:throw new Error(s)}}function ch(t,e){const[n,i]=j6(t,e),r=UU(n,i);return r.byteLength=t.byteLength,r}function j6(t,e){const n=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,i];const r=new U6(new tb(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(a)for(let l=0;l<a.length;l++){const c=a.feature(l,i),u=H6(c,e,o);n.push(u)}}),[n,i]}function z_(t,e){if(t.byteLength<=0)return[];const n=[],i=new M6(new tb(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{const o=i.layers[s];if(o)for(let a=0;a<o.length;a++){const l=o.feature(a),c=W6(l,e,s);n.push(c)}}),n}function G6(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const n=((e=t.mvt)===null||e===void 0?void 0:e.coordinates)==="wgs84",{tileIndex:i}=t.mvt,r=i&&Number.isFinite(i.x)&&Number.isFinite(i.y)&&Number.isFinite(i.z);if(n&&!r)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function W6(t,e,n){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:$6);return e.layerProperty&&(i.properties[e.layerProperty]=n),i}function H6(t,e,n){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:Y6);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=n),i}function $6(t,e){const{extent:n}=e;for(let i=0;i<t.length;i++){const r=t[i];r[0]/=n,r[1]/=n}}function Y6(t,e){const{extent:n}=e;for(let i=0,r=t.length;i<r;++i)t[i]/=n}const X6="3.4.14",Z6={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},ib={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:X6,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:Z6};({...ib});const q6={Point:rb,MultiPoint:K6,LineString:sb,MultiLineString:Q6,Polygon:ob,MultiPolygon:J6};function rb([t,e],[n,i],r){const s=ls(n[0],i[0],t),o=ls(n[1],i[1],e);return r.unprojectFlat([s,o])}function im(t,e,n){return t.map(i=>rb(i,e,n))}function K6(t,e,n){return im(t,e,n)}function sb(t,e,n){return im(t,e,n)}function Q6(t,e,n){return t.map(i=>sb(i,e,n))}function ob(t,e,n){return t.map(i=>im(i,e,n))}function J6(t,e,n){return t.map(i=>ob(i,e,n))}function eV(t,e,n){const i=n.projectFlat([e.west,e.north]),r=n.projectFlat([e.east,e.south]),s=[i,r];return{...t,coordinates:q6[t.type](t.coordinates,s,n)}}const tV=["points","lines","polygons"];function nV(t,e,n,i){for(const r of tV){const s=t[r]&&iV(t[r],e,n,i);if(s>=0)return s}return-1}function iV(t,e,n,i){const r=t.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(i){const l=rV(t,i);if(l)s=l[0],o=l[1]+1;else return-1}let a=-1;if(e in t.numericProps){const l=t.numericProps[e].value.findIndex((c,u)=>c===n&&r[u]>=s&&r[u]<o);return l>=0?t.globalFeatureIds.value[l]:-1}else e?a=B_(t.properties,l=>l[e]===n,s,o):t.fields&&(a=B_(t.fields,l=>l.id===n,s,o));return a>=0?sV(t,a):-1}function rV(t,e){if(!t.__layers){const n={},{properties:i}=t;for(let r=0;r<i.length;r++){const{layerName:s}=i[r];s&&(n[s]?n[s][1]=r:n[s]=[r,r])}t.__layers=n}return t.__layers[e]}function sV(t,e){if(!t.__ids){const n=[],i=t.featureIds.value,r=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)n[i[s]]=r[s];t.__ids=n}return t.__ids[e]}function B_(t,e,n,i){for(let r=n;r<i;r++)if(e(t[r],r))return r;return-1}const uh=512,oV={..._a.defaultProps,data:YT,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[ib],binary:!0};class rm extends Jp{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:e,oldProps:n,context:i,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!==null&&s!==void 0&&s.data&&(super.updateState({props:e,oldProps:n,context:i,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==n.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,n=null;if(typeof e=="string"&&!EU(e)){const{onDataLoad:i,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{n=await r(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(n,{propName:"data",layer:this})}else e.tilejson&&(n=e);n&&(e=n.tiles),this.setState({data:e,tileJSON:n})}_getTilesetOptions(){const e=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:i,maxZoom:r}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>i&&(e.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(r)||n.maxzoom<r)&&(e.maxZoom=n.maxzoom)),e}renderLayers(){var e;return(e=this.state)!==null&&e!==void 0&&e.data?super.renderLayers():null}getTileData(e){var n;const{data:i,binary:r}=this.state,{index:s,signal:o}=e,a=ZT(i,e);if(!a)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:c}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...(n=l)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:r?{format:"binary"}:{}},c(a,{propName:"data",layer:this,loadOptions:l,signal:o})}renderSubLayers(e){const{x:n,y:i,z:r}=e.tile.index,s=Math.pow(2,r),o=uh/s,a=-o,l=uh*n/s,c=uh*(1-i/s),u=new Ke().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=u,e.coordinateOrigin=[l,c,0],e.coordinateSystem=Q.CARTESIAN,e.extensions=[...e.extensions||[],new em]);const f=super.renderSubLayers(e);return this.state.binary&&!(f instanceof _a)&&Y.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),f}_updateAutoHighlight(e){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:r}=this.state,s=e.object;let o,a;s&&(o=fh(s,n),a=U_(s));let{highlightColor:l}=this.props;typeof l=="function"&&(l=l(e)),(i!==o||r!==a)&&this.setState({highlightColor:l,hoveredFeatureId:o,hoveredFeatureLayerName:a})}getPickingInfo(e){const n=super.getPickingInfo(e),i=!!this.context.viewport.resolution;if(this.state.binary&&n.index!==-1){const{data:r}=e.sourceLayer.props;n.object=R_(r,{globalFeatureId:n.index})}return n.object&&!i&&(n.object=j_(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n,hoveredFeatureLayerName:i,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,a=e.content,l=V_(o);if(!(V_(n)||l))return-1;const u=l?o:n;return Array.isArray(a)?a.findIndex(f=>{const h=fh(f,s)===u,d=l||U_(f)===i;return h&&d}):a&&r?nV(a,s,u,l?"":i):-1}_pickObjects(e){const{deck:n,viewport:i}=this.context,r=i.width,s=i.height,o=i.x,a=i.y,l=[this.id];return n.pickObjects({x:o,y:a,width:r,height:s,layerIds:l,maxObjects:e})}getRenderedFeatures(e=null){const n=this._pickObjects(e),i=new Set,r=[];for(const s of n){const o=fh(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):i.has(o)||(i.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:r}=i;if(i._contentWGS84===void 0&&TU(r)){const s=this.state.binary?R_(i.content):i.content;i._contentWGS84=s.map(o=>j_(o,r,this.context.viewport))}return i._contentWGS84}})})}}g(rm,"layerName","MVTLayer");g(rm,"defaultProps",oV);function fh(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function U_(t){var e;return((e=t.properties)===null||e===void 0?void 0:e.layerName)||null}function V_(t){return t!=null&&t!==""}function j_(t,e,n){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>eV(t.geometry,e,n).coordinates}),i}const aV="modulepreload",lV=function(t){return"/nak-data-deck-gl/"+t},G_={},cV=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=lV(s),s in G_)return;G_[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":aV,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},uV=N.createContext(null);function fV(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function Tn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Tn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!Tn(t[r],e[r]))return!1;return!0}return!1}function hV(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function W_(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Tn(n,i)||e.setProjection(n)}function H_(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function $_(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const dV=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Y_(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const s=e[i.ref];if(s){r=r||Object.assign({},i),delete r.ref;for(const o of dV)o in s&&(r[o]=s[o])}return r||i});return{...t,layers:n}}const X_={version:8,sources:{},layers:[]},Z_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},hh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},q_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},gV=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],pV=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ms{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[q_[r.type]];s?s(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[Z_[r.type]];s&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),s(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[hh[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=ms.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n;const o=r._resizeObserver;o&&(o.disconnect(),o.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:a}=e;return a&&(a.bounds?r.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):i._updateViewState(a,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=X_}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||mV()||null,container:e,style:Y_(i)},s=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(r);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),W_(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in Z_)o.on(u,this._onPointerEvent);for(const u in hh)o.on(u,this._onCameraEvent);for(const u in q_)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),ms.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=hV(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,l=i.isMoving();l&&(r.cameraElevationReference="sea");const c=$_(r,{...H_(i.transform),...e});if(l&&(r.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==r.zoom),u.rotate||(u.rotate=a!==r.bearing),u.pitch||(u.pitch=o!==r.pitch)}return l||$_(i.transform,e),c}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of gV)if(s in e&&!Tn(e[s],n[s])){r=!0;const o=i[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(i,e[s])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=X_,styleDiffing:r=!0}=e,s={diff:r};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Y_(i),s),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Tn(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Tn(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Tn(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const s=this._map;let o=!1;for(const a of pV){const l=(i=e[a])!==null&&i!==void 0?i:!0,c=(r=n[a])!==null&&r!==void 0?r:!0;Tn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in hh&&(typeof n=="object"&&(n.viewState=H_(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{W_(this._renderTransform,n),e.transform=n}}}ms.savedMaps=[];function mV(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const yV=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function vV(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const s=e.project(i);return e.transform=r,s},unproject:i=>{const r=e.transform;e.transform=t.transform;const s=e.unproject(i);return e.transform=r,s},queryTerrainElevation:(i,r)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(i,r);return e.transform=s,o},queryRenderedFeatures:(i,r)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(i,r);return e.transform=s,o}};for(const i of _V(e))!(i in n)&&!yV.includes(i)&&(n[i]=e[i].bind(e));return n}function _V(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const xV=typeof document<"u"?N.useLayoutEffect:N.useEffect,wV=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function EV(t,e){for(const i of wV)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!1)}const Iu=N.createContext(null);function TV(t,e,n){const i=N.useContext(uV),[r,s]=N.useState(null),o=N.useRef(),{current:a}=N.useRef({mapLib:null,map:null});N.useEffect(()=>{const u=t.mapLib;let f=!0,h;return Promise.resolve(u||n).then(d=>{if(!f)return;if(!d)throw new Error("Invalid mapLib");const p="Map"in d?d:d.default;if(!p.Map)throw new Error("Invalid mapLib");if(EV(p,t),!p.supported||p.supported(t))t.reuseMaps&&(h=ms.reuse(t,o.current)),h||(h=new ms(p.Map,t,o.current)),a.map=vV(h),a.mapLib=p,s(h),i==null||i.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(d=>{const{onError:p}=t;p?p({type:"error",target:null,originalEvent:null,error:d}):console.error(d)}),()=>{f=!1,h&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?h.recycle():h.destroy())}},[]),xV(()=>{r&&r.setProps(t)}),N.useImperativeHandle(e,()=>a.map,[r]);const l=N.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return N.createElement("div",{id:t.id,ref:o,style:l},r&&N.createElement(Iu.Provider,{value:a},N.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const bV=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ar(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!bV.test(i)?n[i]=`${r}px`:n[i]=r}}function SV(t,e){const{map:n,mapLib:i}=N.useContext(Iu),r=N.useRef({props:t});r.current.props=t;const s=N.useMemo(()=>{let _=!1;N.Children.forEach(t.children,m=>{m&&(_=!0)});const T={...t,element:_?document.createElement("div"):null},y=new i.Marker(T);return y.setLngLat([t.longitude,t.latitude]),y.getElement().addEventListener("click",m=>{var v,E;(E=(v=r.current.props).onClick)===null||E===void 0||E.call(v,{type:"click",target:y,originalEvent:m})}),y.on("dragstart",m=>{var v,E;const S=m;S.lngLat=s.getLngLat(),(E=(v=r.current.props).onDragStart)===null||E===void 0||E.call(v,S)}),y.on("drag",m=>{var v,E;const S=m;S.lngLat=s.getLngLat(),(E=(v=r.current.props).onDrag)===null||E===void 0||E.call(v,S)}),y.on("dragend",m=>{var v,E;const S=m;S.lngLat=s.getLngLat(),(E=(v=r.current.props).onDragEnd)===null||E===void 0||E.call(v,S)}),y},[]);N.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:f=null,rotation:h=0,rotationAlignment:d="auto",pitchAlignment:p="auto"}=t;return N.useEffect(()=>{ar(s.getElement(),c)},[c]),N.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!fV(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==h&&s.setRotation(h),s.getRotationAlignment()!==d&&s.setRotationAlignment(d),s.getPitchAlignment()!==p&&s.setPitchAlignment(p),s.getPopup()!==f&&s.setPopup(f),ep.createPortal(t.children,s.getElement())}N.memo(N.forwardRef(SV));function K_(t){return new Set(t?t.trim().split(/\s+/):[])}function PV(t,e){const{map:n,mapLib:i}=N.useContext(Iu),r=N.useMemo(()=>document.createElement("div"),[]),s=N.useRef({props:t});s.current.props=t;const o=N.useMemo(()=>{const a={...t},l=new i.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,f;(f=(u=s.current.props).onOpen)===null||f===void 0||f.call(u,c)}),l},[]);if(N.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(r).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),N.useEffect(()=>{ar(o.getElement(),t.style)},[t.style]),N.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!Tn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=K_(o.options.className),l=K_(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return ep.createPortal(t.children,r)}N.memo(N.forwardRef(PV));function xa(t,e,n,i){const r=N.useContext(Iu),s=N.useMemo(()=>t(r),[]);return N.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=r;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{l&&l(r),c.hasControl(s)&&c.removeControl(s)}},[]),s}function AV(t){const e=xa(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return N.useEffect(()=>{ar(e._container,t.style)},[t.style]),null}N.memo(AV);function LV(t){const e=xa(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return N.useEffect(()=>{ar(e._controlContainer,t.style)},[t.style]),null}N.memo(LV);function CV(t,e){const n=N.useRef({props:t}),i=xa(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,N.useImperativeHandle(e,()=>i,[]),N.useEffect(()=>{ar(i._container,t.style)},[t.style]),null}N.memo(N.forwardRef(CV));function MV(t){const e=xa(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return N.useEffect(()=>{ar(e._container,t.style)},[t.style]),null}N.memo(MV);function IV(t){const e=xa(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=N.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),N.useEffect(()=>{ar(e._container,r)},[r]),null}N.memo(IV);const RV=cV(()=>import("./mapbox-gl-b2d61779.js").then(t=>t.m),[]),OV=(()=>N.forwardRef(function(e,n){return TV(e,n,RV)}))();var ab=Symbol.for("immer-nothing"),Q_=Symbol.for("immer-draftable"),vt=Symbol.for("immer-state");function Vt(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var ys=Object.getPrototypeOf;function vs(t){return!!t&&!!t[vt]}function Ji(t){var e;return t?lb(t)||Array.isArray(t)||!!t[Q_]||!!((e=t.constructor)!=null&&e[Q_])||Ou(t)||ku(t):!1}var kV=Object.prototype.constructor.toString();function lb(t){if(!t||typeof t!="object")return!1;const e=ys(t);if(e===null)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===kV}function Ko(t,e){Ru(t)===0?Object.entries(t).forEach(([n,i])=>{e(n,i,t)}):t.forEach((n,i)=>e(i,n,t))}function Ru(t){const e=t[vt];return e?e.type_:Array.isArray(t)?1:Ou(t)?2:ku(t)?3:0}function eg(t,e){return Ru(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function cb(t,e,n){const i=Ru(t);i===2?t.set(e,n):i===3?t.add(n):t[e]=n}function NV(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function Ou(t){return t instanceof Map}function ku(t){return t instanceof Set}function Ri(t){return t.copy_||t.base_}function tg(t,e){if(Ou(t))return new Map(t);if(ku(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);if(!e&&lb(t))return ys(t)?{...t}:Object.assign(Object.create(null),t);const n=Object.getOwnPropertyDescriptors(t);delete n[vt];let i=Reflect.ownKeys(n);for(let r=0;r<i.length;r++){const s=i[r],o=n[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(n[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[s]})}return Object.create(ys(t),n)}function Qo(t,e=!1){return Nu(t)||vs(t)||!Ji(t)||(Ru(t)>1&&(t.set=t.add=t.clear=t.delete=FV),Object.freeze(t),e&&Ko(t,(n,i)=>Qo(i,!0))),t}function FV(){Vt(2)}function Nu(t){return Object.isFrozen(t)}var DV={};function er(t){const e=DV[t];return e||Vt(0,t),e}var Jo;function ub(){return Jo}function zV(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function J_(t,e){e&&(er("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function ng(t){ig(t),t.drafts_.forEach(BV),t.drafts_=null}function ig(t){t===Jo&&(Jo=t.parent_)}function e1(t){return Jo=zV(Jo,t)}function BV(t){const e=t[vt];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function t1(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return t!==void 0&&t!==n?(n[vt].modified_&&(ng(e),Vt(4)),Ji(t)&&(t=Kc(e,t),e.parent_||Qc(e,t)),e.patches_&&er("Patches").generateReplacementPatches_(n[vt].base_,t,e.patches_,e.inversePatches_)):t=Kc(e,n,[]),ng(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==ab?t:void 0}function Kc(t,e,n){if(Nu(e))return e;const i=e[vt];if(!i)return Ko(e,(r,s)=>n1(t,i,e,r,s,n)),e;if(i.scope_!==t)return e;if(!i.modified_)return Qc(t,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const r=i.copy_;let s=r,o=!1;i.type_===3&&(s=new Set(r),r.clear(),o=!0),Ko(s,(a,l)=>n1(t,i,r,a,l,n,o)),Qc(t,r,!1),n&&t.patches_&&er("Patches").generatePatches_(i,n,t.patches_,t.inversePatches_)}return i.copy_}function n1(t,e,n,i,r,s,o){if(vs(r)){const a=s&&e&&e.type_!==3&&!eg(e.assigned_,i)?s.concat(i):void 0,l=Kc(t,r,a);if(cb(n,i,l),vs(l))t.canAutoFreeze_=!1;else return}else o&&n.add(r);if(Ji(r)&&!Nu(r)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Kc(t,r),(!e||!e.scope_.parent_)&&Qc(t,r)}}function Qc(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Qo(e,n)}function UV(t,e){const n=Array.isArray(t),i={type_:n?1:0,scope_:e?e.scope_:ub(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=i,s=sm;n&&(r=[i],s=ea);const{revoke:o,proxy:a}=Proxy.revocable(r,s);return i.draft_=a,i.revoke_=o,a}var sm={get(t,e){if(e===vt)return t;const n=Ri(t);if(!eg(n,e))return VV(t,n,e);const i=n[e];return t.finalized_||!Ji(i)?i:i===dh(t.base_,e)?(gh(t),t.copy_[e]=sg(i,t)):i},has(t,e){return e in Ri(t)},ownKeys(t){return Reflect.ownKeys(Ri(t))},set(t,e,n){const i=fb(Ri(t),e);if(i!=null&&i.set)return i.set.call(t.draft_,n),!0;if(!t.modified_){const r=dh(Ri(t),e),s=r==null?void 0:r[vt];if(s&&s.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(NV(n,r)&&(n!==void 0||eg(t.base_,e)))return!0;gh(t),rg(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return dh(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,gh(t),rg(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=Ri(t),i=Reflect.getOwnPropertyDescriptor(n,e);return i&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:i.enumerable,value:n[e]}},defineProperty(){Vt(11)},getPrototypeOf(t){return ys(t.base_)},setPrototypeOf(){Vt(12)}},ea={};Ko(sm,(t,e)=>{ea[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});ea.deleteProperty=function(t,e){return ea.set.call(this,t,e,void 0)};ea.set=function(t,e,n){return sm.set.call(this,t[0],e,n,t[0])};function dh(t,e){const n=t[vt];return(n?Ri(n):t)[e]}function VV(t,e,n){var r;const i=fb(e,n);return i?"value"in i?i.value:(r=i.get)==null?void 0:r.call(t.draft_):void 0}function fb(t,e){if(!(e in t))return;let n=ys(t);for(;n;){const i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=ys(n)}}function rg(t){t.modified_||(t.modified_=!0,t.parent_&&rg(t.parent_))}function gh(t){t.copy_||(t.copy_=tg(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var jV=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,n,i)=>{if(typeof e=="function"&&typeof n!="function"){const s=n;n=e;const o=this;return function(l=s,...c){return o.produce(l,u=>n.call(this,u,...c))}}typeof n!="function"&&Vt(6),i!==void 0&&typeof i!="function"&&Vt(7);let r;if(Ji(e)){const s=e1(this),o=sg(e,void 0);let a=!0;try{r=n(o),a=!1}finally{a?ng(s):ig(s)}return J_(s,i),t1(r,s)}else if(!e||typeof e!="object"){if(r=n(e),r===void 0&&(r=e),r===ab&&(r=void 0),this.autoFreeze_&&Qo(r,!0),i){const s=[],o=[];er("Patches").generateReplacementPatches_(e,r,s,o),i(s,o)}return r}else Vt(1,e)},this.produceWithPatches=(e,n)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let i,r;return[this.produce(e,n,(o,a)=>{i=o,r=a}),i,r]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Ji(t)||Vt(8),vs(t)&&(t=GV(t));const e=e1(this),n=sg(t,void 0);return n[vt].isManual_=!0,ig(e),n}finishDraft(t,e){const n=t&&t[vt];(!n||!n.isManual_)&&Vt(9);const{scope_:i}=n;return J_(i,e),t1(void 0,i)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const r=e[n];if(r.path.length===0&&r.op==="replace"){t=r.value;break}}n>-1&&(e=e.slice(n+1));const i=er("Patches").applyPatches_;return vs(t)?i(t,e):this.produce(t,r=>i(r,e))}};function sg(t,e){const n=Ou(t)?er("MapSet").proxyMap_(t,e):ku(t)?er("MapSet").proxySet_(t,e):UV(t,e);return(e?e.scope_:ub()).drafts_.push(n),n}function GV(t){return vs(t)||Vt(10,t),hb(t)}function hb(t){if(!Ji(t)||Nu(t))return t;const e=t[vt];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=tg(t,e.scope_.immer_.useStrictShallowCopy_)}else n=tg(t,!0);return Ko(n,(i,r)=>{cb(n,i,hb(r))}),e&&(e.finalized_=!1),n}var _t=new jV,WV=_t.produce;_t.produceWithPatches.bind(_t);_t.setAutoFreeze.bind(_t);_t.setUseStrictShallowCopy.bind(_t);_t.applyPatches.bind(_t);_t.createDraft.bind(_t);_t.finishDraft.bind(_t);function HV(t){var e=N.useState(function(){return Qo(typeof t=="function"?t():t,!0)}),n=e[1];return[e[0],N.useCallback(function(i){n(typeof i=="function"?WV(i):Qo(i))},[])]}const i1={headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjdhNjhmNTI5NWJlNTk2NTAxZWM0NjMwYjI0Y2EzNjU0M2ZhMTZmYWFiNmM5OThkNGEzOWZkMDllMjQ2OTY1OTQyYmYxYTc1NTcxOGM0MGRjIn0.eyJhdWQiOiIxNDYiLCJqdGkiOiI3YTY4ZjUyOTViZTU5NjUwMWVjNDYzMGIyNGNhMzY1NDNmYTE2ZmFhYjZjOTk4ZDRhMzlmZDA5ZTI0Njk2NTk0MmJmMWE3NTU3MThjNDBkYyIsImlhdCI6MTU5ODkzOTg0MCwibmJmIjoxNTk4OTM5ODQwLCJleHAiOjE2MDE2MjE4NDAsInN1YiI6IiIsInNjb3BlcyI6WyJiYXNpYyJdfQ.Qyhr8Ruo6IBvs3jR2GH_b1yq_Q5L60UyziISfgbfkmN7TEG6Jj_9n06j0ChpeXv2HAgmBR2qnyClcuVVZgnssFHnOJ0lC_jRieJrzRtASBgC-6ekOK-82kNXm7CGlRiBujV5TegHweyU7iYv_Y_MA4Oy_SjUfBoVHvpAIawxtgnPnpC-u49vVa-nCCDrO-hr72H1K8yxT-SaFUVP61kz5QR9KCSIxihD0Wac3MlBmiG9nW4TAb120UGb603LkKD-4xRM-ywofbQttWGeF6w8X3XrTT4jqxaIfN4fmlaC7e049kEgcMjKOyiTMcn5KO7_hTAcYneKX8STkox-2X0I-g"}},$V={longitude:51.414178828767945,latitude:35.68490079732125,zoom:11,pitch:0,bearing:0},YV=t=>t.substring(4,t.length-1).replace(/ /g,"").split(",").map(n=>Number(n));function XV(){const[t,e]=N.useState(""),[n,i]=N.useState(!1),[r,s]=N.useState(""),[o,a]=HV({propertyName:"rxlevel",beginColor:"green",endColor:"blue",beginRange:-100,endRange:0});N.useEffect(()=>{(async()=>{const f=await(await fetch(t,{headers:{"x-api-key":i1.headers["x-api-key"]}})).json();Object.entries(f.sources).map(([,h])=>{const d=t.split("mym/styles")[0],p=h.tiles[0].split("tile/layers"),_=`${d}tile/layers${p[1]}${n?"?data_from_cache=true":""}`;s(_)})})()},[n,t]);const l=[r.length>0?new rm({data:r,pointRadiusUnits:"pixels",stroked:!1,getPointRadius:5,pickable:!0,getFillColor:c=>{var T;const{propertyName:u,beginColor:f,beginRange:h,endColor:d,endRange:p}=o,_=(T=c.properties)==null?void 0:T[u];if(_){const m=TT([h,p],[f,d])(_);return YV(m)}return[0,0,0]},updateTriggers:{getFillColor:o,data:r}}):null];return K.jsxs("div",{style:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[K.jsx("h2",{style:{margin:"0.5rem"},children:"with deck.gl"}),K.jsxs("form",{children:[K.jsxs("fieldset",{style:{display:"flex",flexDirection:"column",gap:"0.3rem"},children:[K.jsx("legend",{children:"tile service config: "}),K.jsxs("div",{style:{width:"100%",display:"flex",gap:"0.5rem"},children:[K.jsx("label",{htmlFor:"styleUrl",children:"styleUrl: "}),K.jsx("input",{type:"text",name:"styleUrl",value:t,onChange:c=>e(c.target.value.trim()),style:{flexGrow:"1"}})]}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"fromCache",children:"fromCache: "}),K.jsx("input",{type:"checkbox",name:"fromCache",value:n,onChange:c=>i(c.target.checked)})]}),K.jsxs("span",{style:{color:"gray"},children:["derivedTileUrl: ",r]})]}),K.jsxs("fieldset",{style:{display:"flex",gap:"0.4rem",flexWrap:"wrap"},children:[K.jsx("legend",{children:"fill color options: "}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"propertyName",children:"propertyName: "}),K.jsx("input",{type:"text",name:"propertyName",value:o.propertyName,onChange:c=>a(u=>{u.propertyName=c.target.value.trim()})})]}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"beginColor",children:"beginColor: "}),K.jsx("input",{type:"text",name:"beginColor",value:o.beginColor,onChange:c=>a(u=>{u.beginColor=c.target.value.trim()})})]}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"endColor",children:"endColor: "}),K.jsx("input",{type:"text",name:"endColor",value:o.endColor,onChange:c=>a(u=>{u.endColor=c.target.value.trim()})})]}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"beginRange",children:"beginRange: "}),K.jsx("input",{type:"number",name:"beginRange",value:o.beginRange.toString(),onChange:c=>a(u=>{u.beginRange=Number(c.target.value.trim())})})]}),K.jsxs("div",{children:[K.jsx("label",{htmlFor:"endRange",children:"endRange: "}),K.jsx("input",{type:"number",name:"endRange",value:o.endRange.toString(),onChange:c=>a(u=>{u.endRange=Number(c.target.value.trim())})})]})]})]}),K.jsx("div",{style:{position:"relative",flexGrow:"1"},children:K.jsx(VD,{initialViewState:$V,controller:!0,layers:l,getTooltip:({object:c})=>{var h;if(!(c!=null&&c.properties))return null;const{propertyName:u}=o,f=(h=c==null?void 0:c.properties)==null?void 0:h[u];return`${u} => ${f||" "}`},getCursor:({isHovering:c})=>c?"help":"grab",children:K.jsx(OV,{mapStyle:"https://dev.map.ir/vector/styles/main/mapir-xyz-light-style.json",transformRequest:c=>({url:c,headers:{"x-api-key":i1.headers["x-api-key"]}}),hash:!0})})})]})}ph.createRoot(document.getElementById("root")).render(K.jsx(nS.StrictMode,{children:K.jsx(XV,{})}));export{ZV as c,Jc as g};
